<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Data – Reading, Wrangling, and Writing – Statistics for the Experimental Bench Biologist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/plotting-models.html" rel="next">
<link href="../chapters/setup.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/reading-writing-wrangling.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data – Reading, Wrangling, and Writing</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistics for the Experimental Bench Biologist</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Front Matter</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analyzing experimental data with a linear model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started – R Projects and R Markdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/reading-writing-wrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data – Reading, Wrangling, and Writing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/plotting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/uncertainty-sd-and-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Variability and Uncertainty (Standard Deviations, Standard Errors, and Confidence Intervals)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/p-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">P-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Errors in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro-stat-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">An introduction to linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/continuous_x.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear models with a single, continuous <em>X</em> (“linear regression”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/one-factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear models with a single, categorical <em>X</em> (“t-tests” and “ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/model-checking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model checking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/multiple-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple tests – why and when to adjust <em>p</em>-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Issues in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/two-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models with two categorical <span class="math inline">\(X\)</span> – Factorial linear models (“two-way ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Linear models with added covariates (“ANCOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/lmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Models for non-independence – linear mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Linear models for longitudinal experiments</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-long" id="toc-data-long" class="nav-link active" data-scroll-target="#data-long"><span class="header-section-number">3.1</span> Long data format – the way data should be</a></li>
  <li><a href="#data-here" id="toc-data-here" class="nav-link" data-scroll-target="#data-here"><span class="header-section-number">3.2</span> Use the here function to construct the file path</a></li>
  <li><a href="#learning-from-this-chapter" id="toc-learning-from-this-chapter" class="nav-link" data-scroll-target="#learning-from-this-chapter"><span class="header-section-number">3.3</span> Learning from this chapter</a></li>
  <li><a href="#data-working-in-r" id="toc-data-working-in-r" class="nav-link" data-scroll-target="#data-working-in-r"><span class="header-section-number">3.4</span> Working in R</a>
  <ul>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data"><span class="header-section-number">3.4.1</span> Importing data</a>
  <ul class="collapse">
  <li><a href="#importing-excel-files" id="toc-importing-excel-files" class="nav-link" data-scroll-target="#importing-excel-files"><span class="header-section-number">3.4.1.1</span> Importing Excel files</a></li>
  <li><a href="#more-on-clean_names" id="toc-more-on-clean_names" class="nav-link" data-scroll-target="#more-on-clean_names"><span class="header-section-number">3.4.1.2</span> More on clean_names()</a></li>
  <li><a href="#more-on-read_excel" id="toc-more-on-read_excel" class="nav-link" data-scroll-target="#more-on-read_excel"><span class="header-section-number">3.4.1.3</span> More on read_excel()</a></li>
  <li><a href="#importing-text-files" id="toc-importing-text-files" class="nav-link" data-scroll-target="#importing-text-files"><span class="header-section-number">3.4.1.4</span> Importing text files</a></li>
  <li><a href="#troubleshooting-file-import" id="toc-troubleshooting-file-import" class="nav-link" data-scroll-target="#troubleshooting-file-import"><span class="header-section-number">3.4.1.5</span> Troubleshooting file import</a></li>
  <li><a href="#rule-number-one-in-r-scripting-rule1" id="toc-rule-number-one-in-r-scripting-rule1" class="nav-link" data-scroll-target="#rule-number-one-in-r-scripting-rule1"><span class="header-section-number">3.4.1.6</span> Rule number one in R scripting {# rule1}</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">3.4.2</span> Data wrangling</a>
  <ul class="collapse">
  <li><a href="#reshaping-data-wide-to-long" id="toc-reshaping-data-wide-to-long" class="nav-link" data-scroll-target="#reshaping-data-wide-to-long"><span class="header-section-number">3.4.2.1</span> Reshaping data – Wide to long</a></li>
  <li><a href="#reshaping-data-transpose-turning-the-columns-into-rows" id="toc-reshaping-data-transpose-turning-the-columns-into-rows" class="nav-link" data-scroll-target="#reshaping-data-transpose-turning-the-columns-into-rows"><span class="header-section-number">3.4.2.2</span> Reshaping data – Transpose (turning the columns into rows)</a></li>
  <li><a href="#combining-data" id="toc-combining-data" class="nav-link" data-scroll-target="#combining-data"><span class="header-section-number">3.4.2.3</span> Combining data</a></li>
  <li><a href="#data-subset" id="toc-data-subset" class="nav-link" data-scroll-target="#data-subset"><span class="header-section-number">3.4.2.4</span> Subsetting data</a></li>
  <li><a href="#wrangling-columns" id="toc-wrangling-columns" class="nav-link" data-scroll-target="#wrangling-columns"><span class="header-section-number">3.4.2.5</span> Wrangling columns</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">3.4.2.6</span> Missing data</a></li>
  </ul></li>
  <li><a href="#saving-data" id="toc-saving-data" class="nav-link" data-scroll-target="#saving-data"><span class="header-section-number">3.4.3</span> Saving data</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.4.4</span> Exercises</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="data" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data – Reading, Wrangling, and Writing</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This text avoids canned data sets from R packages because importing and wrangling data is a major obstacle in <em>doing</em> statistics for new R learners. Coding the import of raw data archived in text (or Excel or Google sheets) format is a best practice for increasing replicability.</p>
<p>Importing data is difficult for new R learners for two reasons</p>
<ol type="1">
<li>Many experimental biology researchers archive the data in a format that might make sense for analysis in Excel, but doesn’t work for analysis in most other statistical software, including R, without significant post-import processing (or <strong>wrangling</strong>) the data. This includes</li>
</ol>
<ul>
<li>data in <strong>wide format</strong>, where the measures of the response variable for each treatment level is in a different column</li>
<li>data in <strong>transposed format</strong>, where the measures of the response variable are in a row instead of a column (or the measures for each treatment level are in a separate row)</li>
<li>missing values that are represented by different things, sometimes in the same table. These things include blank cells, periods, hyphens, the word “NA”, or numbers such as -9999.</li>
<li>column headers that have multiple words separated by spaces</li>
<li>sheets with a variable number of empty cells that separate values within different groups</li>
<li>sheets that contain information about the data using colored blocks of cells or other formats</li>
</ul>
<p>These issues are solved by archiving data in (tidy data format)<span target="_blank">https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html</span>. The hallmark of tidy data is data in <strong>long format</strong>, which is introduced in the next section (Section @data-long). Nevertheless, most students and researchers will have colleagues that share non-tidy data and a critical skill for R users is the ability to tidy data.</p>
<ol start="2" type="1">
<li>A file on a hard drive has an address, or <strong>file path</strong> that is specific to both place (the specific computer) and time (the file organization of the computer). If we move a data file to another computer, or even to another directory within the same computer, the address changes. Modern computer users are at least vaguely familiar with the hierarchical organization of file storage (most students in my classes seem to store everything they create on the desktop) but are unaware of the concept of a file path and confused by what this path is. When we use a menu-driven system to open a file, the OS is constructing the file path under the hood. But when coding, we need to give R the file path. There are several imperfect methods for coding the path the the data file. There is one perfect method – the function <code>here</code> from the here package. This is discussed in <a href="#data-here%7D">Use the here function to construct the file path</a></li>
</ol>
<section id="data-long" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-long"><span class="header-section-number">3.1</span> Long data format – the way data should be</h2>
<p>Some best practices for archiving data tables, including archived data at journal websites, are illustrated by the format of the data in Table @ref(tab:data-diet-table).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>First six rows of the diet data set.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">subject_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">institution</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">diet</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">vo2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lean_mass</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fat_mass</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">D1</td>
<td style="text-align: left;">UC Davis</td>
<td style="text-align: left;">HF</td>
<td style="text-align: right;">129.5653</td>
<td style="text-align: right;">24.33708</td>
<td style="text-align: right;">15.862920</td>
</tr>
<tr class="even">
<td style="text-align: left;">D10</td>
<td style="text-align: left;">UC Davis</td>
<td style="text-align: left;">LF</td>
<td style="text-align: right;">100.0749</td>
<td style="text-align: right;">21.08880</td>
<td style="text-align: right;">3.151200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D11</td>
<td style="text-align: left;">UC Davis</td>
<td style="text-align: left;">LF</td>
<td style="text-align: right;">118.3097</td>
<td style="text-align: right;">22.56076</td>
<td style="text-align: right;">6.659238</td>
</tr>
<tr class="even">
<td style="text-align: left;">D12</td>
<td style="text-align: left;">UC Davis</td>
<td style="text-align: left;">LF</td>
<td style="text-align: right;">107.7487</td>
<td style="text-align: right;">22.11884</td>
<td style="text-align: right;">5.351156</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D13</td>
<td style="text-align: left;">UC Davis</td>
<td style="text-align: left;">LF</td>
<td style="text-align: right;">104.7367</td>
<td style="text-align: right;">21.17438</td>
<td style="text-align: right;">5.005616</td>
</tr>
<tr class="even">
<td style="text-align: left;">D14</td>
<td style="text-align: left;">UC Davis</td>
<td style="text-align: left;">HF</td>
<td style="text-align: right;">138.6420</td>
<td style="text-align: right;">24.64885</td>
<td style="text-align: right;">16.501150</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The best practices included in the archived data include</p>
<ol type="1">
<li>The data table contains all measures on each individual. In most of the archived Excel files that I download from journal websites, the researchers have separated each variable into separate tables and exclude all information from these tables other than the treatment group. For example, researchers would typically archive the vo2 values in Table @ref(tab:data-diet-table) in a separate table within an Excel sheet and with the values split by diet group (high fat “HF” and low fat “LF”)(Figure @ref(fig:data-vo2-table-wide)). Don’t do this.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/data-vo2_wide.png" class="img-fluid figure-img"></p>
<figcaption>The vo2 values separated from the rest of the data and split into separate diet groups.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>We don’t want to separate each variable into separate tables because we often want to use information from other measures of the same individual in our analysis. For example, for the comparison of <span class="math inline">\(\texttt{vo2}\)</span> among treatment levels, we would want to add the measure of <span class="math inline">\(\texttt{lean\_mass}\)</span> to the model as a covariate (what is often called an ANCOVA model). To do this, we’d need to know which values of <span class="math inline">\(\texttt{vo2}\)</span> and values of <span class="math inline">\(\texttt{lean\_mass}\)</span> belong to the same individual.</li>
<li>Even if you think you have analyzed the data using a best practice, don’t separate each variable into separate tables. Researchers sometimes fail to recognize best practices. Any re-analysis of published data using best practices often require information from other measures of the same individual. For example, many researchers would compare the ratio of <span class="math inline">\(\texttt{vo2}\)</span> to <span class="math inline">\(\texttt{total\_mass}\)</span> among treatment levels. This isn’t a best practice and if I want to check the researchers conclusions, I’d need a table like Table @ref(tab:data-diet-table) to re-analyze the data.</li>
<li>Even if you have used what is considered a best practice, don’t separate each variable into separate tables. Sometimes a researcher wants to use data from published data sets to parameterize a mechanistic model. Or, use data from published data sets to explore patterns of relationships among variables, for example how fat mass scales with lean mass (or total mass). For these, we need a table like Table @ref(tab:data-diet-table) to re-analyze the data.</li>
</ul>
<ol start="2" type="1">
<li>The researchers organized the table with individuals in rows. A data table with all measures for each individual could organize the data with each row or each column belonging to one individual. The best practice for most analysis in R (and most other statistical software) is to organize individuals to rows (there are exceptions in some R packages that analyze genomics datasets).</li>
<li>The researchers organized the data in <strong>long format</strong> – that is, each column contains <em>all</em> measures of a single variable. In general, do not organize the data in <strong>wide format</strong>, by splitting the values of a variable into multiple columns, with each column representing the values for a different group. An example of wide format is in Figure @ref(fig:data-vo2-table-wide), which is the <span class="math inline">\(\texttt{vo2}\)</span> subset of data split by the groups in the columne <span class="math inline">\(\texttt{diet}\)</span>. By contrast, the <span class="math inline">\(\texttt{vo2}\)</span> data are in long format in the original table (Table @ref(tab:data-diet-table)). It might be useful to think of long format for a variable as a single column with the values for each group <strong>stacked</strong> on top of each other.</li>
</ol>
<p>In general, R and almost all other statistical software (one exception is Graphpad Prism) require the data to be in long format.</p>
<ul>
<li>A reason for this is because the long format is consistent with the math underneath the statistical modeling of data. For example, the least squares solution of the linear model is</li>
</ul>
<p><span class="math display">\[
\mathbf{b} = (\mathbf{X}^\top\mathbf{X})^{-1}\mathbf{X}^\top\mathbf{y}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}\)</span> is the <strong>model matrix</strong>, a table of numeric values with each row containing the values of the <span class="math inline">\(X\)</span> variables for an individual (categorical variables such as <span class="math inline">\(\texttt{diet}\)</span> are recoded into one or more numeric <strong>indicator variables</strong> indicating group membership). The model matrix is in long format. * A second reason is organizational simplicity. Statistical models often include multiple variables measured on the same individual – the example above with <span class="math inline">\(\texttt{lean\_mass}\)</span> added as a covariate is an example. With data in wide format, there is no non-awkward way to match values of <span class="math inline">\(\texttt{lean\_mass}\)</span> with values of <span class="math inline">\(\texttt{vo2}\)</span> from the same individual. Or, in models with <a href="#factorial">crossed factor variables</a>, for example, an experiment with four groups repesenting all four combinations of the variables <span class="math inline">\(\texttt{genotype}\)</span> (with levels “WT” and “KO”) and <span class="math inline">\(\texttt{treatment}\)</span> (with levels “Control” and “HFD”), there is no non-awkward way (at least in a table with a single header row) to indicate that the design is two crossed factors. In wide format, the design appears to be a single factor with four groups.</p>
<p>Don’t confuse a data table with multiple columns of <em>different</em> variables with a data table in wide format. Long and wide are relevant to how a single variable is organized – if split into multiple columns the table is wide, if stacked into a single column, the table is long.</p>
<p>One exception to long format is a <strong>longitudinal</strong> or a <strong>repeated measures</strong> data set (Chapter @ref(pre-post)), in which the response variable is measured multiple times on each individual. An example might be a <em>pre-post</em> design where a variable is measured both before and after a treatment is applied or an experiment where the response is measured each week for multiple weeks. In <strong>univariate</strong> models for the analyses of these data, the multiple measures for an individual are stacked into long format. As a consequence, there are now multiple rows of data for each individual (one for each measure of the variable). In <strong>multivariate</strong> models for the analyses of these data, the multiple measures for an individual are treated as if they are different variables and are spread out into wide format.</p>
<ol start="4" type="1">
<li>The table includes the raw values. Many researchers normalize or standarize the values of a variable by constructing a ratio of the raw value divided by some standardizing value. Almost always, the best practice is to leave the response variable alone (do not make a ratio) and include the standardizing value as a covariate (or offset) in the model. But, if I want to check th conclusions of a particular result in which the researchers used a ratio as the response variable, then I would need the raw measures and the standardizing values.</li>
</ol>
</section>
<section id="data-here" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="data-here"><span class="header-section-number">3.2</span> Use the here function to construct the file path</h2>
<p>Importing data into R can be a struggle for new R users and, unfortunately, most online “how to import” sources give easy but superficial methods that don’t follow best practices for increasing reproducibility or do not allow flexible organization of files within a project.</p>
<p>(TL;DR – use <code>here()</code> from the here package)</p>
<ol type="1">
<li><code>df &lt;- read.table(file="clipboard")</code> imports data copied to the clipboard, from an Excel/Sheets file or from an open text file. For this to be semi-reproducible, a comment specifying the filename, worksheet and range that was copied is necessary. More problematic (catastrophically so for reproducibility), is, how does a researcher know that they highlighted and copied the correct range in the Excel sheet?</li>
<li><code>df &lt;- read.csv(file.choose())</code> opens the familiar “open file” dialog box, which lets the user navigate to the file of choice. For this to be semi-reproducible, a comment specifying the filename to import is necessary. The catastrophic problem (for reproducibility) is, how does a researcher know which file was actually opened during an R session? The researcher might think they opened “walker_maine_bee_data_clean_androscoggin.csv” but mistakenly opened “walker_maine_bee_data_clean_aroostook.csv”.</li>
<li><code>df &lt;- read.table(file="my_data.txt")</code> and <code>df &lt;- read_excel(file="my_data.xlsx")</code> are reproducible because the filename is explicitly specified. But, this method requires that “my_data” is physically located in the same folder as the file containing the R script (the .Rmd file in our case) and this violates the best practice of clean project organization with different folders for the different kinds of files (data, R scripts, images, manuscript text, etc.).</li>
<li>R Studio has an elegant import tool in the environment pane that opens a custom dialog box that allows the researcher to navigate to the file, and to specify what part of the file to import, such as the specific sheet and range for an Excel file. This has the same reproducibility issues as #1 and #2 but R Studio includes the equivalent script, which adds all relevant information for reproducility. One then simply copies and pastes this script into a code chunk and voila! The next time the script is run, the data can be imported from the script without using menus and dialog boxes. Except that..the script does not seem to take into account that the <strong>working directory</strong> of an R Markdown file is not the project folder but the folder containing the R Markdown file and so this two-step method fails. More personally, I’d prefer to run a chunk that quickly opens the data file instead of re-navigating through my file system and re-specifying the sheet and range every time I re-start the project in a new R session.</li>
</ol>
<p>There are at least three solutions to the issues raised above, all requiring some understanding of <strong>file paths</strong> and directory structure in an operating system. A file such as “my_data.xlsx” has an <strong>absolute</strong> file path, which is the full address of the file (the filename is something like your house street number). The absolute file path of “my_data.xlsx” might be “/Users/jwalker/Documents/applied-biostatistics/data/my_data.xlsx”. A <strong>relative</strong> file path is the file path from the <strong>working directory</strong>. In an R Studio project, the working directory is the project directory, which is the directory containing the .Rproj file. This will be the working directory of the console. <em>Importantly</em>, the working directory of an R Markdown code chunk is the folder containing the saved R Markdown file. An R Studio Notebook is an R Markdown file so the working directory of a notebook code chunk is the folder containing the saved notebook file. If an R Markdown file is located within the <em>rmd</em> folder, which is located within the project folder, then the relative file path to “my_file.xlsx” is “../data/my_file.xlsx”. The “..” tells the file OS to move “up” into the parent directory (which is the project folder) and the “data” tells the file OS to move “down” into the data folder. These are put together into a single address using “/”. The beauty of relative paths is that they remain the same – and so do not break one’s script – if the project folder, and all of its contents including the <em>data</em> folder and the <em>rmd</em> folder, is moved to another location on the hard drive (say into a new “Research” folder). By contrast, the absolute file path changes, which breaks any old script.</p>
<p>The three solutions are</p>
<ol type="1">
<li>Create a <strong>relative path</strong> to the file using something like <code>file_path &lt;- "../data/my_data.xlsx"</code>. This should <em>always</em> work but it fails on some computers. For example, if the project folder is on a Windows OS (but not Mac OS) desktop, the assigned relative address doesn’t seem to look in the folder containing the file.</li>
<li>Create a setup chunk that reroutes the working directory to the project folder using the script</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use this in a chuck called "setup" to force the working directory to be</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># at the level of the project file.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">root.dir =</span> rprojroot<span class="sc">::</span><span class="fu">find_rstudio_root_file</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this to work, the chunk has to be named “setup”, that is, the text inside the curly brackets at the top of the chunk should be “r setup”. Then, with this chunk, the relative file path is <code>file_path &lt;- "../data/my_data.xlsx"</code> if “my_data.xlsx” is immediately inside the data folder which is immediately inside the project folder. This should work on any machine, and should work even if a project folder is moved.</p>
<ol start="3" type="1">
<li>Use the function <code>here()</code>. The most robust solution seems to be using the function <code>here()</code> from the here package. The function works something like this</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="ot">&lt;-</span> <span class="st">"data"</span> <span class="co"># path to data that are imported</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"my_data.xlsx"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, file_name) <span class="co"># paste together parts of the address</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>my_file <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">file =</span> file_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>here()</code> creates an absolute path, but one that is created on the fly, and will change (or should change) correctly if the project folder is moved on the same machine, to a cloud drive, or to another machine altogether.</p>
</section>
<section id="learning-from-this-chapter" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="learning-from-this-chapter"><span class="header-section-number">3.3</span> Learning from this chapter</h2>
<p>It will be easiest to learn from this chapter by starting with a clean R Markdown document for this chapter. Create a new R Markdown file and save it to the “Rmd” folder of your project. To create and setup the Rmd, follow the steps in <a href="setup.html#setup-create-rmd">Create and setup an R Markdown document (Rmd)</a></p>
<p><strong>Important:</strong> The import method given here will not work properly until the Rmd file is saved! Get in the habit of creating the file, saving it immediately, and saving it often.</p>
<p><strong>Important:</strong> The import method will not work properly unless you are working within your R studio project. If you don’t see the name of the project in the upper right of the R Studio toolbar, then you are not in the project. Open the project before moving forward. A good habit is to open R studio by double clicking the project file icon (and not the R Studio icon or the Rmd document that you are working on).</p>
<p>Notes on the setup chunk from <a href="setup.html#setup-create-rmd">Create and setup an R Markdown document (Rmd)</a></p>
<ol type="1">
<li>As you become a better R programmer, be kind to the future you by loading only the packages necessary for the code in the R Markdown file that you are working on. If your default is to load everything, the future you will be confused why something was installed. Again, we’ve disregarded this best practice in this textbook to make sure that chunks don’t fail because of a missing function.</li>
<li>Be kind to the future you by commenting on why a package is loaded; usually this is a specific function from the package</li>
<li><code>here &lt;- here::here</code> is my favorite script ever. What is it doing? One can read this as “assign the function here from the here package to the object here” (this is reading the script right to left). Why do this? It turns out the multiple packages define a function called “here”. If any of these packages are loaded after the here package, then <code>here</code> from here won’t work – it will be replaced by <code>here</code> from the more recently loaded package. To make sure that <code>here</code> uses the function from the here package, I simply reassign <code>here</code> from the here package to the object “here” <em>after</em> loading in all packages.</li>
</ol>
</section>
<section id="data-working-in-r" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="data-working-in-r"><span class="header-section-number">3.4</span> Working in R</h2>
<section id="importing-data" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="importing-data"><span class="header-section-number">3.4.1</span> Importing data</h3>
<section id="importing-excel-files" class="level4" data-number="3.4.1.1">
<h4 data-number="3.4.1.1" class="anchored" data-anchor-id="importing-excel-files"><span class="header-section-number">3.4.1.1</span> Importing Excel files</h4>
<p><strong>Source article</strong>: <a href="https://elifesciences.org/articles/59399" target="_blank">Lyu, Yang, et al.&nbsp;“Drosophila serotonin 2A receptor signaling coordinates central metabolic processes to modulate aging in response to nutrient choice.” Elife 10 (2021): e59399.</a></p>
<p><strong>file name</strong>: <a href="https://cdn.elifesciences.org/articles/59399/elife-59399-fig1-data1-v2.xlsx" target="_blank">elife-59399-fig1-data1-v2.xlsx</a></p>
<p>Let’s open the data for Fig. 1H.</p>
<p>Steps</p>
<ol type="1">
<li>Highlight and copy the title of the article, which is “Drosophila serotonin 2A receptor signaling coordinates central metabolic processes to modulate aging in response to nutrient choice”</li>
<li>Create a new folder within the “data” folder. Name the folder the title of the paper by pasting the name from the clipboard. This is the “data from” folder, since it contains the data from the publication with the title of the folder.</li>
<li>Download the .xlsx file and move it into this folder</li>
</ol>
<p>The code below uses the function <code>read_excel()</code> from the package readxl. More about the amazing power of this package is the <a href="https://readxl.tidyverse.org" target="_blank">tidyverse page</a> and <a href="http://r4ds.had.co.nz/data-import.html" target="_blank">chapter 11</a> in the <em>R for Data Science</em> book.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Drosophila serotonin 2A receptor signaling coordinates central metabolic processes to modulate aging in response to nutrient choice"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"elife-59399-fig1-data1-v2.xlsx"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>) <span class="sc">|&gt;</span> <span class="co"># pipe the result to next line</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> <span class="co"># clean column names and pipe the result to next line</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="co"># convert to data.table</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig1h)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This book will consistently uses this protocol for importing downloaded Excel files. For <em>any</em> tidy archived data in Excel, a user would simply copy this chunk, paste it into their Rmd, and modify the stuff inside the quotes to import the data. But this is mindless programming. Don’t do <em>just</em> this. Understand what each line in the chunk does.</p>
<section id="view-the-data" class="level5" data-number="3.4.1.1.1">
<h5 data-number="3.4.1.1.1" class="anchored" data-anchor-id="view-the-data"><span class="header-section-number">3.4.1.1.1</span> View the data</h5>
<p>The very first thing that you should do after importing data, without exception, is to View the imported data. The last line in the code chunk above is a reminder of this, and one of several ways to View the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig1h)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <strong>comment</strong> (or hashtag) symbol (#) tells R to ignore everything in the line following the symbol. Usually a comment symbol is followed by a brief comment on the code and is mostly for the future you – when you come back after a six month hiatus and wonder what a line or block of code is doing, the comment gives you this information. Sometimes a comment is used in front of R code to keep the R code from running. That is the purpose of the comment symbol here.</p>
<p><code>View(fig1h)</code> tells R to open a window showing a spreadsheet view of the data.table <code>fig1h</code>. In R studio, this window is opened as a new tab in the Source editor pane (the pane with your Rmd content). To run this code, highlight “View(fig1h)” but not the comment symbol and click the “Run selected line(s)” item in the Run pop-up menu (right side of pane’s tool bar). We don’t include the comment sign in the highlight because this would tell R to ignore everything after it.</p>
<p>We can View the data in <code>fig1h</code> more easily by holding the command key (Mac OS) or the control key (Windows) and clicking the mouse in “fig1h” in any of the lines. Even though I use the mouse click method, I like to have the <code>View(fig1h)</code> at the end of my import chunk to remind me to View the data to make sure everthing imported correctly.</p>
<p>A third, and probably easiest way to View the data is to click on the name of the object in the Enviroment pain (typically upper right pane in the default R Studio layout).</p>
</section>
<section id="what-does-each-line-in-the-chunk-do" class="level5" data-number="3.4.1.1.2">
<h5 data-number="3.4.1.1.2" class="anchored" data-anchor-id="what-does-each-line-in-the-chunk-do"><span class="header-section-number">3.4.1.1.2</span> What does each line in the chunk do?</h5>
<p>The first three lines in the chunk create the directory path to the file. This path includes three variables</p>
<ol type="1">
<li><code>data_folder</code> – assigned to “data” in the setup chunk. “data” is a folder within the project folder that contains (or will contain) all datasets for this text. The data come from many different published papers, so the data for each publication gets its own folder within “data”.</li>
<li><code>data_from</code> – the name of the “data from” folder within “data” containing the data files. In this text, these folder names will always be the name of the published paper.</li>
<li><code>filename</code> – the name of the file to read. There may be multiple data files within the publication’s data folder.</li>
</ol>
<p>These are all put together into the absolute path using the function <code>here()</code> from the here package. Take a look at the value of file_path to confirm.</p>
<p>The next four numbered lines (starting with <code>fig1h &lt;- read_excel</code>) is composed of three functions that are linked together by the pipe operator <code>|&gt;</code>. Separately, the code would look like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(fig1h) <span class="co"># clean column names</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">data.table</span>(fig1h) <span class="co"># convert to data.table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><code>read_excel</code> imports the data and names it “fig1h”. More technically, the code assigns the imported object to a data.frame object named <code>fig1h</code>. Throughout, this text uses the “figXXX” convention for imported data. Examples online often use conventions like “dat” or “my_data” but these are not very meaningful names in the sense that the name doesn’t convey any information on what the data is.</li>
<li><code>clean_names</code> cleans the column names of <code>fig1h</code>. This is explained more below.</li>
<li><code>data.table</code> converts <code>fig1h</code> to a data.table object. A data.table is a data.frame with magical properties. Everyone should know data.table.</li>
</ol>
<p>Again, here is the version with the three separate functions piped together with the pipe operator <code>|&gt;</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>) <span class="sc">|&gt;</span> <span class="co"># pipe the result to next line</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> <span class="co"># clean column names and pipe the result to next line</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="co"># convert to data.table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The pipe operator takes output from one function and sends this to another function. The output from the last function is assigned the name <code>fig1h</code>. Note that we don’t put “fig1h” in the parentheses of the <code>clean_names()</code> and <code>data.table()</code> functions – the pipe operator does this for us.</p>
<p>A 3rd way to do write these three functions is to nest them like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="fu">clean_names</span>(<span class="fu">read_excel</span>(file_path,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>))) <span class="co"># convert to data.table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Prior to the creation of the pipe operator, I nested functions to make code more compact. However, nested functions are often less readable, and I now mostly avoid these and use the pipe operator instead.</p>
</section>
</section>
<section id="more-on-clean_names" class="level4" data-number="3.4.1.2">
<h4 data-number="3.4.1.2" class="anchored" data-anchor-id="more-on-clean_names"><span class="header-section-number">3.4.1.2</span> More on clean_names()</h4>
<p>Let’s back up to understand the steps, and especially the <code>clean_names</code> step. Here is the first line, which is the line that imports the file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at the column names (or column headers in Excel lingo) of the imported data using <code>names</code> or <code>colnames</code> (yes, there are elebenty million ways to do anything in R) (<code>names</code> is very general in that it can be used to return the names of the parts of any list, while <code>colnames</code> is specific to matrix-like objects). Type this into the console, not into your R Markdown chunk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fig1h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Diet"             "Replicate"        "Weight (mg/fly)"  "TAG (ug/fly)"    
[5] "Protein (ug/fly)" "TAG/Protein"     </code></pre>
</div>
</div>
<p>In general, it is bad practice to include spaces, parentheses, and special characters such as /, -, $, or ^, in the column names of a data frame because these symbols have specific meanings in R functions. The best practice for spaces is to replace the space with an underscore, for example the column header ““Weight (mg/fly)” could be <code>weight_mg_per_fly</code>. Some coders separate words with a period (<code>weight.mg.per.fly</code>). Others mash words together into a single word like this <code>weightmgperfly</code> but this should generally be avoided because the result can be hard to read. Finally, some coders use Caps to separate words like this <code>WeightMgPerFly</code>. This is easier to read than simple concatenation but the underscore is the easiest to read.</p>
<p><code>clean_names</code> from the janitor package is a beautiful function to clean the column names of a data frame including replacing spaces with an underscore and stripping parentheses. The default format is <a href="https://en.wikipedia.org/wiki/Snake_case" target="_blank">snake_case</a>, which replaces all spaces with underscores and changes any uppercase letter with lowercase. Many coders like to work with all lowercase variable names to avoid having to hit the shift key. I am one of these.</p>
<p>Now run the line and look at the column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(fig1h)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fig1h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "diet"           "replicate"      "weight_mg_fly"  "tag_ug_fly"    
[5] "protein_ug_fly" "tag_protein"   </code></pre>
</div>
</div>
<p>Finally, run the line</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">data.table</span>(fig1h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You won’t see any difference if you View the data or peak at the column names. But you’ve transformed the data frame to a data.table and given it magical properties.</p>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p><strong>Worst Practices</strong> – resist the temptation to change the column names in the data file, which reduces reproducibility. Leave original data files original. Always increase reproducibility!</p>
</div>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p><strong>colleague blues</strong> – Most researchers live in an Excel world and save data in a way that is efficient for computing stuff in Excel but not efficient for statistical analysis using R or other statistical computing software packages (with the exception of Graphpad Prism). Analyzing data will be much less frustrating if the data are saved in a format that facilitates analysis. Best practices for creating data files</p>
<ol type="1">
<li><p>https://www.youtube.com/watch?time_continue=309&amp;v=Ry2xjTBtNFE – An excellent video introduction to best practices for organizing data in a spreadsheet that will subsequently be analyzed by statistics software.</p></li>
<li><p>Broman, K. W., &amp; Woo, K. H. (2017). Data organization in spreadsheets (No.&nbsp;e3183v1). https://doi.org/10.7287/peerj.preprints.3183v1 – An excelllent review of best practices for organizing data in a spreadsheet.</p></li>
</ol>
</div>
</section>
<section id="more-on-read_excel" class="level4" data-number="3.4.1.3">
<h4 data-number="3.4.1.3" class="anchored" data-anchor-id="more-on-read_excel"><span class="header-section-number">3.4.1.3</span> More on read_excel()</h4>
<p><code>read_excel</code> is a beautifully flexible function because Excel. Data can be in different sheets and there can be different datasets within a single sheet. And, researchers tend to use Excel like a blackboard in that an Excel sheet often contains calculations such as means, standard deviations and t-tests. When using <code>read_excel</code> it is important to send the function enough information to read the correct data. For the fig1h data, if we simply used</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>without specifying the sheet, <code>read_excel</code> defaults to reading the first sheet (“A”), which is not what we wanted.</p>
<p>We can specify the exact range to important using the <code>range =</code> argument</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A1:F49"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This isn’t necessary for these data because the “H” sheet contains only a matrix of data and not extraneous information and the <code>read_excel</code> function is smart enough to figure this out. For many of the data sets in wet bench experimental biology, the range argument will be crucial because multiple datasets are archived on a single sheet.</p>
<p>We can also specify other arguments. For example, the following code explicitly tells read_excel to use the first row of the data range to be used as the column names and not the first row of data. TRUE is the default argument, so this isn’t necessary for the fig1h data but if the data we want to import doesn’t have column names (and this can be common in archived data sets) then we need to pass the argument “col_names = FALSE”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"H"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A1:F49"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a-quick-plot-of-the-fig1h-data" class="level5" data-number="3.4.1.3.1">
<h5 data-number="3.4.1.3.1" class="anchored" data-anchor-id="a-quick-plot-of-the-fig1h-data"><span class="header-section-number">3.4.1.3.1</span> A quick plot of the fig1h data</h5>
<p>Just for fun, let’s use the <code>ggboxplot</code> function from the ggpubr package to reproduce something close to Fig. 1H. We could make a plot that looks exactly like Fig. 1H but this would require some of the wrangling outlined below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(<span class="at">data =</span> fig1h,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"diet"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"tag_protein"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"TAG/Protein"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"jitter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/data-plot-fig1h-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Notes on the code to make this plot</p>
<ol type="1">
<li>the names of the columns to use as the x and y axes were passed inside quotes. In some R functions, column names are passed inside quotes and in other R functions, the column names are passed as-is. There is little rhyme or reason for this.</li>
</ol>
</section>
</section>
<section id="importing-text-files" class="level4" data-number="3.4.1.4">
<h4 data-number="3.4.1.4" class="anchored" data-anchor-id="importing-text-files"><span class="header-section-number">3.4.1.4</span> Importing text files</h4>
<p><strong>Source article</strong>: <a href="https://elifesciences.org/articles/53560" target="_blank">Corrigan, June K., et al.&nbsp;“A big-data approach to understanding metabolic rate and response to obesity in laboratory mice.” Elife 9 (2020): e53560.</a>.</p>
<p><strong>file name</strong>: <a href="https://raw.githubusercontent.com/elifesciences-publications/Cal-Repository/master/mmpc_all_phases.csv" target="_blank">mmpc_all_phases.csv</a></p>
<p>Let’s open the data for Fig. 1.</p>
<p>Steps</p>
<ol type="1">
<li>Copy the title of the paper title, which is “A big-data approach to understanding metabolic rate and response to obesity in laboratory mice”</li>
<li>Create a new folder within “data”. Name the folder the title of the paper by pasting from the clipboard. This is the “data from” folder, since it contains the data from the publication with the title of the folder.</li>
<li>Click on the link to the file above, highlight all values in the window by clicking inside the window and typing command-a (Mac os) or control-a (Windows) and copy.</li>
<li>Paste into a an open, blank text document and save it as “mmpc_all_phases.csv”. If saved elsewhere, move this file into the “A big-data approach to understanding metabolic rate and response to obesity in laboratory mice” folder within the “data” folder.</li>
<li>If you don’t have a dedicated text editor such as BBEdit on MacOS, then open a new R (not Rmd!) document in R studio. This will open as a new tab in the Script Editor pane. Paste the data into the R document window. Save it as “mmpc_all_phases.csv”. R Studio will ask to be sure you want the extension to be .csv and not .R. Yes you are sure. If saved elsewhere, move this file into the “A big-data approach to understanding metabolic rate and response to obesity in laboratory mice” folder within the “data” folder.</li>
</ol>
<p>A .csv file is a <strong>comma-delimited</strong> text file, which means that the entries of a row are separated by commas. A text file is readable by any text editor software and most other kinds of software. Datasets that are stored as text files are typically saved as either .csv (where the entries of a row are separated by commas) or .txt (where the entries are separated by tabs). The base R way to read a .csv file is using <code>read.csv</code>. The <code>read.table</code> function is more versatile, as the delimiter can be specified. The function <code>fread()</code> from the data.table package is fast, smart, and flexible. It is smart in the sense that it guesses what the delimter is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># construct file path</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"A big-data approach to understanding metabolic rate and response to obesity in laboratory mice"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"mmpc_all_phases.csv"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># open file and assign to fig1, then pipe to clean_names</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># to change column names to snake_case</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>fig1 <span class="ot">&lt;-</span> <span class="fu">fread</span>(file_path) <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Be sure to read the section on importing Excel files above to understand this code. Here, as with the import of the Excel file, the first three lines create the directory path to the file. There is no need to pipe <code>fig1</code> to the <code>data.table</code> function because <code>fread</code> automatically opens the data as a data.table. As with the imported Excel file above, this code sends the data object to <code>clean_names</code> to change the column labels to snake_case.</p>
<section id="a-quick-plot-of-the-fig1-data" class="level5" data-number="3.4.1.4.1">
<h5 data-number="3.4.1.4.1" class="anchored" data-anchor-id="a-quick-plot-of-the-fig1-data"><span class="header-section-number">3.4.1.4.1</span> A quick plot of the fig1 data</h5>
<p>Let’s use the <code>ggscatter</code> function from the ggpubr package to reproduce something close to Fig. 1D. We could make a plot that looks exactly like Fig. 1D but this would require some additional plot arguments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(<span class="at">data =</span> fig1[diet <span class="sc">==</span> <span class="st">"HF"</span> <span class="sc">&amp;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                    acclimation <span class="sc">==</span> <span class="cn">TRUE</span>],</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"total_mass"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"ee"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"institution"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> pal_okabe_ito_4,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"energy expenditure (kcal/hr)"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"body mass (g)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="troubleshooting-file-import" class="level4" data-number="3.4.1.5">
<h4 data-number="3.4.1.5" class="anchored" data-anchor-id="troubleshooting-file-import"><span class="header-section-number">3.4.1.5</span> Troubleshooting file import</h4>
<p>If you get an error that starts with “Error: <code>path</code> does not exist:” then R is not “seeing” your specified file given the path you’ve given it.</p>
<ol type="1">
<li>Make sure that you are working within the project by checking the project name on the right side of the R Studio tool bar. If the project is “None” or you are working within a different project, then open the new project.</li>
<li>Make sure you loaded the package <code>here</code> in a “setup” chunk and that you have run the setup chunk</li>
<li>Make sure you have assigned <code>data_folder &lt;- "data"</code> in the setup chunk and have run the chunk.</li>
<li>Make sure your “data” folder is <em>one level</em> inside your project folder. “one level” means it is not buried deeper inside other folders within the project folder.</li>
<li>Make sure your “data from” folder (the folder with the title of the publication) is one level inside your “data” folder</li>
<li>Make sure your data file is one level inside the correct “data from” folder.</li>
<li><strong>Bug alert</strong> Make sure you have the name of the “data from …” folder correct in your script. Do not type the name of the folder. Instead, go to the finder and highlight the folder containing the data file, copy the name, return to the R markdown script, type <code>folder &lt;- ""</code> and then paste the clipboard (the name of the folder) in between the quote marks.</li>
<li><strong>Bug alert</strong> Make sure the file name is correct in the script. As with the folder name, I go to the finder and copy the file name and paste it in place. In Windows use ctrl-a instead of ctrl-c to copy the full filename including the extension.</li>
</ol>
<p>More generally, Humans are very good at understanding misspelld and OdDLy capitalized words but the R language (or any computer language) is very literal. R is <strong>case sensitive</strong> (some programming languages are not). “Prenatal acoustic communication”, “Prenatal Acoustic Communication”, and “prenatal acoustic communication” are all different values. Spelling AND capitalization have to be perfect, not simply close. Spelling includes <em>spaces</em>. A frequent bug is a file name typed as “Prenatal acoustic communication” when the actual name is “Prenatal acoustic communication”. Can you spot the bug? The original (what we need to copy) has two spaces between “acoustic” and “communication” while the incorrect copy has only one.</p>
<p>Spelling bugs are avoided by simply copying and pasting names of folders, names of files, column names of data frames, and level names of factors, which leads to a general rule of R scripting…</p>
</section>
<section id="rule-number-one-in-r-scripting-rule1" class="level4" data-number="3.4.1.6">
<h4 data-number="3.4.1.6" class="anchored" data-anchor-id="rule-number-one-in-r-scripting-rule1"><span class="header-section-number">3.4.1.6</span> Rule number one in R scripting {# rule1}</h4>
<p><strong>Always copy and paste any text that will be inserted into quotes</strong></p>
<p>Do not try to type it out. You have been warned.</p>
</section>
</section>
<section id="data-wrangling" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="data-wrangling"><span class="header-section-number">3.4.2</span> Data wrangling</h3>
<p>Data archived in Excel spreadsheets, at least in wet-bench experimental biology projects, are generally not in a format this is readily analyzed in R, or any statistical software other than perhaps Graphpad Prism. Use these examples as templates for how to import and wrangle Excel-archived data in your project.</p>
<section id="reshaping-data-wide-to-long" class="level4" data-number="3.4.2.1">
<h4 data-number="3.4.2.1" class="anchored" data-anchor-id="reshaping-data-wide-to-long"><span class="header-section-number">3.4.2.1</span> Reshaping data – Wide to long</h4>
<section id="wide-to-long-adipsin-data" class="level5" data-number="3.4.2.1.1">
<h5 data-number="3.4.2.1.1" class="anchored" data-anchor-id="wide-to-long-adipsin-data"><span class="header-section-number">3.4.2.1.1</span> Wide to long – Adipsin data</h5>
<p>Source: <a href="https://www.nature.com/articles/s41591-019-0610-4" target="_blank">Adipsin preserves beta cells in diabetic mice and associates with protection from type 2 diabetes in humans</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7256970/" target="_blank">Public source</a> – the Adipsin paper is behind a paywall. A public source of the paper from NIH is available.</p>
<p><a href="https://www.nature.com/articles/s41591-019-0610-4#Sec39" target="_blank">Link to source data</a></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../images/adipsin_1k_wide.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>Fig. 1k of the Adipsin paper presents a bar plot of the glucose uptake in response to control (GFP) or <a href="https://en.wikipedia.org/wiki/Factor_D" target="_blank">adipsin</a> treatment. A screenshot of the Excel-archived data is shown above. The data are in <strong>wide format</strong>. In wide-format, the values of a single variable (here, this is glucose uptake level) are given in separate columns for each treatment level (group). The values for the GFP group are in Column A and the values for the Adipsin group are in Column B. Wide format is efficient for computations in a spreadsheet, such as computing means and standard deviations of columns of data, and for plotting.</p>
<p>For most statistical analyses of experimental data in R (and most statistics software), all values of a single variable should be in a single column. This is called <strong>long format</strong>. I’ve manually rearranged the data from the archived spread sheet into long format by stacking each group’s values into a single column, shown in the screen capture below. All values of glucose uptake are in a single column. In long format, there needs to be a way to identify which values belong to which group and this is achieved here with column “treatment”. In adition to the treatment column.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../images/adipsin_1k_long.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>The difference between wide and long also reflects how we think about statistical analysis. When we do a <em>t</em>-test to compare the means of glucose uptake between GFP and Adipsin groups, we might think we have two things: the set of glucose uptake values for the GFP group and the set of values for the Adipsin group. When we fit a linear model, we also have two things, the variable <em>treatment</em> containing treatment level assignment and the variable <em>glucose_uptake</em> containing the glucose uptake values. In wide format, there is nothing to suggest that <em>treatment</em> is a variable.</p>
<p>There are many functions to tidy data from wide to long. <code>melt</code> from the data.table package is especially useful. It is data.table’s version of melt from the reshape2 package.</p>
<p>The major arguments of <code>data.table::melt</code> are</p>
<p><code>melt(data, id.vars, measure.vars, variable.name, value.name)</code></p>
<p><code>melt</code> takes the data in the columns listed in <code>measure.vars</code> and stacks these into a single column named <code>value.name</code>. The names of the columns in <code>measure.vars</code> are the values of the elements in a new column named <code>variable.name</code>. The elements of any column in <code>id.vars</code> are repeated <em>p</em> times, where <em>p</em> is the number of columns that were stacked.</p>
<p>Let’s melt the three different response variables of the adipsin data and <code>merge</code> them into a single data.table. There are several ways to combine data sets including <code>merge</code> and <code>cbind</code>. We’ll compare these later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>file_folder <span class="ot">&lt;-</span> <span class="st">"Adipsin preserves beta cells in diabetic mice and associates with protection from type 2 diabetes in humans"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="st">"41591_2019_610_MOESM3_ESM.xlsx"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, file_folder, fn)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>treatment_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"db/db-GFP"</span>, <span class="st">"db/db-Adipsin"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># as separate line</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>fig_1k_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"Figure 1k"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A3:B9"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>fig_1k_wide <span class="ot">&lt;-</span> <span class="fu">data.table</span>(fig_1k_wide)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>fig_1k <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig_1k_wide,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">measure.vars =</span> treatment_levels,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">variable.name =</span> <span class="st">"treatment"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">value.name =</span> <span class="st">"glucose_uptake"</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># or piped -- which do you prefer?</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>fig_1k <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"Figure 1k"</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A3:B9"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>(<span class="at">measure.vars =</span> treatment_levels,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">variable.name =</span> <span class="st">"treatment"</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">value.name =</span> <span class="st">"glucose_uptake"</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig_1k) # highlight without the comment sign and "run selected lines()" to view</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A pretty-good-plot using the <code>ggpubr</code> package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># put warning=FALSE into the chunk header to supress the warning</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggstripchart</span>(<span class="at">x =</span> <span class="st">"treatment"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="st">"glucose_uptake"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">add =</span> <span class="st">"mean_se"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> fig_1k)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="wide-to-long-enteric-nervous-system-data" class="level5" data-number="3.4.2.1.2">
<h5 data-number="3.4.2.1.2" class="anchored" data-anchor-id="wide-to-long-enteric-nervous-system-data"><span class="header-section-number">3.4.2.1.2</span> Wide to long – Enteric nervous system data</h5>
<p>Source: <a href="https://doi.org/10.1371/journal.pbio.2000689" target="_blank">Rolig, A. S., Mittge, E. K., Ganz, J., Troll, J. V., Melancon, E., Wiles, T. J., … Guillemin, K. (2017). The enteric nervous system promotes intestinal health by constraining microbiota composition. PLOS Biology, 15(2), e2000689.</a></p>
<p><a href="https://doi.org/10.1371/journal.pbio.2000689.s008" target="_blank">Source data</a></p>
<p>Let’s import and reshape the data for figure 2d. Look at the excel file and the data in Fig. 2d. There is a single treament with four levels, but the authors have organized the data in each level in separate columns and used the column header as the level name.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../images/enteric_fig2d_wide.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>Let’s melt the data from wide to long by stacking the four columns into a single column “neutrophil_count” and adding a treatment column identifying the group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>folder <span class="ot">&lt;-</span> <span class="st">"The enteric nervous system promotes intestinal health by constraining microbiota composition"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"journal.pbio.2000689.s008.xlsx"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, folder, filename)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># figure 2D data</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>sheet_i <span class="ot">&lt;-</span> <span class="st">"Figure 2"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>range_i <span class="ot">&lt;-</span> <span class="st">"F2:I24"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>fig_2d_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path, <span class="at">sheet=</span>sheet_i, <span class="at">range=</span>range_i) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names by replacing without "_donor" in each name</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># these new column names will become the levels of the treatment factor</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>new_colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gf"</span>, <span class="st">"wt"</span>, <span class="st">"sox10"</span>, <span class="st">"iap_mo"</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(fig_2d_wide, <span class="at">old=</span><span class="fu">colnames</span>(fig_2d_wide), <span class="at">new=</span>new_colnames)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># wide to long</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>fig_2d <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig_2d_wide, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">measure.vars=</span><span class="fu">colnames</span>(fig_2d_wide), </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable.name=</span><span class="st">"treatment"</span>, </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">value.name=</span><span class="st">"neutrophil_count"</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># omit empty rows</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>fig_2d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(fig_2d)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># re-order factors</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>fig_2d[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"wt"</span>, <span class="st">"gf"</span>, <span class="st">"sox10"</span>, <span class="st">"iap_mo"</span>))]</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig_2d)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To learn (instead of just copy and modify), it’s best to do this in steps and not run the whole chunk. At each step, look at the result using View. The script above includes three extra wrangling steps.</p>
<ol type="1">
<li><p>Changing column names in fig_2d_wide. The column names in wide format will become the treatment level names of the <em>treatment</em> factor after reshaping. It will be easier down the road if these names are shorter and the “_donor” in each name is redundant. The <code>setnames</code> function renames the column names.</p></li>
<li><p>For these data, the number of measures within the different treatments differs and, as a consequence, there are multiple cells with <code>NA</code> which indicates a missing value. <code>View(fig_2d_wide)</code> (this can be typed in the console) to see this. After reshaping to long format (fig_2d), the rows with missing values become empty rows – there is no useful information in them (View this). To see this, re-run the lines of the chunk up to the line “# omit empty rows”. The <code>na.omit</code> function deletes any row with missing values. Here, this deletes these information-less rows. Be very careful with <code>na.omit</code>. You do not want to delete rows of data that contain information you want.</p></li>
<li><p>For both analysis and plots, we want to compare values to the control level, which is named “wt” for the fig_2d data. That is, we want “wt” to be the <em>reference</em> level. To achieve this, the levels of the factor <em>treatment</em> need to be re-ordered using the <code>levels</code> argument. (note, I typically do not add “levels =”, but simply pass the list of levels)</p></li>
</ol>
</section>
<section id="wide-to-long-bee-data" class="level5" data-number="3.4.2.1.3">
<h5 data-number="3.4.2.1.3" class="anchored" data-anchor-id="wide-to-long-bee-data"><span class="header-section-number">3.4.2.1.3</span> Wide to long – bee data</h5>
<p>The example above is pretty easy, because the all columns in the original data frame are melted (stacked). Here is an example in which only a subset of columns are stacked. In addition, only a subset of the remaining columns are retained in the long format data frame. The data are from Panel A of supplement Fig. 8 (https://journals.plos.org/plosbiology/article/file?type=supplementary&amp;id=info:doi/10.1371/journal.pbio.2003467.s019){target=“_blank”} from</p>
<p>Source: <a href="https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.2003467" target="_blank">Kešnerová, L., Mars, R.A., Ellegaard, K.M., Troilo, M., Sauer, U. and Engel, P., 2017. Disentangling metabolic functions of bacteria in the honey bee gut. PLoS biology, 15(12), p.e2003467.</a></p>
<p><a href="https://doi.org/10.1371/journal.pbio.2003467.s001" target="_blank">Source data</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>folder <span class="ot">&lt;-</span> <span class="st">"Disentangling metabolic functions of bacteria in the honey bee gut"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"journal.pbio.2003467.s001.xlsx"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># figure 2D data</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>sheet_i <span class="ot">&lt;-</span> <span class="st">"S8 Fig"</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>range_i <span class="ot">&lt;-</span> <span class="st">"A2:H12"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, folder, filename)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>fig_s8a_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sheet=</span>sheet_i,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">range=</span>range_i) <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># wide to long</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>stack_cols <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"replicate"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>fig_s8a <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig_s8a_wide,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"media"</span>, <span class="st">"time_h"</span>),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">measure.vars =</span> stack_cols, </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable.name =</span> <span class="st">"Replicate"</span>, </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">value.name =</span> <span class="st">"OD600"</span>) <span class="co"># measure of absorbance at 600nm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wide-to-long-stacking-multiple-sets-of-columns" class="level5" data-number="3.4.2.1.4">
<h5 data-number="3.4.2.1.4" class="anchored" data-anchor-id="wide-to-long-stacking-multiple-sets-of-columns"><span class="header-section-number">3.4.2.1.4</span> Wide to long – stacking multiple sets of columns</h5>
<p>Article: <a href="https://www.nature.com/articles/s42003-020-01564-2#MOESM4" target="_blank">GPR109A mediates the effects of hippuric acid on regulating osteoclastogenesis and bone resorption in mice</a></p>
<p><a href="https://www.nature.com/articles/s42003-020-01564-2#MOESM4" target="_blank">source data</a></p>
<p>The data are from Fig. 1b</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>folder <span class="ot">&lt;-</span> <span class="st">"GPR109A mediates the effects of hippuric acid on regulating osteoclastogenesis and bone resorption in mice"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"42003_2020_1564_MOESM4_ESM.xlsx"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, folder, file_name)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>fig1b_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"Fig. 1b"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"C4:R9"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>treatment_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Wild type"</span>, <span class="st">"GPR109A-/-"</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>treatment_abbrev <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wt"</span>, <span class="st">"ko"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BV/TV"</span>, <span class="st">"Tb.Th"</span>, <span class="st">"Tb.Sp"</span>, <span class="st">"Tb.N"</span>, <span class="st">"BMD"</span>, <span class="st">"Cs.Th"</span>, <span class="st">"BV"</span>, <span class="st">"MA"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>new_colnames <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                              treatment_abbrev,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(fig1b_wide,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">old =</span> <span class="fu">colnames</span>(fig1b_wide),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> new_colnames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">BV/TV_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BV/TV_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.Th_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.Th_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.Sp_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.Sp_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.N_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.N_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BMD_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BMD_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cs.Th_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cs.Th_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BV_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BV_ko</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MA_wt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MA_ko</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5.229493</td>
<td style="text-align: right;">6.697880</td>
<td style="text-align: right;">0.0379685</td>
<td style="text-align: right;">0.0436415</td>
<td style="text-align: right;">0.3383573</td>
<td style="text-align: right;">0.3507201</td>
<td style="text-align: right;">1.377323</td>
<td style="text-align: right;">1.534749</td>
<td style="text-align: right;">0.0927138</td>
<td style="text-align: right;">0.1125594</td>
<td style="text-align: right;">0.1363595</td>
<td style="text-align: right;">0.1445718</td>
<td style="text-align: right;">0.2296399</td>
<td style="text-align: right;">0.2250816</td>
<td style="text-align: right;">0.3832690</td>
<td style="text-align: right;">0.4268379</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.171787</td>
<td style="text-align: right;">7.271222</td>
<td style="text-align: right;">0.0386800</td>
<td style="text-align: right;">0.0425357</td>
<td style="text-align: right;">0.3579566</td>
<td style="text-align: right;">0.3946835</td>
<td style="text-align: right;">1.337071</td>
<td style="text-align: right;">1.709440</td>
<td style="text-align: right;">0.0930417</td>
<td style="text-align: right;">0.1129723</td>
<td style="text-align: right;">0.1387652</td>
<td style="text-align: right;">0.1430709</td>
<td style="text-align: right;">0.1946119</td>
<td style="text-align: right;">0.2422370</td>
<td style="text-align: right;">0.4216582</td>
<td style="text-align: right;">0.3553190</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.287585</td>
<td style="text-align: right;">9.873900</td>
<td style="text-align: right;">0.0385307</td>
<td style="text-align: right;">0.0438999</td>
<td style="text-align: right;">0.4401164</td>
<td style="text-align: right;">0.3019478</td>
<td style="text-align: right;">1.112770</td>
<td style="text-align: right;">2.249185</td>
<td style="text-align: right;">0.0782485</td>
<td style="text-align: right;">0.1330846</td>
<td style="text-align: right;">0.1334085</td>
<td style="text-align: right;">0.1588262</td>
<td style="text-align: right;">0.1568608</td>
<td style="text-align: right;">0.3700646</td>
<td style="text-align: right;">0.3620063</td>
<td style="text-align: right;">0.4698913</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.308528</td>
<td style="text-align: right;">5.557610</td>
<td style="text-align: right;">0.0374626</td>
<td style="text-align: right;">0.0372947</td>
<td style="text-align: right;">0.3576182</td>
<td style="text-align: right;">0.3328132</td>
<td style="text-align: right;">1.150088</td>
<td style="text-align: right;">1.490186</td>
<td style="text-align: right;">0.0841214</td>
<td style="text-align: right;">0.1007773</td>
<td style="text-align: right;">0.1369047</td>
<td style="text-align: right;">0.1288561</td>
<td style="text-align: right;">0.1555844</td>
<td style="text-align: right;">0.2050777</td>
<td style="text-align: right;">0.3661425</td>
<td style="text-align: right;">0.4413361</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.175202</td>
<td style="text-align: right;">6.673029</td>
<td style="text-align: right;">0.0406120</td>
<td style="text-align: right;">0.0400175</td>
<td style="text-align: right;">0.4541035</td>
<td style="text-align: right;">0.3604716</td>
<td style="text-align: right;">1.274303</td>
<td style="text-align: right;">1.667530</td>
<td style="text-align: right;">0.0921535</td>
<td style="text-align: right;">0.1189364</td>
<td style="text-align: right;">0.1299124</td>
<td style="text-align: right;">0.1438411</td>
<td style="text-align: right;">0.1521829</td>
<td style="text-align: right;">0.2224382</td>
<td style="text-align: right;">0.3578702</td>
<td style="text-align: right;">0.4556137</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>To analyze each response, the two treatment levels for each measure need to be stacked into a single column. This is easy using <code>melt</code> from the data.table package. Add this to your chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig1b <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig1b_wide,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">measure.vars =</span> <span class="fu">list</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"BV/TV_wt"</span>, <span class="st">"BV/TV_ko"</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"Tb.Th_wt"</span>, <span class="st">"Tb.Th_ko"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"Tb.Sp_wt"</span>, <span class="st">"Tb.Sp_ko"</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"Tb.N_wt"</span>, <span class="st">"Tb.N_ko"</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"BMD_wt"</span>, <span class="st">"BMD_ko"</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"Cs.Th_wt"</span>, <span class="st">"Cs.Th_ko"</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"BV_wt"</span>, <span class="st">"BV_ko"</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">c</span>(<span class="st">"MA_wt"</span>, <span class="st">"MA_ko"</span>)),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable.name =</span> <span class="st">"treatment_id"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">value.name =</span> measures)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>fig1b[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(treatment_id <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                            treatment_levels[<span class="dv">1</span>],</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                            treatment_levels[<span class="dv">2</span>])]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>fig1b[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> treatment_levels)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BV/TV</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.Th</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.Sp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tb.N</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BMD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cs.Th</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BV</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MA</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">5.229493</td>
<td style="text-align: right;">0.0379685</td>
<td style="text-align: right;">0.3383573</td>
<td style="text-align: right;">1.377323</td>
<td style="text-align: right;">0.0927138</td>
<td style="text-align: right;">0.1363595</td>
<td style="text-align: right;">0.2296399</td>
<td style="text-align: right;">0.3832690</td>
<td style="text-align: left;">Wild type</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">5.171787</td>
<td style="text-align: right;">0.0386800</td>
<td style="text-align: right;">0.3579566</td>
<td style="text-align: right;">1.337071</td>
<td style="text-align: right;">0.0930417</td>
<td style="text-align: right;">0.1387652</td>
<td style="text-align: right;">0.1946119</td>
<td style="text-align: right;">0.4216582</td>
<td style="text-align: left;">Wild type</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">4.287585</td>
<td style="text-align: right;">0.0385307</td>
<td style="text-align: right;">0.4401164</td>
<td style="text-align: right;">1.112770</td>
<td style="text-align: right;">0.0782485</td>
<td style="text-align: right;">0.1334085</td>
<td style="text-align: right;">0.1568608</td>
<td style="text-align: right;">0.3620063</td>
<td style="text-align: left;">Wild type</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">4.308528</td>
<td style="text-align: right;">0.0374626</td>
<td style="text-align: right;">0.3576182</td>
<td style="text-align: right;">1.150088</td>
<td style="text-align: right;">0.0841214</td>
<td style="text-align: right;">0.1369047</td>
<td style="text-align: right;">0.1555844</td>
<td style="text-align: right;">0.3661425</td>
<td style="text-align: left;">Wild type</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">5.175202</td>
<td style="text-align: right;">0.0406120</td>
<td style="text-align: right;">0.4541035</td>
<td style="text-align: right;">1.274303</td>
<td style="text-align: right;">0.0921535</td>
<td style="text-align: right;">0.1299124</td>
<td style="text-align: right;">0.1521829</td>
<td style="text-align: right;">0.3578702</td>
<td style="text-align: left;">Wild type</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="reshaping-data-transpose-turning-the-columns-into-rows" class="level4" data-number="3.4.2.2">
<h4 data-number="3.4.2.2" class="anchored" data-anchor-id="reshaping-data-transpose-turning-the-columns-into-rows"><span class="header-section-number">3.4.2.2</span> Reshaping data – Transpose (turning the columns into rows)</h4>
<section id="transpose-pi3k-inhibitors-data" class="level5" data-number="3.4.2.2.1">
<h5 data-number="3.4.2.2.1" class="anchored" data-anchor-id="transpose-pi3k-inhibitors-data"><span class="header-section-number">3.4.2.2.1</span> Transpose – PI3K inhibitors data</h5>
<p>Source: <a href="https://www.nature.com/articles/s41586-018-0343-4">Suppression of insulin feedback enhances the efficacy of PI3K inhibitors</a></p>
<p><a href="https://www.nature.com/articles/s41586-018-0343-4#Sec15">Source data</a></p>
<p>Figure 3A of this publication is a plot of blood glucose level taken on the same individual mice from four treatment groups over six time periods. Data on a single variable such as blood glucose, taken on the same individual at multiple time points, are known as <strong>longitudial data</strong> but are often mistakenly called <strong>repeated measures data</strong>. There are mulitple ways to analyze longitudinal data, some goood, some less good. There are two reasonable ways to archive longitudinal data for analysis in R. The Excel-archived data for Figure 3A is neither. A screen capture of two of the four treatment groups is shown below.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../images/pi3k-inhibitors.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>In the archived data the individual mice are in columns. The measure at each time point is in rows. And the treatment group is in blocks. Typical data for analysis in R should have the individual mice in rows and each variable in columns (an exception in experimental biology is omics data, such as RNA expression levels. Many packages with functions to analyze these data have the genes on each row and the individual on each column). The Figure 3A data are turned on its side. We need to <strong>transpose</strong> the data, or rotate the matrix 90 degrees (make the columns rows and the rows columns) to turn the data into wide format. From this we can create a new data.table with the data in long format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>folder <span class="ot">&lt;-</span> <span class="st">"Suppression of insulin feedback enhances the efficacy of PI3K inhibitors"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"41586_2018_343_MOESM6_ESM.xlsx"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, folder, filename)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>pi3k_side <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"Figure 3A (Blood Glucose)"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A2:U7"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># give columns names as the treatment of each mouse</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># verify n=5 per group</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>treatment_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Chow"</span>, <span class="st">"Ketogenic"</span>, <span class="st">"Metformin"</span>, <span class="st">"SGLT2i"</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pi3k_side) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rep</span>(treatment_levels, <span class="at">each =</span> <span class="dv">5</span>))</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># keep colnames in "side" as values of treatment col in "wide"</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make values of "time" in "side" the colnames in "wide"</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>pi3k_wide <span class="ot">&lt;-</span> <span class="fu">transpose</span>(pi3k_side,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">keep.names =</span> <span class="st">"treatment"</span>, </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">make.names =</span> <span class="st">"time"</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># make a baseline column </span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>pi3k_wide[, glucose_0 <span class="sc">:</span><span class="er">=</span> <span class="fu">get</span>(<span class="st">"0"</span>)]</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># make-up a mouse id for each mouse</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>pi3k_wide[, id <span class="sc">:</span><span class="er">=</span> <span class="fu">paste</span>(treatment, <span class="dv">1</span><span class="sc">:</span>.N, <span class="at">sep =</span> <span class="st">"_"</span>), by <span class="ot">=</span> treatment]</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># make treatement a factor with "chow" as reference</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>pi3k_wide[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment, treatment_levels)]</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># make a long version</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>pi3k_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(pi3k_wide,</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"id"</span>, <span class="st">"glucose_0"</span>),</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variable.name =</span> <span class="st">"time"</span>,</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value.name =</span> <span class="st">"glucose"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes</p>
<ol type="1">
<li>Read the comments on the usage of the <code>keep.names</code> and <code>make.names</code> arguments of <code>transpose</code>. These are powerful.</li>
<li>pi3k_wide has column names that are times (in minutes). This presents wrangling problems (column names shouldn’t be numbers. Here it is useful to create the long format data.table with a time column of numbers). For example, the code above creates copies the column “0” into a new column “glucose_0” using <code>glucose_0 := get("0")</code>. Had the code been <code>glucose_0 := "0"</code>, all values would be the character “0”. Had the code been <code>glucose_0 := 0</code>, all values would be the number 0. <code>get</code> looks for the column with the name of whatever is inside the parentheses.</li>
</ol>
<p>Let’s do a quick plot to examine the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `qplot()` was deprecated in ggplot2 3.4.0.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="combining-data" class="level4" data-number="3.4.2.3">
<h4 data-number="3.4.2.3" class="anchored" data-anchor-id="combining-data"><span class="header-section-number">3.4.2.3</span> Combining data</h4>
<p>Source <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0200817">Bak, A.M., Vendelbo, M.H., Christensen, B., Viggers, R., Bibby, B.M., Rungby, J., Jørgensen, J.O.L., Møller, N. and Jessen, N., 2018. Prolonged fasting-induced metabolic signatures in human skeletal muscle of lean and obese men. PloS one, 13(9), p.e0200817.</a></p>
<p><a href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.6121hj7">Source data</a></p>
<p>The data are from a randomized <strong>crossover</strong> design where 18 men (9 lean and 9 obese) were measured for multiple metabolic markers at two times: 1) in a post-absorptive state after 12 hours overnight fast, and 2) in a prolonged fasting state after 72 hours of fasting. In addition, at each time point, metabolic markers were measured prior to and after an insulin infusion. Here, we want to reproduce values in Table 2, which are measures of mean blood insulin and metabolite levels after 12 hours and 72 hours fasting in both the lean and obese groups.</p>
<p>A difficulty for the analyst is that the response data are in the “Table 2” sheet but the variable containing the assignment to “lean” or “obese” group is in the “Table 1” sheet. To analyze these response, the two datasets need to be combined into a single data frame. The important consideration when combining data is that <em>like is matched with like</em>. For the fasting dataset, “like” is the subject id, and we have some data for each subject id in Table 1 and other data for the same subject ids in Table 2. This means that we essentially want to glue the columns of table 2 to the columns of table 1 in a way that insures that the correct data for each subject id is on the same row. This is a bit more complicated for these data because Table 1 contains 18 data rows, one for each subject id and Table 2 contains 36 data rows, 2 for each subject id, because each subject has data measured at 12 hours and at 72 hours.</p>
</section>
<section id="data-subset" class="level4" data-number="3.4.2.4">
<h4 data-number="3.4.2.4" class="anchored" data-anchor-id="data-subset"><span class="header-section-number">3.4.2.4</span> Subsetting data</h4>
<p>It is common to see researchers create multiple subsets of data for further processing. This practice should be be discouraged because the same variables will be in multiple data frames and it can be hard to keep track of any processing of variables in the different datasets. Instead, subset the data at the level of analysis.</p>
<p>There are many ways to subset data in R. Experienced users tend to divide up into those using base R, those using the tidyverse packages, or those using data.table. Learn one well. This book uses data.table. Before outlining usage in data.table, let’s back up a bit and review different <em>indexing</em> systems.</p>
<ul>
<li>In Excel, rows are specified (or “indexed”) by numbers and columns by letters. Every cell has an address, for example C2 is the cell in the 2nd row and 3rd column. Notice that in Excel, the column part of the address comes before the row part.</li>
<li>In statistics, it is extremely common to use a system where <span class="math inline">\(x_{ij}\)</span> is the value of the element in the <em>i</em>th row and <em>j</em>th column of the matrix <strong>X</strong>. Notice that in this notatin, the row index (<em>i</em>) comes before the column index (<em>j</em>).</li>
<li>In programming languages, including R, it is extremely common to use a system where my_data[i, j] is the value of the element in the <em>i</em>th row and <em>j</em>th column of the matrix-like object named “my_data” (such as a data frame in R).</li>
<li>data.table explicitly refers to the row index and column index as <em>i</em> and <em>j</em>.</li>
</ul>
<section id="specifying-a-subset-of-rows-observations-or-cases" class="level5" data-number="3.4.2.4.1">
<h5 data-number="3.4.2.4.1" class="anchored" data-anchor-id="specifying-a-subset-of-rows-observations-or-cases"><span class="header-section-number">3.4.2.4.1</span> Specifying a subset of rows (“observations” or “cases”)</h5>
<p>A subset of rows is specified using either a list of row numbers or</p>
<p>In a data.table, a subset of rows is specified using either a list of row numbers or a combination of comparison operators (==, !=, &gt;, &lt;, &gt;=, &lt;=, %in%) and Boolean logic operators (&amp;, |, ! – these are “and”, “or”, “not”) as <em>i</em>.</p>
<p>Let’s use the pi3k_long data from above to explore this. First, the plot of plasma glucose for all individuals in each treatment group across all time points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p><code>pi3k_long[treatment == "Chow",])</code> is the subset of rows in which entries in the column “treatment” take the value “Chow” using the “is equal” (“==”) operator</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long[treatment <span class="sc">==</span> <span class="st">"Chow"</span>,],</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>And the subset of rows in which entries in the column “treatment” take any value but “Chow” using the “not equal” operator (“!=”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long[treatment <span class="sc">!=</span> <span class="st">"Chow"</span>,],</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The subset of rows in which entries in the column “treatment” take either the value “Chow” or the value “SGLT2i” by combining two “is equal” (“==”) operators using the OR (“|”) boolean operator</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long[treatment <span class="sc">==</span> <span class="st">"Chow"</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="st">"SGLT2i"</span>,],</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The subset of rows in which entries in the column “time” take either the value “30” or the value “60” using the “in a list” operator (%in%). The values in the “time” column look like integers but are actually treatment levels (which act like string or character variables).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long[time  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"30"</span>, <span class="st">"60"</span>),],</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The subset of rows in which entries in the column “time_c” are less than or equal to 60 using the “less than or equal to” operator AND the value in the treatment column is in the list (“Chow”, “SGLT2i”). The two comparisons are combined with the AND (“&amp;”) Boolean operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pi3k_long[, time_c <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(time))]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long[time_c <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> treatment <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Chow"</span>, <span class="st">"SGLT2i"</span>),],</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The same result as above but using different operators. I would describe this as, the subset of rows in which entries in the column “time_c” are less than or equal to 60 using the “less than or equal to” operator AND the value in the treatment column is either “Chow” OR “SGLT2i”. The two comparisons are combined with the AND (“&amp;”) Boolean operator. The order of operations is determined by the parentheses, as with all algebra.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pi3k_long[, time_c <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(time))]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> time,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> glucose,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pi3k_long[time_c <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> (treatment <span class="sc">==</span> <span class="st">"Chow"</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="st">"SGLT2i"</span>),],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> treatment) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="wrangling-columns" class="level4" data-number="3.4.2.5">
<h4 data-number="3.4.2.5" class="anchored" data-anchor-id="wrangling-columns"><span class="header-section-number">3.4.2.5</span> Wrangling columns</h4>
<section id="creating-new-columns-that-are-functions-of-values-in-existing-columnes" class="level5" data-number="3.4.2.5.1">
<h5 data-number="3.4.2.5.1" class="anchored" data-anchor-id="creating-new-columns-that-are-functions-of-values-in-existing-columnes"><span class="header-section-number">3.4.2.5.1</span> Creating new columns that are functions of values in existing columnes</h5>
<p>data.table allows math within the index arguments.</p>
<p><strong>Example 1: create a new column whose value is a function of values in other columns</strong></p>
<p>In this example, I create a column that contains the number of marked cells as a percent of the total cell count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count to fraction - but probably want to analyze as a count! See xxx</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>figx[, marked_cells_perc <span class="sc">:</span><span class="er">=</span> marked_cells<span class="sc">/</span>total_cells <span class="sc">*</span> <span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes</p>
<ol type="1">
<li><span class="math inline">\(\texttt{marked\_cells}\)</span> and <span class="math inline">\(\texttt{total\_cells}\)</span> are columns in the data.table <code>figx</code></li>
<li>You almost certainly want to analyze the original count column and use <span class="math inline">\(\texttt{total\_cells}\)</span> as an offset in the model. See the section <a href="#glm_offset">Use a GLM with an offset instead of a ratio of some measurement per total</a></li>
</ol>
<p><strong>Example 2: create a new column whose value is a function of values in other columns</strong></p>
<p>In this example, I create the column <span class="math inline">\(\texttt{glucose\_auc}\)</span>, which is the area under the curve of glucose measures at the different time points of glucose tolerance test. This computation requires the <code>auc</code> function below (typically, I put chunks with functions at the top of a R Markdown document). The computation uses the base R <code>apply</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">method=</span><span class="st">"auc"</span>){</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># method = "auc", auc computed using trapezoidal calc</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># method = "iauc" is an incremental AUC of Le Floch</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># method = "pos.iauc" is a "positive" incremental AUC of Le Floch but not Wolever</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># method = "pb.auc" is AUC of post-time0 values</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(method<span class="sc">==</span><span class="st">"iauc"</span>){y <span class="ot">&lt;-</span> y <span class="sc">-</span> y[<span class="dv">1</span>]}</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(method<span class="sc">==</span><span class="st">"pos.iauc"</span>){y[y <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>}</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(method<span class="sc">==</span><span class="st">"pb.auc"</span>){</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> y[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  area <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n){</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    area <span class="ot">&lt;-</span> area <span class="sc">+</span> (x[i] <span class="sc">-</span> x[i<span class="dv">-1</span>])<span class="sc">*</span>(y[i<span class="dv">-1</span>] <span class="sc">+</span> y[i])</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  area<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the implementation. The object <code>time_cols</code> is a vector containing the names of the columns containing the data at each time point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>time_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time_0"</span>, <span class="st">"time_15"</span>, <span class="st">"time_30"</span>, <span class="st">"time_60"</span>, <span class="st">"time_90"</span>, <span class="st">"time_120"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> figx_wide[, .SD, .SDcols <span class="ot">=</span> time_cols]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>figx_wide[, glucose_auc <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(Y, <span class="dv">1</span>, auc, <span class="at">x =</span> times)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="change-the-reference-level-of-a-factor" class="level5" data-number="3.4.2.5.2">
<h5 data-number="3.4.2.5.2" class="anchored" data-anchor-id="change-the-reference-level-of-a-factor"><span class="header-section-number">3.4.2.5.2</span> Change the reference level of a factor</h5>
<p>Factor levels should always be arranged in a sensible order both for model fitting and for plotting. The first level in the vector is the reference level, which is an important concept for understanding the coefficients of the statistical models fit in this book.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>treatment_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"KO"</span>, <span class="st">"KO_drug"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>figx[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> treatment_levels)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="converting-a-single-column-with-all-combinations-of-a-2-x-2-factorial-experiment-into-two-columns-each-containing-the-two-levels-of-a-factor" class="level5" data-number="3.4.2.5.3">
<h5 data-number="3.4.2.5.3" class="anchored" data-anchor-id="converting-a-single-column-with-all-combinations-of-a-2-x-2-factorial-experiment-into-two-columns-each-containing-the-two-levels-of-a-factor"><span class="header-section-number">3.4.2.5.3</span> Converting a single column with all combinations of a 2 x 2 factorial experiment into two columns, each containing the two levels of a factor</h5>
<section id="example-1-tstrspl" class="level6" data-number="3.4.2.5.3.1">
<h6 data-number="3.4.2.5.3.1" class="anchored" data-anchor-id="example-1-tstrspl"><span class="header-section-number">3.4.2.5.3.1</span> Example 1 (tstrspl)</h6>
<p>The example data are analyzed in the chapter <a href="#factorial">Linear models with two categorical <span class="math inline">\(X\)</span> – Factorial linear models (“two-way ANOVA”)</a></p>
<p>Article source: <a href="https://www.nature.com/articles/s41586-020-1992-7" target="_blank">TLR9 and beclin 1 crosstalk regulates muscle AMPK activation in exercise</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7047589/" target="_blank">Public source</a></p>
<p>The data are from Figure 2j.</p>
<p><a href="https://www.nature.com/articles/s41586-020-1992-7#Sec27" target="_blank">Data source</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"TLR9 and beclin 1 crosstalk regulates muscle AMPK activation in exercise"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41586_2020_1992_MOESM4_ESM.xlsx"</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>treatment_levels  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"WT Resting"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"WT Active"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Tlr9-/- Resting"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Tlr9-/- Active"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>fig2j_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="st">"2j"</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">range =</span> <span class="st">"A5:D13"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fig2j_wide) <span class="ot">&lt;-</span> treatment_levels</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>fig2j <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig2j_wide,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">measure.vars =</span> treatment_levels,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable.name =</span> <span class="st">"treatment"</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">value.name =</span> <span class="st">"glucose_uptake"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="co"># danger!</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>fig2j[, <span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"stimulation"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(treatment,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">" "</span>,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>genotype_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"Tlr9-/-"</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>stimulation_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Resting"</span>, <span class="st">"Active"</span>)</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>fig2j[, genotype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(genotype,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> genotype_levels)]</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>fig2j[, stimulation <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(stimulation,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> stimulation_levels)]</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig2j)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Melting the wide data creates a column <span class="math inline">\(\texttt{treatment}\)</span> containing the column names of the wide data. The column type is character (often called “string” because each the variable is a string of characters). We want to split the string at the space, and put the first part into one new column and the second part into a second new column.</li>
<li>The <code>tstrsplit()</code> function from the data.table package does this split for us. The first argument is the name of the column that contains the strings that we want to split. The second argument is the character that we want to split on. <code>c("genotype", "stimulation")</code> before <code>:=</code> sets the names of the new columns containing. This is a really elegant solution.</li>
<li>I replaced the original column names of initial import for several reasons:</li>
</ol>
<ul>
<li>“Electrical Stimulation” is too long and will make the coefficient names unwieldy. This could be shortened to “Stimulation”, but…</li>
<li>I don’t want a factor name to include a level with the same name. I like the factor name <span class="math inline">\(\texttt{stimulation}\)</span>, so I I renamed the level “Electrical Stimulation” to “Active”.</li>
<li>We are splitting the column names using the space character ” ” and two of the original column names have two spaces, the 2nd inside what should be a single level (“Electrical Stimulation”)</li>
<li>The read_excel function removed a space in the last column name, which is read as “Tlr9-/-Electrical Stimulation”.</li>
</ul>
<p>Here is a peek at the data prior to melting wide to long</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">WT Resting</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WT Active</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tlr9-/- Resting</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tlr9-/- Active</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5.437741</td>
<td style="text-align: right;">9.511914</td>
<td style="text-align: right;">7.969706</td>
<td style="text-align: right;">7.793486</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.026892</td>
<td style="text-align: right;">9.901527</td>
<td style="text-align: right;">9.660112</td>
<td style="text-align: right;">9.561649</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7.731616</td>
<td style="text-align: right;">13.038920</td>
<td style="text-align: right;">6.709424</td>
<td style="text-align: right;">8.055529</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.285710</td>
<td style="text-align: right;">9.665391</td>
<td style="text-align: right;">5.259744</td>
<td style="text-align: right;">7.739374</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7.343797</td>
<td style="text-align: right;">8.590693</td>
<td style="text-align: right;">8.244721</td>
<td style="text-align: right;">10.312190</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>And a peek of the first three and last three rows after the melt.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">glucose_uptake</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stimulation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">WT Resting</td>
<td style="text-align: right;">5.437741</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">Resting</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Resting</td>
<td style="text-align: right;">6.026892</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">Resting</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Resting</td>
<td style="text-align: right;">7.731616</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">Resting</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tlr9-/- Active</td>
<td style="text-align: right;">10.312190</td>
<td style="text-align: left;">Tlr9-/-</td>
<td style="text-align: left;">Active</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tlr9-/- Active</td>
<td style="text-align: right;">7.943574</td>
<td style="text-align: left;">Tlr9-/-</td>
<td style="text-align: left;">Active</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tlr9-/- Active</td>
<td style="text-align: right;">9.292673</td>
<td style="text-align: left;">Tlr9-/-</td>
<td style="text-align: left;">Active</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="example-2" class="level6" data-number="3.4.2.5.3.2">
<h6 data-number="3.4.2.5.3.2" class="anchored" data-anchor-id="example-2"><span class="header-section-number">3.4.2.5.3.2</span> Example 2</h6>
<p>Source: <a href="2018">Tauriello, D., Palomo-Ponce, S., Stork, D. et al.&nbsp;TGFβ drives immune evasion in genetically reconstituted colon cancer metastasis. Nature 554, 538–543</a> doi:10.1038/nature25492</p>
<p><a href="https://www.nature.com/articles/nature25492#Sec23">Source data</a></p>
<p>filename: “41586_2018_BFnature25492_MOESM10_ESM.xlsx”</p>
<p>sheet: “Fig. 4h-tumours”</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in warn_micro_mu(string = string, replace = replace): Watch out!  The mu or micro symbol is in the input string, and may have been converted to 'm' while 'u' may have been expected.  Consider adding the following to the `replace` argument:
The following characters are in the names to clean but are not replaced: \u00b5</code></pre>
</div>
</div>
<p>The analysis of the data in Fig. 4h specifies a single <span class="math inline">\(X\)</span> variable “Treatment” with four levels (or groups): “Con”, “Gal”, “aPD-L1”, and “Gal+aPD-L1”. These levels indicate that the design is actually <strong>factorial</strong> with two factors, each with two levels. The first factor has levels “no Gal” and “Gal”. The second factor has levels “no aPD-L1”, “aPD-L1”. The single column Treatment “flattens” the 2 X 2 factorial design to a 4 x 1 design. In general, we would want to analyze an experiment like this as factorial model, because this allows us to make inferences about the <em>interaction effect</em> between the two factors. For these inferences, we need a standard error, or a confidence interval, or a <em>p</em>-value of the estimate, which we can easily get from the factorial model. In order to analyze the data with a factorial model, we need to create two new columns – one column is the factor variable containing the two levels of Gal and one column is the factor variable containing the two levels of aPD-L1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>gal_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"no Gal"</span>, <span class="st">"Gal"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>tumor[, gal <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(treatment <span class="sc">==</span> <span class="st">"Gal"</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="st">"Gal+aPD-L1"</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                      gal_levels[<span class="dv">2</span>],</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                      gal_levels[<span class="dv">1</span>])]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>apd_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"no aPD-L1"</span>, <span class="st">"aPD-L1"</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>tumor[, apdl1 <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(treatment <span class="sc">==</span> <span class="st">"aPD-L1"</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="st">"Gal+aPD-L1"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                      apd_levels[<span class="dv">2</span>],</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                      apd_levels[<span class="dv">1</span>])]</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># re-order factor levels</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>tumor[, gal<span class="sc">:</span><span class="er">=</span><span class="fu">factor</span>(gal, gal_levels)]</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>tumor[, apdl1<span class="sc">:</span><span class="er">=</span><span class="fu">factor</span>(apdl1, apd_levels)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A way to check the results to make sure that our conversion is correct is to compute the sample size for the 2 x 2 combinations, but include the original treatment column in the <code>by</code> list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tumor[<span class="sc">!</span><span class="fu">is.na</span>(num_positive_per_mm), .(<span class="at">N=</span>.N), by<span class="ot">=</span>.(treatment, gal, apdl1)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    treatment    gal     apdl1     N
       &lt;char&gt; &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;
1:        Con no Gal no aPD-L1   124
2:        Gal    Gal no aPD-L1    89
3:     aPD-L1 no Gal    aPD-L1   101
4: Gal+aPD-L1    Gal    aPD-L1    58</code></pre>
</div>
</div>
<p>That looks good.</p>
<p><strong>Bug alert</strong> If you break Rule #1, and type in the treatment level “Gal+aPD-L1” as “Gal + aPD-L1”, then you will get new columns containing junk.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    treatment    gal     apdl1     N
       &lt;char&gt; &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;
1:        Con no Gal no aPD-L1   124
2:        Gal    Gal no aPD-L1    89
3:     aPD-L1 no Gal    aPD-L1   101
4: Gal+aPD-L1 no Gal no aPD-L1    58</code></pre>
</div>
</div>
<p>Remember Rule #1. Always copy and paste any text that will be inserted into quotes. This is easily done here by typing <code>unique(tumor$treatment)</code> into the console. This function returns the unique values of the column “treatment” of the data.table “tumor”.</p>
<blockquote class="blockquote">
<p>unique(tumor$treatment) [1] “Con” “Gal” “aPD-L1” “Gal+aPD-L1”</p>
</blockquote>
<p>Now, copy the name of a level and paste into your code. Repeat until done.</p>
</section>
</section>
</section>
<section id="missing-data" class="level4" data-number="3.4.2.6">
<h4 data-number="3.4.2.6" class="anchored" data-anchor-id="missing-data"><span class="header-section-number">3.4.2.6</span> Missing data</h4>
<p>Source: <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1008002">Deletion of Cdkn1b in ACI rats leads to increased proliferation and pregnancy-associated changes in the mammary gland due to perturbed systemic endocrine environment</a></p>
<p><a href="https://doi.org/10.1371/journal.pgen.1008002.s008">Source data</a></p>
<p>Supplement Figure 1F of this paper shows weight as a function of age class and genotype for the whole body and 8 organs. There are some missing weights in the Excel-archived data. These missing data are designated with a minus “-” sign. To import these data in correctly, use the <code>na =</code> argument in the <code>read_excel</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>file_folder <span class="ot">&lt;-</span> <span class="st">"Deletion of Cdkn1b in ACI rats leads to increased proliferation and pregnancy-associated changes in the mammary gland due to perturbed systemic endocrine environment"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"journal.pgen.1008002.s008.xlsx"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, file_folder, file_name)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>fig_s1f <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"all weights"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A2:K57"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na =</span> <span class="st">"-"</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>fig_s1f[, genotype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(genotype, <span class="fu">c</span>(<span class="st">"+/+"</span>, <span class="st">"-/-"</span>))]</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>fig_s1f[, age_class <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(age_at_sac_wks <span class="sc">&lt;=</span> <span class="fl">6.0</span>, <span class="st">"4-6"</span>, <span class="st">"8+"</span>)]</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig_s1f)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes</p>
<ol type="1">
<li>In R, a value of “NA” represents missing.</li>
<li>The default value for <code>na =</code> is an empty (or blank) cell (not a space but a cell that is empty).</li>
<li><code>na =</code> accepts a list of strings, for example <code>na = c("", "-99", "--")</code> that will all be read as na.</li>
</ol>
<section id="handling-missing-data" class="level5" data-number="3.4.2.6.1">
<h5 data-number="3.4.2.6.1" class="anchored" data-anchor-id="handling-missing-data"><span class="header-section-number">3.4.2.6.1</span> Handling missing data</h5>
<section id="many-base-r-functions-used-for-summary-measures-require-na-handling" class="level6" data-number="3.4.2.6.1.1">
<h6 data-number="3.4.2.6.1.1" class="anchored" data-anchor-id="many-base-r-functions-used-for-summary-measures-require-na-handling"><span class="header-section-number">3.4.2.6.1.1</span> Many base R functions used for summary measures require NA handling</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fig_s1f[, ovary]) <span class="co"># returns "NA"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fig_s1f[, ovary], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># returns the mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2489524</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(fig_s1f[, ovary]) <span class="co"># returns "NA"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(fig_s1f[, ovary], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># returns the mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.151694</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fig_s1f[, ovary]) <span class="co"># returns "NA"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fig_s1f[, ovary], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co"># returns the mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.456</code></pre>
</div>
</div>
<p>There are many ways to get the sample size for a particular variable. Be careful if using <code>length()</code> which counts NA as part of the vector of values.</p>
</section>
<section id="the-is.na-function-is-useful" class="level6" data-number="3.4.2.6.1.2">
<h6 data-number="3.4.2.6.1.2" class="anchored" data-anchor-id="the-is.na-function-is-useful"><span class="header-section-number">3.4.2.6.1.2</span> The !is.na function is useful</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(fig_s1f[, ovary])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(fig_s1f[<span class="sc">!</span><span class="fu">is.na</span>(ovary), ovary])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42</code></pre>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li><code>!is.na(ovary)</code> is taking the subset of rows of fig_s1f for which the value of “ovary” is not NA (!is.na is read “not is.na”)</li>
</ol>
<p>This is especially useful if you are creating your own code uses counts. Here I create a table of means, standard error of the mean, and 95% CIs of the mean for each genotype group. But first, this script generates the wrong N for each group (since there are missing values), although the mean and SD are correct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fig_s1f[, .(<span class="at">mean =</span> <span class="fu">mean</span>(spleen, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> .N,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sd</span>(spleen, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">=</span> genotype]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   genotype      mean     n         sd
     &lt;fctr&gt;     &lt;num&gt; &lt;int&gt;      &lt;num&gt;
1:      -/- 0.5801333    21 0.13680480
2:      +/+ 0.2956667    34 0.04460855</code></pre>
</div>
</div>
<p>To compute the correct <em>n</em>, which will be necessary for computing the SE and the CI, use <code>!is.na</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>spleen_summary <span class="ot">&lt;-</span> fig_s1f[<span class="sc">!</span><span class="fu">is.na</span>(spleen), .(<span class="at">mean =</span> <span class="fu">mean</span>(spleen),</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> .N,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sd</span>(spleen)),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>        by <span class="ot">=</span> genotype]</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>spleen_summary[, se <span class="sc">:</span><span class="er">=</span> sd<span class="sc">/</span><span class="fu">sqrt</span>(n)]</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>spleen_summary[, lower <span class="sc">:</span><span class="er">=</span> mean <span class="sc">+</span> se<span class="sc">*</span><span class="fu">qt</span>(.<span class="dv">025</span>, (n<span class="dv">-1</span>))]</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>spleen_summary[, upper <span class="sc">:</span><span class="er">=</span> mean <span class="sc">+</span> se<span class="sc">*</span><span class="fu">qt</span>(.<span class="dv">975</span>, (n<span class="dv">-1</span>))]</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>spleen_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   genotype      mean     n         sd         se     lower     upper
     &lt;fctr&gt;     &lt;num&gt; &lt;int&gt;      &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;
1:      -/- 0.5801333    15 0.13680480 0.03532285 0.5043734 0.6558933
2:      +/+ 0.2956667    27 0.04460855 0.00858492 0.2780201 0.3133132</code></pre>
</div>
</div>
</section>
<section id="ggplot-functions-automatically-handle-missing-values" class="level6" data-number="3.4.2.6.1.3">
<h6 data-number="3.4.2.6.1.3" class="anchored" data-anchor-id="ggplot-functions-automatically-handle-missing-values"><span class="header-section-number">3.4.2.6.1.3</span> ggplot functions automatically handle missing values</h6>
<p>with a useful warning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> body_wt_g_sac,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> spleen,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> genotype,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> fig_s1f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regression-model-functions-lm-glm-gls-etc.-handle-missing-values-by-default" class="level6" data-number="3.4.2.6.1.4">
<h6 data-number="3.4.2.6.1.4" class="anchored" data-anchor-id="regression-model-functions-lm-glm-gls-etc.-handle-missing-values-by-default"><span class="header-section-number">3.4.2.6.1.4</span> Regression model functions (lm, glm, gls, etc.) handle missing values by default</h6>
<p>Missing data in regression model functions such as <code>lm</code> are handled using the argument <code>na.action =</code> and the default is “na.omit”, which omits any rows that contain a missing value in one or more of the model variables (it includes rows if these contain missing values only in the columns not included in the model). It’s as if the user took the subset of data including only the columns containing the model variables and then deleted any row with missing values.</p>
<p>Here is the coefficient table of the fit model object that did not explictly tell the <code>lm</code> function how to handle missing data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(spleen <span class="sc">~</span> body_wt_g_sac <span class="sc">+</span> genotype,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> fig_s1f)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Estimate   Std. Error   t value     Pr(&gt;|t|)
(Intercept)   0.04238009 0.0242993900  1.744081 8.902319e-02
body_wt_g_sac 0.00167493 0.0001506493 11.118067 1.170042e-13
genotype-/-   0.23760586 0.0147600545 16.097898 8.072069e-19</code></pre>
</div>
</div>
<p>Here is the coefficient table of the fit model object that did explicitly tell <code>lm</code> how to handle missing data, using the argument <code>na.action = "na.exclude"</code>. These coefficient tables are the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(spleen <span class="sc">~</span> body_wt_g_sac <span class="sc">+</span> genotype,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> fig_s1f,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">na.action =</span> <span class="st">"na.exclude"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Estimate   Std. Error   t value     Pr(&gt;|t|)
(Intercept)   0.04238009 0.0242993900  1.744081 8.902319e-02
body_wt_g_sac 0.00167493 0.0001506493 11.118067 1.170042e-13
genotype-/-   0.23760586 0.0147600545 16.097898 8.072069e-19</code></pre>
</div>
</div>
</section>
</section>
<section id="butbeware-of-fitted-predicted-or-residual-values-from-regression-model-functions-unless-youve-explictly-told-the-function-how-to-handle-missing-values" class="level5" data-number="3.4.2.6.2">
<h5 data-number="3.4.2.6.2" class="anchored" data-anchor-id="butbeware-of-fitted-predicted-or-residual-values-from-regression-model-functions-unless-youve-explictly-told-the-function-how-to-handle-missing-values"><span class="header-section-number">3.4.2.6.2</span> But…beware of fitted, predicted, or residual values from regression model functions unless you’ve explictly told the function how to handle missing values</h5>
<p><strong>Use <code>na.action = "na.exclude"</code></strong> if you want to add the fitted (or predicted) values or residuals as new columns in the original data object (fig_sf1). Compare the length of the fitted values vector from models m1 (using the default “na.omit”) and m2 (using the “na.exclude”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">fitted</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">fitted</span>(m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55</code></pre>
</div>
</div>
<p>There are 55 observations (rows in the data) but only 42 complete rows with no missing values. The vector of fitted values from m1 has 42 fitted values. The vector of fitted values from m2 has 55 elements, the 42 fitted values plus 13 NA elements.</p>
<p>This is important if we want to do something like add the fitted values (or residuals, or some function of these) to the original data object (fig_sf1). Here I compute the spleen weights adjusted to the mean body weight of the control (“+/+”) group using the residuals from m1 and m2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>mean_x_control <span class="ot">&lt;-</span> <span class="fu">mean</span>(fig_s1f[genotype <span class="sc">==</span> <span class="st">"+/+"</span>, body_wt_g_sac])</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(m1)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>fig_s1f[, spleen_adj_m1 <span class="sc">:</span><span class="er">=</span> b[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>          b[<span class="dv">2</span>]<span class="sc">*</span>mean_x_control <span class="sc">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>          b[<span class="dv">3</span>]<span class="sc">*</span>(<span class="fu">as.integer</span>(genotype)<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">residuals</span>(m1))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in as.integer(genotype) - 1 + residuals(m1): longer object length is
not a multiple of shorter object length</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>fig_s1f[, spleen_adj_m2 <span class="sc">:</span><span class="er">=</span> b[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>          b[<span class="dv">2</span>]<span class="sc">*</span>mean_x_control <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>          b[<span class="dv">3</span>]<span class="sc">*</span>(<span class="fu">as.integer</span>(genotype)<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">residuals</span>(m2))]</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig_s1f)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The computation of “spleen_adj_m1” returns a warning that the values of <code>residuals(m1)</code> were recycled (the first 42 elements of the new column were filled with the 42 residuals and the last 13 elements of the new column were filled with the first 13 residuals) – after the first row of missing data, all of these computed adjusted values are wrong. Using <code>residuals(m2</code>), the adjusted values are matched to the correct row and the rows with missing variables do not have an adjusted value (because there is no residual to compute this).</p>
</section>
</section>
</section>
<section id="saving-data" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="saving-data"><span class="header-section-number">3.4.3</span> Saving data</h3>
<p>For many projects, it is uncommon to save data. I might save simulated data if it takes a long time (tens of minutes to hours or even days) to generate these and I simply want to work with the simulated data in the future and not have to regenerate it. Or I might save wrangled data if it takes a long time to import and wrangle and I want to analyze the wrangled data in the future and not have to re-import and re-wrangle it.</p>
<p>If the data will only be used in this or future R projects, the data can be saved as an R object using <code>saveRDS()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Drosophila serotonin 2A receptor signaling coordinates central metabolic processes to modulate aging in response to nutrient choice"</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>outfile_name <span class="ot">&lt;-</span> <span class="st">"elife-59399-fig1h.Rds"</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>save_file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, outfile_name)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="at">object =</span> fig1h, <span class="at">file =</span> save_file_path)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># to read this use</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>fig1h <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(save_file_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Reading a large .Rds file is very fast compared to reading the same data stored as a text file. However, if the data need to be imported into some other software, such as a spreadsheet, then save the data as a text file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the data to correct data_from folder</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Drosophila serotonin 2A receptor signaling coordinates central metabolic processes to modulate aging in response to nutrient choice"</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tab delimited</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>outfile_name <span class="ot">&lt;-</span> <span class="st">"elife-59399-fig1h.txt"</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>save_file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, outfile_name)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(fig1h, save_file_path, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># comma delimited</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>outfile_name <span class="ot">&lt;-</span> <span class="st">"elife-59399-fig1h.csv"</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>save_file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, outfile_name)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(fig1h, save_file_path, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look at your project directory to make sure the file is where it should be! We used <code>write.table()</code> to create a tab-delimited text file using <code>sep = "\t"</code> to specify tabs to separate the row elements. “ is the standard character string for a tab. Check in your data_from folder (with the name”Drosophila serotonin 2A receptor signaling coordinates central metabolic processes to modulate aging in response to nutrient choice”) and open the file in a text editor.</p>
</section>
<section id="exercises" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.4.4</span> Exercises</h3>
<ol type="1">
<li>Import and pretty-good-plot the data for Figure 2i of the Adipsin paper. You will need to download and archive the Excel file for “Figure 2”. Store this within the “Adipsin preserves beta cells…” folder.</li>
</ol>
<ul>
<li>The data are the percent of cells staining for <a href="https://en.wikipedia.org/wiki/NKX6-1">NKX6.1</a>, which is a transcription factor protein that regulates beta cell development in the pancreas. Beta cells sense glucose levels in the blood and secrete insulin. Disruption of the insulin signaling system results in Diabetes mellitus.</li>
<li>The data are in wide format, with each treatment group in a separate column. The data need to be melted into long format with a new column called “treatment”.</li>
<li>This will give you a pretty good plot of the data (if the data object is named “adipsin_fig2i”)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggstripchart</span>(<span class="at">data =</span> adipsin_fig2i,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="st">"treatment"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="st">"nkx6_1"</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">add =</span> <span class="st">"mean_se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Import and quick pretty-good-plot the data for Figure 3b of the PI3K paper. You will need to download and archive the Excel file for “Figure 3”. Store this within the “Suppression of insulin feedback enhances…” folder.</li>
</ol>
<ul>
<li>The data are <a href="https://en.wikipedia.org/wiki/C-peptide">c-peptide</a> levels in response to the treatments. C-peptide is cleaved from the pro-insulin polypeptide and circulates in the blood and is a marker of how much insulin is being produced by the beta cells of the pancreas.</li>
<li>The data are in wide format, with each treatment group in a separate column. The data need to be melted into long format with a new column called “treatment”.</li>
<li>Modify the code from exercise 1 to pretty-good-plot the data as in exercise 1.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="reading-writing-wrangling_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://elifesciences.org/articles/53560" target="_blank">Corrigan, June K., et al.&nbsp;“A big-data approach to understanding metabolic rate and response to obesity in laboratory mice.” Elife 9 (2020): e53560.</a>)<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/middleprofessor\.github\.io\/benchbiostats\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/setup.html" class="pagination-link" aria-label="Getting Started -- R Projects and R Markdown">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started – R Projects and R Markdown</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/plotting-models.html" class="pagination-link" aria-label="Plotting Models">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>