<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Multiple tests – why and when to adjust p-values – Statistics for the Experimental Bench Biologist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/two-factors.html" rel="next">
<link href="../chapters/model-checking.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/multiple-testing.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple tests – why and when to adjust <em>p</em>-values</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistics for the Experimental Bench Biologist</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analyzing experimental data with a linear model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started – R Projects and R Markdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/reading-writing-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data – Reading, Wrangling, and Writing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/plotting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/uncertainty-sd-and-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Uncertainty – Standard Deviations, Standard Errors, and Confidence Intervals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/p-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">P-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Errors in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro-stat-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">An introduction to linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/continuous_x.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear models with a single, continuous <em>X</em> (“linear regression”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/one-factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear models with a single, categorical <em>X</em> (“t-tests” and “ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/model-checking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model checking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/multiple-testing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple tests – why and when to adjust <em>p</em>-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/two-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Linear models with two categorical <span class="math inline">\(X\)</span> – Factorial linear models (“two-way ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models with added covariates (“ANCOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/lmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Models for non-independence – linear mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Linear models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-fwer" id="toc-sec-fwer" class="nav-link active" data-scroll-target="#sec-fwer"><span class="header-section-number">12.1</span> In a family of multiple tests, what is the probability of at least one p-value less than 0.05?</a></li>
  <li><a href="#example-1-in-many-experiments-we-dont-want-to-adjust-for-multiple-tests-exfig2d-data" id="toc-example-1-in-many-experiments-we-dont-want-to-adjust-for-multiple-tests-exfig2d-data" class="nav-link" data-scroll-target="#example-1-in-many-experiments-we-dont-want-to-adjust-for-multiple-tests-exfig2d-data"><span class="header-section-number">12.2</span> Example 1 – In many experiments, we don’t want to adjust for multiple tests (exfig2d data)</a>
  <ul>
  <li><a href="#or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done" id="toc-or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done" class="nav-link" data-scroll-target="#or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done"><span class="header-section-number">12.2.1</span> Or, maybe we do want to adjust, but not in the way that is usually done</a></li>
  </ul></li>
  <li><a href="#sec-mult-tests-tukey" id="toc-sec-mult-tests-tukey" class="nav-link" data-scroll-target="#sec-mult-tests-tukey"><span class="header-section-number">12.3</span> Example 2 – Tukey adjustment is extremely common, and (mostly) unjustified (fig5l data)</a>
  <ul>
  <li><a href="#or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done-1" id="toc-or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done-1" class="nav-link" data-scroll-target="#or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done-1"><span class="header-section-number">12.3.1</span> Or, maybe we do want to adjust, but not in the way that is usually done</a></li>
  </ul></li>
  <li><a href="#sec-mult-tests-eg3-fdr" id="toc-sec-mult-tests-eg3-fdr" class="nav-link" data-scroll-target="#sec-mult-tests-eg3-fdr"><span class="header-section-number">12.4</span> Example 3 – When we do want to adjust, we often want to use a method that controls the False Discovery Rate (FDR) (lipocalin fig3 data)</a></li>
  <li><a href="#better-know-fdr-sec-mult-tests-fdr" id="toc-better-know-fdr-sec-mult-tests-fdr" class="nav-link" data-scroll-target="#better-know-fdr-sec-mult-tests-fdr"><span class="header-section-number">12.5</span> Better Know FDR {sec-mult-tests-fdr}</a></li>
  <li><a href="#working-in-r" id="toc-working-in-r" class="nav-link" data-scroll-target="#working-in-r"><span class="header-section-number">12.6</span> Working in R</a>
  <ul>
  <li><a href="#the-contrast-function-has-different-default-adjustment-methods-for-each-of-the-contrast-methods" id="toc-the-contrast-function-has-different-default-adjustment-methods-for-each-of-the-contrast-methods" class="nav-link" data-scroll-target="#the-contrast-function-has-different-default-adjustment-methods-for-each-of-the-contrast-methods"><span class="header-section-number">12.6.1</span> The contrast() function has different default adjustment methods for each of the contrast methods</a></li>
  <li><a href="#for-non-default-adjustment-use-the-adjust-argument" id="toc-for-non-default-adjustment-use-the-adjust-argument" class="nav-link" data-scroll-target="#for-non-default-adjustment-use-the-adjust-argument"><span class="header-section-number">12.6.2</span> For non-default adjustment, use the <code>adjust =</code> argument</a></li>
  <li><a href="#sec-mult-tests-adjust-options" id="toc-sec-mult-tests-adjust-options" class="nav-link" data-scroll-target="#sec-mult-tests-adjust-options"><span class="header-section-number">12.6.3</span> Options in <code>adjust =</code></a></li>
  <li><a href="#using-the-p.adjust-function" id="toc-using-the-p.adjust-function" class="nav-link" data-scroll-target="#using-the-p.adjust-function"><span class="header-section-number">12.6.4</span> Using the p.adjust() function</a>
  <ul class="collapse">
  <li><a href="#options-in-p.adjust" id="toc-options-in-p.adjust" class="nav-link" data-scroll-target="#options-in-p.adjust"><span class="header-section-number">12.6.4.1</span> Options in p.adjust()</a></li>
  </ul></li>
  <li><a href="#a-holm-sidak-function-for-reproducing-graphpad-prism-results" id="toc-a-holm-sidak-function-for-reproducing-graphpad-prism-results" class="nav-link" data-scroll-target="#a-holm-sidak-function-for-reproducing-graphpad-prism-results"><span class="header-section-number">12.6.5</span> A Holm-Sidak function for reproducing GraphPad Prism results</a></li>
  </ul></li>
  <li><a href="#hidden-import-code" id="toc-hidden-import-code" class="nav-link" data-scroll-target="#hidden-import-code"><span class="header-section-number">12.7</span> Hidden Import Code</a>
  <ul>
  <li><a href="#sec-exfig2-import-unhide" id="toc-sec-exfig2-import-unhide" class="nav-link" data-scroll-target="#sec-exfig2-import-unhide"><span class="header-section-number">12.7.1</span> Example 1 (exfig2 data)</a></li>
  <li><a href="#sec-fig5l-import-unhide" id="toc-sec-fig5l-import-unhide" class="nav-link" data-scroll-target="#sec-fig5l-import-unhide"><span class="header-section-number">12.7.2</span> Example 2 (fig5l data)</a></li>
  <li><a href="#sec-fig3-import-unhide" id="toc-sec-fig3-import-unhide" class="nav-link" data-scroll-target="#sec-fig3-import-unhide"><span class="header-section-number">12.7.3</span> Example 3 (fig3 data)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-multiple-tests" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple tests – why and when to adjust <em>p</em>-values</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In many experiments, researchers have multiple treatments or multiple responses. This results in multiple tests against the null. For example, in an experiment with four treatment levels, there are six combinations of contrasts (A - B, A - C, A - D, B - C, B - D, C - D) and a researcher might be interested in all six <em>p</em>-values. Or, in an experiment with only two levels, there could be six response variables (expression level in six different genes. Or, six different phenotypes). Here, there are six contrasts (B - A for all six response variables) and six tests. Researchers commonly adjust for multiple testing in examples like these (the exception is multiple phenotype responses. Curiously, researchers almost never adjust for this). What is multiple testing and why do we want to adjust? And, something that doesn’t seem to be considered much in the experimental bench biology literature, <em>when</em> do we want to adjust?</p>
<div class="callout callout-style-default callout-note callout-titled" title="TL;DR">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
TL;DR
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>If your experiment has a single response variable (that is, you’re not measuring the effect of treatment on multiple phenotypes or gene expression levels), then you probably don’t want to adjust for multiple tests.</li>
<li>Adjusting for multiple tests in the experimental bench biology literature is the norm, because researchers are confused on what a “family” is.</li>
<li>Despite No.&nbsp;2, researchers almost always fail to adjust for multiple tests when they should, specifically, when there are multiple phenotypes or gene expression levels that answer the same experimental question.</li>
<li>When you do adjust as in No.&nbsp;3, you should probably use a method that controls the False Discovery Rate (FDR) and not the Family-Wise Error Rate (FWER). The reason isn’t because the FDR is more liberal, it’s because it’s more consistent with the goals of the research.</li>
</ol>
</div>
</div>
<section id="sec-fwer" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="sec-fwer"><span class="header-section-number">12.1</span> In a family of multiple tests, what is the probability of at least one p-value less than 0.05?</h2>
<p>A <strong>family</strong> of tests is a set of tests that are used to make some inference about one question. For example, “In this mouse model of diabetes, are any genes differently expressed between diabetes mice and wildtype mice”? <span class="math inline">\(p &lt; 0.05\)</span> for any of the tested genes answers the question. If a researcher only tests one gene, then the probability of <span class="math inline">\(p &lt; 0.05\)</span> if there is no expression difference between phenotypes is 5%. But if a researcher tests two genes, there is a higher probability than 5% that at least one will have <span class="math inline">\(p &lt; 0.05\)</span> if there is no expression difference between phenotypes for both genes. And, if a researcher tests ten genes, there is a much higher probability than 5% that at least one will have <span class="math inline">\(p &lt; 0.05\)</span> if there is no expression difference between phenotypes for any of the ten genes. What are these probabilities?</p>
<p>The probability of a significant <em>p</em>-value in one test is 0.05, so the probability of no non-significant <em>p</em>-values in one test is 1 - 0.05. The probability of no non-significant <em>p</em>-values in two tests is <span class="math inline">\((1 - 0.05)^2\)</span>, so the probability of at least one significant <em>p</em>-value is <span class="math inline">\(1 - (1 - 0.05)^2\)</span>. The probability of no non-significant <em>p</em>-values in ten tests is <span class="math inline">\((1 - 0.05)^{10}\)</span>, so the probability of at least one significant <em>p</em>-value in ten tests is <span class="math inline">\(1 - (1 - 0.05)^{10}\)</span>. Let’s compute these probabilities, and more.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Family-wise error rate for unadjusted <em>p</em>-values</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Number of tests</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prob(at least 1 &lt; 0.05)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100</td>
<td style="text-align: right;">0.99</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The second column is the <strong>family-wise error rate</strong> (FWER), the probability of at least one <span class="math inline">\(p &lt; 0.05\)</span> in a family of tests in which there are no true effects. So the FWER for a family of 10 tests is 40% <em>if our p-values are not adjusted for multiple testing</em>. We adjust <em>p</em> values in experiments with multiple tests in order to control the FWER.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>An assumption of these probabilities is the tests are independent. Importantly, this independence assumption is also true for most, but not all, of the adjustment methods.</p>
</div>
</div>
</section>
<section id="example-1-in-many-experiments-we-dont-want-to-adjust-for-multiple-tests-exfig2d-data" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="example-1-in-many-experiments-we-dont-want-to-adjust-for-multiple-tests-exfig2d-data"><span class="header-section-number">12.2</span> Example 1 – In many experiments, we don’t want to adjust for multiple tests (exfig2d data)</h2>
<p>In many experiments, we don’t want to adjust for multiple tests because there is only a single test in the family even if there are multiple tests in the experiment. Researchers are adjusting because of a confusion on what a family is. The cost of this adjustment is more conservative (higher) <em>p</em>-values, which leads to less power, which leads to more failed discoveries or more research costs (mice, time) to discover by <em>p</em>-value.</p>
<p>Let’s explore what a family is using data from the article</p>
<p>Source: <a href="https://www.nature.com/articles/s41586-024-07929-5" target="_blank">Lyu, Q., Xue, W., Liu, R. et al.&nbsp;A brain-to-gut signal controls intestinal fat absorption. Nature (2024). https://doi.org/10.1038/s41586-024-07929-5</a></p>
<p><a href="https://www.nature.com/articles/s41586-024-07929-5#Fig7" target="_blank">Data source</a></p>
<p>Figure: Extended Figure 2d</p>
<p>The import code is in <a href="#sec-exfig2-import-unhide" class="quarto-xref"><span>Section 12.7.1</span></a> below.</p>
<p>In this study, the researchers investigate the control of fat absorption in the intestine by the dorsal motor nucleus of the vagus nerve (DMV) and show that the plant metabolite puerarin mimics this DMV suppression.</p>
<p>The experiment in Extended Figure 2d follows up initial experiments from Figure 1 that show that inactivation of the DMV in mice decreased weight gain on a high fat diet relative to control mice and that DMV-inactive mice had lower plasma triglycerides, higher fat content in the feces, and lower fat absorption in the jejunum part of the small intestine. The DMV was inactivated by Clozapine N-oxide (CNO) binding to a human-designed hM4D(Gi) inhibitory receptor whose expression is controlled by the researchers.</p>
<p>In the experiment in Extended Figure 2d, the response is fecal NEFA (non-esterified fatty acid).</p>
<p>The three treatments are</p>
<ol type="1">
<li>“con” is a negative control with a designer receptor that doesn’t bind CNO. The researchers expect fecal NEFA equal to mice with no designed receptors.</li>
<li>“3q” is the focal treatment using a designer receptor that should activate the DMV. If the DMV regulation of fat absorption is working as thought, the researchers expect increased fat absorption so lower fecal NEFA levels relative to “con”.</li>
<li>“4i” is a positive control using the DMV-inactivating receptor in the previous experiments. The researchers expect higher NEFA levels relative to “con”, as in the experiments in Fig. 1.</li>
</ol>
<p>There are three contrasts of single treatments (“3q - con”, “4i - con”, “4i - 3q”) so three tests. The researchers follow the norm in experimental bench biology research and report p-values adjusted for multiple tests. Specifically, the researchers adjusted for the two contrasts comparing a treatment to the negative control (“3q - con” and “4i - con”). This adjustment seems to follow the logic that a family is the set of tests of interest to the researchers (the contrast “4i - 3q” is not of interest). But “of interest to the researchers” doesn’t define a family of tests. Instead, “same question” defines a family of tests. If were were to include both contrasts in a family, what is the question? It would have to be something like “if we manipulate the activity of the DMV, do we get a change in fecal NEFA?”.</p>
<p>This isn’t the question addressed by the research. The researchers have one focal question: “does activating the DMV increase fat absorption and consequently, decrease fecal NEFA levels?” Only one test (the contrast “3q - con”) answers this question so the family has a single test and there is no need to adjust. The researchers are interested in a second question as a check on the experiment itself. This question is something like “Are we actually getting the known response given the intervention”. Only one test (the contrast “4i - con”) answers this question so there is no need to adjust.</p>
<p>Let’s look at the cost of adjustment. The researchers used the Holm-Sidák method to adjust the two <em>p</em>-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(nefa <span class="sc">~</span> treatment, <span class="at">data =</span> exfig2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="st">"treatment"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>m1_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"trt.vs.ctrl"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>m1_pairs[, holm_sidak <span class="sc">:</span><span class="er">=</span> <span class="fu">holm_sidak</span>(p.value)]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>m1_pvals <span class="ot">&lt;-</span> m1_pairs[, .SD, .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"contrast"</span>, <span class="st">"estimate"</span>, <span class="st">"p.value"</span>, <span class="st">"holm_sidak"</span>)]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m1_pvals) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Contrast"</span>, <span class="st">"Estimate"</span>, <span class="st">"Unadjusted P"</span>, <span class="st">"Holm-Sidak P"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>m1_pvals <span class="sc">|&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-mult-tests-exfig2_m1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mult-tests-exfig2_m1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.1: Unadjusted <em>p</em>-value and Holm-Sidak adjusted <em>p</em>-value for the experiment in Extended Figure 2d
</figcaption>
<div aria-describedby="tbl-mult-tests-exfig2_m1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unadjusted P</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Holm-Sidak P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">3q - con</td>
<td style="text-align: right;">-1.090</td>
<td style="text-align: right;">0.01261</td>
<td style="text-align: right;">0.02506</td>
</tr>
<tr class="even">
<td style="text-align: left;">4i - con</td>
<td style="text-align: right;">1.048</td>
<td style="text-align: right;">0.01361</td>
<td style="text-align: right;">0.02506</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>The cost is about double because there are two tests. If we use <span class="math inline">\(p &lt; 0.05\)</span> to act as if there is an effect, then the adjustment costs us nothing here. Adjusting for a small (two to three) number of tests is not going to have much impact on the quality of science either way. Nevertheless</p>
<ol type="1">
<li>adjusting is unnecessary in experiments like this, where there are multiple questions addressed by the experiment and each question is answered by a single test. This is the case for many, many experiments in experimental bench biology.</li>
<li>although small, the increased power with not adjusting is free.</li>
</ol>
<section id="or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done"><span class="header-section-number">12.2.1</span> Or, maybe we do want to adjust, but not in the way that is usually done</h3>
<p>Extended figure 2d presents only one of six response variables that were measured on each mouse. The other response variables were body weight, fecal triglyceride, jejunal triglyceride, duodenal triglyceride, and ileal triglyceride. Some thoughts:</p>
<ol type="1">
<li>Fecal NEFA and Fecal triglyceride effectively answer the same focal question “does activating the DMV increase fat absorption and consequently, decrease fecal fat levels?” So, adjusting for two tests is probably justified but the two tests are the same contrast (“3q - con”) with two different response variables and not different contrasts for the same response variable.</li>
<li>jejunal, duodenal, and ileal triglyceride effectively answer the same focal question “does activating the DMV increase fat absorption in a specific part of the small intestine”. So adjusting for three tests is probably justified here, but again, the adjustment is for the same contrast (“3q - con”) from the model fit to three different response variables.</li>
<li>Adjustment for multiple responses is common in some subfields of experimental bench biology that are measuring thousands of responses (gene expression, functional MRI) but I I haven’t seen adjustment for multiple phenotypic responses from a single experiment.</li>
</ol>
</section>
</section>
<section id="sec-mult-tests-tukey" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="sec-mult-tests-tukey"><span class="header-section-number">12.3</span> Example 2 – Tukey adjustment is extremely common, and (mostly) unjustified (fig5l data)</h2>
<p>A very common research design in experimental bench biology is a design with two factors, each with two levels, with mice assigned to all 2 x 2 = 4 combinations of the levels. Analysis of these models for two (or more) factors is the focus of <a href="two-factors.html" class="quarto-xref"><span>Chapter 13</span></a>. The experiment in Figure 5l is a good example of a 2 x 2 design.</p>
<p><a href="https://www.nature.com/articles/s41586-024-07929-5#MOESM11" target="_blank">Data source</a></p>
<p>Figure: Figure 5l</p>
<p>The import code is in <a href="#sec-fig5l-import-unhide" class="quarto-xref"><span>Section 12.7.2</span></a> below</p>
<p>The experiment in Fig. 5 follows up experiments that show that the plant metabolite puerarin binds to the GABA receptor encoded by <em>Gabra1</em> and increases GABA’s inhibitory effect on the target neuron. In the experiment in Fig. 5, the researchers are investigating the mechanism of the effect of DVM-vagus supression on fat absorption in the jejunum. Figure 5c shows that suppressing DMV using COS activation of the designer 4i inhibitory receptor (as above) results in decreased jejunal microvilli length – the reduced length decreases surface area for absorption. Figure 5d shows that suppressing DMV results in reduced expression of four genes involved in microvilli growth and organization. The design of the experiment in Fig. 5c, d is the same as that in Extended fig 2d above.</p>
<p>Fig. 5l uses a 2 x 2 crossed design to investigate the effect of puerarin with and without a functional <em>Gabra1</em> GABA receptor.</p>
<p>Here, we’ll focus on the first gene, <em>ezr</em>, which encodes the protein ezrin.</p>
<p>The two factors are</p>
<ol type="1">
<li>genotype, with levels “WT” and “KO”. KO is the conditional knockout of <em>Gabra1</em> in the DMV.</li>
<li>treatment, with levels “Vehicle” and “Puerarin”. Infusion of a saline solution (Vehicle) or a solution with Puerarin.</li>
</ol>
<p>All levels of both factors are combined to create the four experimental combinations (the design is <strong>fully factorial</strong>)</p>
<ol type="1">
<li>“WT Vehicle” is the combination “WT” + “Vehicle”. This is the negative control.</li>
<li>“WT Puerarin” is the combination “WT” + “Puerarin”.</li>
<li>“KO Vehicle” is the combination “KO” + “Vehicle”.</li>
<li>“KO Puerarin” is the combination “KO” + “Puerarin”</li>
</ol>
<p>The primary questions of the experiment are:</p>
<ol type="1">
<li>does addition of puerarin reduce RNA expression in mice with functional <em>Gabra1</em> GABA receptor?</li>
<li>does deletion of <em>Gabra1</em> remove this effect of puerarin?</li>
</ol>
<p>The researchers answer these questions using these two contrasts</p>
<ol type="1">
<li>WT Puerarin - WT Vehicle</li>
<li>KO Puerarin - KO Vehicle</li>
</ol>
<p>So, there are two research questions, each answered by a single contrast. There is nothing to adjust because each family consists of only a single test.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Look at question 2 closely – its a comparison of contrast 1 and contrast 2. Ultimately, the researchers are asking about the effects of Puerarin with and without a functional <em>Gabra1</em> GABA receptor, so there is a single primary contrast of interest</p>
<p>(KO Puerarin - KO Vehicle) - (WT Puerarin - WT Vehicle)</p>
<p>This contrast is called the <strong>interaction effect</strong> or simply the interaction. The interaction is the difference in contrasts 1 and 2. An interaction is a <strong>difference of differences</strong>. The estimation of interaction effects almost always answers the focal question in 2 x 2 designs but is almost never estimated in experimental bench biology. More information on designs for two factors and interaction effects is in chapter <span class="citation" data-cites="two-factors">(<a href="#ref-two-factors" role="doc-biblioref"><strong>two-factors?</strong></a>)</span></p>
</div>
</div>
<p>What did the researchers do? Of the six pairwise contrasts, only two of which they focussed on in the text, the researchers report the four “simple effects” in the figure and in the archived Excel file. These are:</p>
<ol type="1">
<li>(WT Puerarin) - (WT Vehicle) answers the question “how does microvilli-related gene expression change when we add puerarin to mice with fuctional Gabra1?”. This is a positive control for contrast 2.</li>
<li>(KO Puerarin) - (KO Vehicle) answers the question “how does microvilli-related gene expression change when we add puerarin to mice with knocked out Gabra1?”. This is a focal contrast.</li>
<li>(KO Vehicle)) - (WT Vehicle) answers the question “how does microvilli-related gene expression change when we knock out <em>Gabra1</em> and don’t give puerarin administration? This is a positive control for contrast 4.</li>
<li>(KO Puerarin) - (WT Puerarin) answers the question “how does microvilli-related gene expression change when we knock out <em>Gabra1</em> but give puerarin administration? This is a focal contrast.</li>
</ol>
<p>Instead of adjusting for the two tests of interest, or the four computed tests, the researchers followed the norm in experimental bench biology and used the Tukey HSD adjustment for a single family of six tests (all six pairwise tests). Perhaps the norm is following a definition of family as “all tests within an experiment”. Regardless, the adjustment logic in Fig. 5l is inconsistent with that in Fig 2d., where the researchers adjusted for the two tests of interest instead of the set of all three pairwise comparisons in the experiment. In Fig. 5l, the researchers adjust for all six pairwise comparisons, show only four contrasts in the figure and in the Excel file of the data, but only seem interested in the two contrasts that answer the focal questions.</p>
<p>What is the cost of adjustment? In <a href="#tbl-mult-tests-fig5_m1" class="quarto-xref">Table&nbsp;<span>12.2</span></a> below, for the two focal tests, I give the unadjusted <em>p</em>-values, the Tukey <em>p</em>-values based on all six pairwise tests, and the Holm <em>p</em>-values based on the four simple effects. The cost of the Tukey and Holm adjustments are given in the last two columns as the ratio of the adjusted to unadjusted <em>p</em>-value. This loss of power is an unnecessary and results from a confusion in the experimental bench biology community of what a family of tests mean. Loss of power leads to more time, more dollars, more animals, and more failed discoveries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ezrin <span class="sc">~</span> genotype <span class="sc">*</span> treatment, <span class="at">data =</span> fig5l)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>m1_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"revpairwise"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>m1_tukey <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"revpairwise"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>m1_simple <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"revpairwise"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">simple =</span> <span class="st">"each"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">combine =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adjust =</span> <span class="st">"holm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>m1_pairs[, tukey <span class="sc">:</span><span class="er">=</span> m1_tukey<span class="sc">$</span>p.value]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>m1_pairs[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>), holm <span class="sc">:</span><span class="er">=</span> m1_simple[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>), p.value]]</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>m1_pairs[ , cost_tukey <span class="sc">:</span><span class="er">=</span> tukey<span class="sc">/</span>p.value]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>m1_pairs[ , cost_holm <span class="sc">:</span><span class="er">=</span> holm<span class="sc">/</span>p.value]</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>m1_pvals <span class="ot">&lt;-</span> m1_pairs[, .SD, .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"contrast"</span>, <span class="st">"estimate"</span>, <span class="st">"p.value"</span>, <span class="st">"tukey"</span>, <span class="st">"holm"</span>, <span class="st">"cost_tukey"</span>, <span class="st">"cost_holm"</span>)]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(m1_pvals) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Contrast"</span>, <span class="st">"Estimate"</span>, <span class="st">"Unadjusted P"</span>, <span class="st">"Tukey P"</span>, <span class="st">"Holm P"</span>, <span class="st">"Tukey/Unadjusted"</span>, <span class="st">"Holm/Unadjusted"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># only the simple effects are of interest. These are rows 1, 2, 5, 6</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>m1_pvals[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), ] <span class="sc">|&gt;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-mult-tests-fig5_m1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mult-tests-fig5_m1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.2: Unadjusted <em>p</em>-value and Tukey adjusted <em>p</em>-value for the experiment in Fig. 5l
</figcaption>
<div aria-describedby="tbl-mult-tests-fig5_m1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unadjusted P</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tukey P</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Holm P</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tukey/Unadjusted</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Holm/Unadjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">WT Puerarin - WT Vehicle</td>
<td style="text-align: right;">-0.554</td>
<td style="text-align: right;">0.0032</td>
<td style="text-align: right;">0.0159</td>
<td style="text-align: right;">0.0096</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">KO Puerarin - KO Vehicle</td>
<td style="text-align: right;">-0.020</td>
<td style="text-align: right;">0.9085</td>
<td style="text-align: right;">0.9994</td>
<td style="text-align: right;">0.9085</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<section id="or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done-1" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="or-maybe-we-do-want-to-adjust-but-not-in-the-way-that-is-usually-done-1"><span class="header-section-number">12.3.1</span> Or, maybe we do want to adjust, but not in the way that is usually done</h3>
<p>For each of the contrasts in the Fig. 5l example above, the researchers measured the response in four microvilli-related genes. Each of these genes answers the question posed for a contrast. For example, all four genes answer the question for contrast 1, which is “how does microvilli-related gene expression change when we add puerarin to mice with functional Gabra1?” The family is the four contrasts (WT Puerarin - WT Vehicle) for each of the four genes. The researchers should adjust for the four tests within this family. The next section shows how this is done.</p>
<div id="tbl-mult-tests-fig5_all" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-mult-tests-fig5_all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.3
</figcaption>
<div aria-describedby="tbl-mult-tests-fig5_all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>

</div>
</div>
</figure>
</div>
</section>
</section>
<section id="sec-mult-tests-eg3-fdr" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="sec-mult-tests-eg3-fdr"><span class="header-section-number">12.4</span> Example 3 – When we do want to adjust, we often want to use a method that controls the False Discovery Rate (FDR) (lipocalin fig3 data)</h2>
<div class="callout callout-style-default callout-note callout-titled" title="Wait What?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Wait What?
</div>
</div>
<div class="callout-body-container callout-body">
<p>When <span class="math inline">\(p &lt; 0.05\)</span>, researchers act as if they have discovered or confirmed something, so <span class="math inline">\(p &lt; 0.05\)</span> is evidence of a <strong>discovery</strong>. Consider these two situations</p>
<ol type="1">
<li><span class="math inline">\(p &lt; 0.05\)</span> and the Null Hypothesis is false – there is a true effect of treatment, or, there is a true difference in means between the two treatment levels. This is a true discovery.</li>
<li><span class="math inline">\(p &lt; 0.05\)</span> but the Null Hypothesis is true – there is no true effect of treatment, or, there is no true difference in means between the two treatment levels. This is a false discovery.</li>
</ol>
<p>The <strong>false discovery rate</strong> (FDR) in a batch of tests is</p>
<p><span class="math display">\[
FDR = \frac{number\;of\;false\;discoveries}{number\;of\;false\;discoveries + number\;of\;true\;discoveries}
\]</span></p>
<p>Remember that the family wise error rate (FWER) is the long term probability of at least one <span class="math inline">\(p &lt; 0.05\)</span> in a batch of tests in which all Null Hypothesis are true – there are no true effects (<a href="#sec-fwer" class="quarto-xref"><span>Section 12.1</span></a>).</p>
<p>Note that the FWER for a single batch of tests is either 1 (there was at least one false positive) or 0 (there were no false positives). By contrast, an omniscient researcher can compute the FDR for a single batch of tests.</p>
<p>For any batch of tests in which some effects are real, and some are not</p>
<ol type="1">
<li>A FWER method of <em>p</em>-value adjustment controls the long-term FWER at <span class="math inline">\(\leq\)</span> 0.05.</li>
<li>An FDR method of <em>p</em>-value adjustment controls the long-term FDR at <span class="math inline">\(\leq\)</span> 0.05.</li>
</ol>
</div>
</div>
<p>Source: <a href="https://www.nature.com/articles/s41467-023-42473-2" target="_blank">Su, H., Guo, H., Qiu, X. et al.&nbsp;Lipocalin 2 regulates mitochondrial phospholipidome remodeling, dynamics, and function in brown adipose tissue in male mice. Nat Commun 14, 6729 (2023). https://doi.org/10.1038/s41467-023-42473-2</a></p>
<p><a href="https://www.nature.com/articles/s41467-023-42473-2#Sec31" target="_blank">Data source</a></p>
<p>Figure: Figure 3</p>
<p>The import code is in <a href="#sec-fig3-import-unhide" class="quarto-xref"><span>Section 12.7.3</span></a> below</p>
<p>The researchers are investigating the role of <em>Lipocalin-2</em> (<em>LCN2</em>) on mitochondrial membrane function. Using a LCN2 knockout and the thermogenic molecule CL316,243, the researchers scanned for differences in levels of 246 lipids between WT and KO mice with and without CL316,243 treatment. Of the different classes of lipids, the biggest differences were found in cardiolipins. The panels in Fig 3d-u show cardiolipin levels for each of the four groups for 18 of the 26 cardiolipins with at least one significant <em>p</em>-value for a difference between WT and KO mice.</p>
<p>The two factors are</p>
<ol type="1">
<li>genotype, with levels “WT” and “KO”, where KO is the LCN2 knockout.</li>
<li>treatment, with levels “Saline” and “CL316243”, where CL316243 is administration of CL316,243.</li>
</ol>
<p>All levels of both factors are combined to create the four treatment combinations</p>
<ol type="1">
<li>“WT Saline” is the combination “WT” + “Saline”. This is the negative control.</li>
<li>“WT CL316243” is the combination “WT” + “CL316,243”.</li>
<li>“KO Saline” is the combination “KO” + “Saline”.</li>
<li>“KO CL316243” is the combination “KO” + “CL316,243”</li>
</ol>
<p>The researchers do not have a model of how any specific cardiolipin will respond to any specific treatment combination. Instead, the research question seems to be something like, “do we see differences in CL synthesis under different combinations of LCN2 activity and CL316,243?” For each cardiolipin, the four simple effect contrasts answer this question. But the question remains the same for each cardiolipin, so there are 104 (4 x 26) tests in the family. Even though the researchers only present results for 18 cardiolipins, we have to include the 8 non-presented cardiolipins because these were also analyzed.</p>
<p>Now this is an example of an experiment where we should adjust <em>p</em>-values for multiple testing!</p>
<div class="callout callout-style-default callout-note callout-titled" title="Which adjustment method?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Which adjustment method?
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Holm. This modification of Bonferroni adjusts <em>p</em>-values to control the family-wise error rate (FWER) and would be relevant if the researchers were asking the question “does at least one cardiolipin have different synthesis level under any combination of genotype and treatment?”</li>
<li>BH (Benjamini-Hochberg). This method based on Benjamini-Hochberg adjusts <em>p</em>-values to control the false discovery rate (FDR) and would be relevant if the researchers were asking “which cardiolipins have different synthesis levels and under which combination of genotype and treatment?”</li>
</ol>
<p>We control FWER if we want to show that “we have evidence of something happening in this system”. We control FDR if we want to show that “we have evidence that we’ve discovered a specific component in the system”.</p>
<p>I don’t think the FWER question is very relevant to most experimental bench biology.</p>
<p>In a sense, BH is more liberal and Holm is more conservative but this isn’t a good way to think about the these because this is comparing apples and oranges. Instead of using BH to “gain power” or Holm to “be conservative”, just use a different alpha. If the cost of false discovery is cheap but the potential for reward is high, increase alpha. If the cost of false discovery is expensive, decrease alpha.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cl_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(fig3)[<span class="fu">which</span>(<span class="fu">substr</span>(<span class="fu">names</span>(fig3), <span class="dv">1</span>, <span class="dv">11</span>) <span class="sc">==</span> <span class="st">"cardiolipin"</span>)]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>n_cardiolipins <span class="ot">&lt;-</span> <span class="fu">length</span>(cl_cols)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>p_table <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_cardiolipins){</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  lipid_id <span class="ot">&lt;-</span> cl_cols[i]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  formula_i <span class="ot">&lt;-</span> <span class="fu">paste</span>(lipid_id, <span class="st">"~"</span>, <span class="st">"group"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formula</span>()</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula_i, <span class="at">data =</span> fig3)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  m1_pairs <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="st">"group"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"revpairwise"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  m1_pairs <span class="ot">&lt;-</span> m1_pairs[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>),]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">t.test</span>(fig3[group <span class="sc">==</span> <span class="st">"WT-Saline"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>               fig3[group <span class="sc">==</span> <span class="st">"WT-CL"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">var.equal =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>p.value</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">t.test</span>(fig3[group <span class="sc">==</span> <span class="st">"KO-Saline"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>               fig3[group <span class="sc">==</span> <span class="st">"KO-CL"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">var.equal =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>p.value</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  p3 <span class="ot">&lt;-</span> <span class="fu">t.test</span>(fig3[group <span class="sc">==</span> <span class="st">"WT-Saline"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>               fig3[group <span class="sc">==</span> <span class="st">"KO-Saline"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">var.equal =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>p.value</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  p4 <span class="ot">&lt;-</span> <span class="fu">t.test</span>(fig3[group <span class="sc">==</span> <span class="st">"WT-CL"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>               fig3[group <span class="sc">==</span> <span class="st">"KO-CL"</span>, <span class="fu">get</span>(lipid_id)],</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">var.equal =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>p.value</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  p_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    p_table,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"lipid_id"</span> <span class="ot">=</span> lipid_id,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      m1_pairs[, .SD, <span class="at">.SDcols =</span> <span class="fu">c</span>(<span class="st">"contrast"</span>, <span class="st">"p.value"</span>)],</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">ttest =</span> <span class="fu">c</span>(p1, p2, p3, p4)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust over all contrasts</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>pool_contrast <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(pool_contrast <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add 8 more cardiolipins not included in the plot</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># us lm pvalue instead of t test pvalue because t is less efficient</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  p_set <span class="ot">&lt;-</span> <span class="fu">c</span>(p_table[, p.value], <span class="fu">rep</span>(<span class="fl">0.99</span>, <span class="dv">8</span> <span class="sc">*</span> <span class="dv">4</span>)) <span class="co"># 8 cardiolipins * 4 contrasts</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  p_holm <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_set, <span class="st">"holm"</span>)[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">18</span> <span class="sc">*</span> <span class="dv">4</span>)]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  p_bh <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_set, <span class="st">"BH"</span>)[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">18</span> <span class="sc">*</span> <span class="dv">4</span>)]</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  p_by <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_set, <span class="st">"BY"</span>)[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">18</span> <span class="sc">*</span> <span class="dv">4</span>)]</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  p_table[, holm <span class="sc">:</span><span class="er">=</span> p_holm]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  p_table[, fdr_bh <span class="sc">:</span><span class="er">=</span> p_bh]</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  p_table[, fdr_by <span class="sc">:</span><span class="er">=</span> p_by]</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust within each contrast, not over all contrasts</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>by_contrast <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(by_contrast <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  contrast_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(p_table<span class="sc">$</span>contrast)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(contrast_i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(contrast_list)){</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    p_set <span class="ot">&lt;-</span> p_table[contrast <span class="sc">==</span> contrast_list[contrast_i], ttest]</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    p_set <span class="ot">&lt;-</span> <span class="fu">c</span>(p_set, <span class="fu">rep</span>(<span class="fl">0.99</span>, <span class="dv">8</span>))</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    p_holm <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_set, <span class="st">"holm"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    p_bh <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_set, <span class="st">"BH"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    p_by <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_set, <span class="st">"BY"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    p_table[contrast <span class="sc">==</span> contrast_list[contrast_i],</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>            holm <span class="sc">:</span><span class="er">=</span> p_holm]</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    p_table[contrast <span class="sc">==</span> contrast_list[contrast_i],</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>            fdr_bh <span class="sc">:</span><span class="er">=</span> p_bh]</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    p_table[contrast <span class="sc">==</span> contrast_list[contrast_i],</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>            fdr_by <span class="sc">:</span><span class="er">=</span> p_by]</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="co"># p_table_order &lt;- doBy::orderBy(~ contrast + lipid_id, p_table)</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co"># p_table_order[, .SD, .SDcols = setdiff(names(p_table), "contrast")] |&gt;</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   setnames("lipid_id", "") |&gt;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable(digits = 3) |&gt;</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable_styling(full_width = FALSE) |&gt;</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   pack_rows(contrast_list[1], 1, 18) |&gt;</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co">#   pack_rows(contrast_list[2], 19, 36) |&gt;</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">#   pack_rows(contrast_list[3], 37, 54)</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="co"># researcher results</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="co"># set1 d-h</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co">#WT: cl lower</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co">#KO: cl not lower</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="co"># set2 i-m</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co">#WT cl not lower</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co">#KO: cl lower</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co"># set3 n-u</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co">#WT cl higher</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="co">#KO: cl higher in 3/8</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="fu">data.table</span>(</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Method"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"lm (unadjusted)"</span>, <span class="st">"t test (unadjusted)"</span>, <span class="st">"BH (FDR)"</span>, <span class="st">"BY (FDR)"</span>, <span class="st">"Holm (FWER)"</span>),</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"N (p&lt;0.05)"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sum</span>(p_table[, p.value] <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(p_table[, ttest] <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(p_table[, fdr_bh] <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(p_table[, fdr_by] <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>(p_table[, holm] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-multiple-tests-fig3-pvals" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-multiple-tests-fig3-pvals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.4: Number of discoveries (<em>p</em> &lt; 0.05) among the 104 tests
</figcaption>
<div aria-describedby="tbl-multiple-tests-fig3-pvals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N (p&lt;0.05)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lm (unadjusted)</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">t test (unadjusted)</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BH (FDR)</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">BY (FDR)</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Holm (FWER)</td>
<td style="text-align: right;">7</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Notes on <a href="#tbl-multiple-tests-fig3-pvals" class="quarto-xref">Table&nbsp;<span>12.4</span></a></p>
<ol class="example" type="1">
<li>For these data, there are more discoveries (<em>p</em> &lt; 0.05) using the linear model with all four groups than using the pairwise <em>t</em>-tests used by the researchers. The linear model is <em>slightly</em> more powerful than pairwise <em>t</em>-tests because of a smaller SE, but differences in discovery rate between the two methods in any one batch will depend more on patterns of sample variances.</li>
<li>The BH adjustment reduced the number of discoveries by nearly half. The BY adjustment reduced the number of discoveries by nearly 2/3. BY is an FDR method based on Benjamini &amp; Yekutieli that is modified for non-independent tests. The tests here are not independent because the cardiolipin levels are correlated. Consequently, BY will have better control of FDR than BH.</li>
<li>The Holm adjustment reduced the number of discoveries by three-fourths. I include it here simply for comparison. As argued above, Holm, or any FWER, doesn’t answer the right question.</li>
<li>The researchers didn’t adjust. Should they have? If the goal is discovery on how combinations of LCN2 and CL316,243 effect cardiolipin synthesis, and they don’t have working models of the system, then yes, they should adjust.</li>
<li>One way that R, or any programming language, is more efficient than menu-driven statistical software is the ability to write scripts to combine analyses, which is what we need to do to adjust <em>p</em>-values from multiple fit statistical models.</li>
</ol>
</section>
<section id="better-know-fdr-sec-mult-tests-fdr" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="better-know-fdr-sec-mult-tests-fdr"><span class="header-section-number">12.5</span> Better Know FDR {sec-mult-tests-fdr}</h2>
<p>Use this simulation to explore FDR, FWER, and Type I error. Here, I use it to explore how the BH adjustment behaves in a batch of 100 tests in which only 20% have true effects, and a batch in which 80% have true effects. I use BH because the tests are independent in this simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>fileout_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"output"</span>, <span class="st">"chap_mult_tests_fdr_sim.Rds"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>do_it <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>n_tests <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(do_it){</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  out_table <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="cn">NULL</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(true_fraction <span class="cf">in</span> <span class="fu">c</span>(.<span class="dv">2</span>, <span class="fl">0.8</span>)){</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># true_fraction &lt;- .2 # fraction of tests with true effect</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    false_fraction <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> true_fraction <span class="co"># fraction of tests with no effect</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    n_true <span class="ot">&lt;-</span> true_fraction <span class="sc">*</span> n_tests <span class="co"># number of tests with true effect</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    n_false <span class="ot">&lt;-</span> false_fraction <span class="sc">*</span> n_tests <span class="co"># number of tests with no effect</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    power_exp <span class="ot">&lt;-</span> .<span class="dv">8</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    delta <span class="ot">&lt;-</span> <span class="fu">power.t.test</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">power =</span> power_exp, <span class="at">sig.level =</span> alpha)<span class="sc">$</span>delta</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    p_true <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_true)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    p_false <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_false)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    true_discoveries_none <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    false_nondiscoveries_none <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    false_discoveries_none <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    true_nondiscoveries_none <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    true_discoveries_holm <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    false_nondiscoveries_holm <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    false_discoveries_holm <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    true_nondiscoveries_holm <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    true_discoveries_fdr <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    false_nondiscoveries_fdr <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    false_discoveries_fdr <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    true_nondiscoveries_fdr <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    FWE_none <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    FWE_holm <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    FWE_fdr <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    type_1 <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    power <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_iter){</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_true){</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        p_true[j] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">10</span>), <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">mean =</span> delta), <span class="at">var.equal =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>p.value</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_false){</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        p_false[j] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">10</span>), <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">10</span>), <span class="at">var.equal =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>p.value</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      type_1 <span class="ot">&lt;-</span> type_1 <span class="sc">+</span> <span class="fu">sum</span>(p_false <span class="sc">&lt;</span> <span class="fl">0.05</span>)<span class="sc">/</span>n_false</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      power <span class="ot">&lt;-</span> power <span class="sc">+</span> <span class="fu">sum</span>(p_true <span class="sc">&lt;</span> <span class="fl">0.05</span>)<span class="sc">/</span>n_true</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      p_none <span class="ot">&lt;-</span> <span class="fu">c</span>(p_true, p_false)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      p_holm <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_none, <span class="at">method =</span> <span class="st">"holm"</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>      p_fdr <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_none, <span class="at">method =</span> <span class="st">"BH"</span>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>      p_true_holm <span class="ot">&lt;-</span> p_holm[<span class="dv">1</span><span class="sc">:</span>n_true]</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>      p_true_fdr <span class="ot">&lt;-</span> p_fdr[<span class="dv">1</span><span class="sc">:</span>n_true]</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>      p_false_holm <span class="ot">&lt;-</span> p_holm[(n_true <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n_tests]</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>      p_false_fdr <span class="ot">&lt;-</span> p_fdr[(n_true <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n_tests]</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">sum</span>(p_false <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">&gt;</span> <span class="dv">0</span>){FWE_none <span class="ot">&lt;-</span> FWE_none <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>      true_discoveries_none <span class="ot">&lt;-</span> true_discoveries_none <span class="sc">+</span> <span class="fu">sum</span>(p_true <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>      false_nondiscoveries_none <span class="ot">&lt;-</span> false_nondiscoveries_none <span class="sc">+</span> <span class="fu">sum</span>(p_true <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>      false_discoveries_none <span class="ot">&lt;-</span> false_discoveries_none <span class="sc">+</span> <span class="fu">sum</span>(p_false <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>      true_nondiscoveries_none <span class="ot">&lt;-</span> true_nondiscoveries_none <span class="sc">+</span> <span class="fu">sum</span>(p_false <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">sum</span>(p_false_holm <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">&gt;</span> <span class="dv">0</span>){FWE_holm <span class="ot">&lt;-</span> FWE_holm <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>      true_discoveries_holm <span class="ot">&lt;-</span> true_discoveries_holm <span class="sc">+</span> <span class="fu">sum</span>(p_true_holm <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>      false_nondiscoveries_holm <span class="ot">&lt;-</span> false_nondiscoveries_holm <span class="sc">+</span> <span class="fu">sum</span>(p_true_holm <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>      false_discoveries_holm <span class="ot">&lt;-</span> false_discoveries_holm <span class="sc">+</span> <span class="fu">sum</span>(p_false_holm <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>      true_nondiscoveries_holm <span class="ot">&lt;-</span> true_nondiscoveries_holm <span class="sc">+</span> <span class="fu">sum</span>(p_false_holm <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">sum</span>(p_false_fdr <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">&gt;</span> <span class="dv">0</span>){FWE_fdr <span class="ot">&lt;-</span> FWE_fdr <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>      true_discoveries_fdr <span class="ot">&lt;-</span> true_discoveries_fdr <span class="sc">+</span> <span class="fu">sum</span>(p_true_fdr <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>      false_nondiscoveries_fdr <span class="ot">&lt;-</span> false_nondiscoveries_fdr <span class="sc">+</span> <span class="fu">sum</span>(p_true_fdr <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>      false_discoveries_fdr <span class="ot">&lt;-</span> false_discoveries_fdr <span class="sc">+</span> <span class="fu">sum</span>(p_false_fdr <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>      true_nondiscoveries_fdr <span class="ot">&lt;-</span> true_nondiscoveries_fdr <span class="sc">+</span> <span class="fu">sum</span>(p_false_fdr <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    total_discoveries_none <span class="ot">&lt;-</span> true_discoveries_none <span class="sc">+</span> false_discoveries_none</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    total_non_discoveries_none <span class="ot">&lt;-</span> false_nondiscoveries_none <span class="sc">+</span> true_nondiscoveries_none</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    TDR_none <span class="ot">&lt;-</span> true_discoveries_none<span class="sc">/</span>total_discoveries_none</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    FDR_none <span class="ot">&lt;-</span> false_discoveries_none<span class="sc">/</span>total_discoveries_none</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    FNDR_none <span class="ot">&lt;-</span> false_nondiscoveries_none<span class="sc">/</span>total_non_discoveries_none</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    type_1_none <span class="ot">&lt;-</span> false_discoveries_none<span class="sc">/</span>n_false<span class="sc">/</span>n_iter</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    power_none <span class="ot">&lt;-</span> true_discoveries_none<span class="sc">/</span>n_true<span class="sc">/</span>n_iter</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    FWER_none <span class="ot">&lt;-</span> FWE_none<span class="sc">/</span>n_iter</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    total_discoveries_holm <span class="ot">&lt;-</span> true_discoveries_holm <span class="sc">+</span> false_discoveries_holm</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    total_non_discoveries_holm <span class="ot">&lt;-</span> false_nondiscoveries_holm <span class="sc">+</span> true_nondiscoveries_holm</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>    TDR_holm <span class="ot">&lt;-</span> true_discoveries_holm<span class="sc">/</span>total_discoveries_holm</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>    FDR_holm <span class="ot">&lt;-</span> false_discoveries_holm<span class="sc">/</span>total_discoveries_holm</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    FNDR_holm <span class="ot">&lt;-</span> false_nondiscoveries_holm<span class="sc">/</span>total_non_discoveries_holm</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    type_1_holm <span class="ot">&lt;-</span> false_discoveries_holm<span class="sc">/</span>n_false<span class="sc">/</span>n_iter</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    power_holm <span class="ot">&lt;-</span> true_discoveries_holm<span class="sc">/</span>n_true<span class="sc">/</span>n_iter</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    FWER_holm <span class="ot">&lt;-</span> FWE_holm<span class="sc">/</span>n_iter</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    total_discoveries_fdr <span class="ot">&lt;-</span> true_discoveries_fdr <span class="sc">+</span> false_discoveries_fdr</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    total_non_discoveries_fdr <span class="ot">&lt;-</span> false_nondiscoveries_fdr <span class="sc">+</span> true_nondiscoveries_fdr</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>    TDR_fdr <span class="ot">&lt;-</span> true_discoveries_fdr<span class="sc">/</span>total_discoveries_fdr</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    FDR_fdr <span class="ot">&lt;-</span> false_discoveries_fdr<span class="sc">/</span>total_discoveries_fdr</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    FNDR_fdr <span class="ot">&lt;-</span> false_nondiscoveries_fdr<span class="sc">/</span>total_non_discoveries_fdr</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>    type_1_fdr <span class="ot">&lt;-</span> false_discoveries_fdr<span class="sc">/</span>n_false<span class="sc">/</span>n_iter</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>    power_fdr <span class="ot">&lt;-</span> true_discoveries_fdr<span class="sc">/</span>n_true<span class="sc">/</span>n_iter</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>    FWER_fdr <span class="ot">&lt;-</span> FWE_fdr<span class="sc">/</span>n_iter</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>    out_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>      out_table,</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.table</span>(</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">true_frac =</span> true_fraction,</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">Stat =</span> <span class="fu">c</span>(<span class="st">"TD"</span>, <span class="st">"FD"</span>, <span class="st">"TDR"</span>, <span class="st">"FDR"</span>, <span class="st">"FNDR"</span>, <span class="st">"Type1"</span>, <span class="st">"power"</span>, <span class="st">"FWER"</span>),</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>        <span class="at">None =</span> <span class="fu">c</span>(true_discoveries_none, false_discoveries_none, TDR_none,</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>                 FDR_none, FNDR_none, type_1_none, power_none, FWER_none),</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>        <span class="at">Holm =</span> <span class="fu">c</span>(true_discoveries_holm, false_discoveries_holm, TDR_holm,</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>                 FDR_holm, FNDR_holm, type_1_holm, power_holm, FWER_holm),</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">FDR =</span> <span class="fu">c</span>(true_discoveries_fdr, false_discoveries_fdr, TDR_fdr,</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>                FDR_fdr, FNDR_fdr, type_1_fdr, power_fdr, FWER_fdr)</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(out_table, fileout_path)</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>  out_table <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fileout_path)</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>  out_table_keep <span class="ot">&lt;-</span> out_table[Stat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FDR"</span>, <span class="st">"FNDR"</span>, <span class="st">"Type1"</span>, <span class="st">"power"</span>, <span class="st">"FWER"</span>), ]</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>  row_digits <span class="ot">&lt;-</span> <span class="cf">function</span>(df, d){</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># df is a data.frame or data.table</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># d is a single value for all rows or vector of digits for each row</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    inc <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(df, is.numeric)))</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">Filter</span>(is.numeric, df), d)<span class="sc">|&gt;</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>      <span class="fu">apply</span>(<span class="dv">2</span>, as.character) <span class="sc">|&gt;</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.table</span>()</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>    df_out <span class="ot">&lt;-</span> <span class="fu">apply</span>(df, <span class="dv">2</span>, as.character) <span class="sc">|&gt;</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.table</span>()</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>    df_out[, inc] <span class="ot">&lt;-</span> x</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df_out)</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">''</span>)</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="co">#  out_table_keep[, .SD, .SDcols = c("Stat", "None", "Holm", "FDR")] |&gt;</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>  out_table_keep[, true_frac <span class="sc">:</span><span class="er">=</span> <span class="st">" "</span>]</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setnames</span>(out_table_keep, <span class="st">"true_frac"</span>, <span class="st">" "</span>)</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>  out_table_keep <span class="sc">|&gt;</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">"True Fraction = 0.2"</span>, <span class="dv">1</span>, <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">"True Fraction = 0.8"</span>, <span class="dv">6</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-mult-tests-fdr-simulation" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mult-tests-fdr-simulation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.5: Performance statistics for no adjustment, BH adjustment, and Holm adjustment for a batch of 100 independent tests with two different fractions of true effects. FNDR is the False Non-Discovery Rate, the fraction of false non-discoveries (p &gt; 0.05 but the effect is true) to the total number of non-discoveries (p &gt; 0.05). We want this fraction to be low.
</figcaption>
<div aria-describedby="tbl-mult-tests-fdr-simulation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Stat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">None</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Holm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FDR</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="5">
<td colspan="5" style="border-bottom: 1px solid"><strong>True Fraction = 0.2</strong></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">FDR</td>
<td style="text-align: right;">0.200</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: right;">0.047</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">FNDR</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">0.173</td>
<td style="text-align: right;">0.126</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">Type1</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.005</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">power</td>
<td style="text-align: right;">0.801</td>
<td style="text-align: right;">0.164</td>
<td style="text-align: right;">0.424</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">FWER</td>
<td style="text-align: right;">0.985</td>
<td style="text-align: right;">0.040</td>
<td style="text-align: right;">0.324</td>
</tr>
<tr class="odd" data-grouplength="5">
<td colspan="5" style="border-bottom: 1px solid"><strong>True Fraction = 0.8</strong></td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">FDR</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.010</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">FNDR</td>
<td style="text-align: right;">0.457</td>
<td style="text-align: right;">0.768</td>
<td style="text-align: right;">0.536</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">Type1</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.030</td>
</tr>
<tr class="odd">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">power</td>
<td style="text-align: right;">0.801</td>
<td style="text-align: right;">0.174</td>
<td style="text-align: right;">0.720</td>
</tr>
<tr class="even">
<td style="text-align: right; padding-left: 2em;" data-indentlevel="1"></td>
<td style="text-align: left;">FWER</td>
<td style="text-align: right;">0.641</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: right;">0.449</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Notes on <a href="#tbl-mult-tests-fdr-simulation" class="quarto-xref">Table&nbsp;<span>12.5</span></a></p>
<ol type="1">
<li>Note that it’s not the Type I error rate that increases with multiple tests, it’s the FWER that increases. It’s important to understand this difference. If every test answers a different question, all we care about is the Type I error rate.</li>
<li>If a batch of tests contains both true effects and null (zero) effects, the fraction of tests with true effects doesn’t effect the Type I error rate because the denominator is not the number of tests but the number of tests with no true effect.</li>
<li>If a batch of tests contains both true effects and null effects, the fraction of tests with true effects <strong>does</strong> effect the FDR because there are more false discoveries relative to true discoveries as the fraction of tests with true effects goes to zero. Remember, the denominator is the sum of false and true discoveries. If there are no true effects, 100% of the discoveries are false! If there are only true effects, 0% of the discoveries are false!</li>
</ol>
</section>
<section id="working-in-r" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="working-in-r"><span class="header-section-number">12.6</span> Working in R</h2>
<section id="the-contrast-function-has-different-default-adjustment-methods-for-each-of-the-contrast-methods" class="level3" data-number="12.6.1">
<h3 data-number="12.6.1" class="anchored" data-anchor-id="the-contrast-function-has-different-default-adjustment-methods-for-each-of-the-contrast-methods"><span class="header-section-number">12.6.1</span> The contrast() function has different default adjustment methods for each of the contrast methods</h3>
<ol type="1">
<li>Tukey HSD is the default for all pairwise contrasts using either <code>method = "pairwise"</code> or <code>method = "revpairwise"</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the exfig2 data to explore this</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(nefa <span class="sc">~</span> treatment, <span class="at">data =</span> exfig2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="st">"treatment"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>m1_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"revpairwise"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>m1_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate    SE df lower.CL upper.CL t.ratio p.value
 3q - con    -1.09 0.407 26  -2.1011  -0.0793  -2.680  0.0327
 4i - con     1.05 0.396 26   0.0642   2.0320   2.647  0.0351
 4i - 3q      2.14 0.407 26   1.1274   3.1491   5.256  &lt;.0001

Confidence level used: 0.95 
Conf-level adjustment: tukey method for comparing a family of 3 estimates 
P value adjustment: tukey method for comparing a family of 3 estimates </code></pre>
</div>
</div>
<p>Notes:</p>
<ol type="1">
<li>The adjustment method for both the confidence interval and the <em>p</em>-value is given in the contrast object.</li>
<li>Dunnett’s test is the default for comparing all treatments (non-reference groups) to the control (the reference group). Both <code>method = "trt.vs.ctrl"</code> and <code>method = "dunnett"</code> work.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the exfig2 data to explore this</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(nefa <span class="sc">~</span> treatment, <span class="at">data =</span> exfig2)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="st">"treatment"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>m1_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"trt.vs.ctrl"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>m1_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate    SE df lower.CL upper.CL t.ratio p.value
 3q - con    -1.09 0.407 26   -2.047   -0.133  -2.680  0.0241
 4i - con     1.05 0.396 26    0.117    1.979   2.647  0.0260

Confidence level used: 0.95 
Conf-level adjustment: dunnettx method for 2 estimates 
P value adjustment: dunnettx method for 2 tests </code></pre>
</div>
</div>
</section>
<section id="for-non-default-adjustment-use-the-adjust-argument" class="level3" data-number="12.6.2">
<h3 data-number="12.6.2" class="anchored" data-anchor-id="for-non-default-adjustment-use-the-adjust-argument"><span class="header-section-number">12.6.2</span> For non-default adjustment, use the <code>adjust =</code> argument</h3>
<p>For no adjustment, use <code>adjust = "none"</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the exfig2 data to explore this</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(nefa <span class="sc">~</span> treatment, <span class="at">data =</span> exfig2)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="st">"treatment"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>m1_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"revpairwise"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>m1_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate    SE df lower.CL upper.CL t.ratio p.value
 3q - con    -1.09 0.407 26   -1.926   -0.254  -2.680  0.0126
 4i - con     1.05 0.396 26    0.234    1.862   2.647  0.0136
 4i - 3q      2.14 0.407 26    1.302    2.974   5.256  &lt;.0001

Confidence level used: 0.95 </code></pre>
</div>
</div>
</section>
<section id="sec-mult-tests-adjust-options" class="level3" data-number="12.6.3">
<h3 data-number="12.6.3" class="anchored" data-anchor-id="sec-mult-tests-adjust-options"><span class="header-section-number">12.6.3</span> Options in <code>adjust =</code></h3>
<ol type="1">
<li>“none” – no adjustment.</li>
</ol>
<p>Options for controlling FDR</p>
<ol start="2" type="1">
<li>“BH” or “fdr” – controls the <a href="https://en.wikipedia.org/wiki/False_discovery_rate" target="_blank">false discovery rate</a> using the logic of Benjamini &amp; Hochberg. The BH method assumes independent tests. This or BY should be used for most uses of <em>p</em>-value adjustment in experimental bench biology.</li>
<li>“BY” – is a modification of BH using the logic of Benjamini &amp; Yekutieli. The BY method relaxes the independent test assumption and consequently is more consertive than BH. This or BY should be used for most uses of <em>p</em>-value adjustment in experimental bench biology.</li>
</ol>
<p>General options for controlling FWER</p>
<ol start="4" type="1">
<li>“holm” – <a href="https://en.wikipedia.org/wiki/Holm–Bonferroni_method" target="_blank">Holm-Bonferroni</a> is the Holm modification of Bonferroni and is used to control the FWER. It is more powerful than Bonferroni while still holding FWER at alpha. For most uses of <em>p</em>-value adjustment in experimental bench biology, we are less interested in controling the FWER than the FDR.</li>
<li>“bonferroni” – <a href="https://en.wikipedia.org/wiki/Bonferroni_correction" target="_blank">Bonferroni</a> is the original, general-purpose adjustment for a set of <em>p</em>-values to control the FWER. It has less power than the Holm modification, so it’s use should be historic only.</li>
<li>“mvt” – based on the multivariate <em>t</em> distribution and using covariance structure of the variables.</li>
</ol>
<p>Options for controlling FWER that are specific to experimental designs</p>
<ol start="7" type="1">
<li>“dunnettx” – <a href="https://en.wikipedia.org/wiki/Dunnett%27s_test" target="_blank">Dunnett’s test</a> is a method used when comparing all treatments to a single control.</li>
<li>“tukey” – <a href="https://en.wikipedia.org/wiki/Tukey%27s_range_test" target="_blank">Tukey’s HSD method</a> is a method used to compare all pairwise comparisons.</li>
</ol>
</section>
<section id="using-the-p.adjust-function" class="level3" data-number="12.6.4">
<h3 data-number="12.6.4" class="anchored" data-anchor-id="using-the-p.adjust-function"><span class="header-section-number">12.6.4</span> Using the p.adjust() function</h3>
<p>We use the base R <code>p.adjust()</code> function to adjust a set of <em>p</em>-values that were computed from different models, as in Example 3 above.</p>
<p>But to show a very simple example of using the <code>p.adjust()</code> function, let’s use the lipocalin Fig3 data. First get the p values for the four simple effects on the cardiolipin in panel d.&nbsp;Be sure to use the <code>adjust = "none</code> argument because we want to adjust unadjusted <em>p</em>-values!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cardiolipin_d <span class="sc">~</span> genotype <span class="sc">*</span> treatment, <span class="at">data =</span> fig3)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the four simple effect p-values</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>m1_simple <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"revpairwise"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">simple =</span> <span class="st">"each"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">combine =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the p-values</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>p_fig3d <span class="ot">&lt;-</span> m1_simple[, p.value]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>p_fig3d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.034802754 0.497327407 0.003147072 0.668086400</code></pre>
</div>
</div>
<p>Now, use the <code>p.adjust()</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p_fdr_BH_fig3d <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_fig3d, <span class="st">"BH"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>p_fdr_BH_fig3d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06960551 0.66310321 0.01258829 0.66808640</code></pre>
</div>
</div>
<p>Notes:</p>
<ol type="1">
<li>Again, we wouldn’t typically do this, we would simply use the “adjust =” argument within the <code>contrast()</code> function and not bother to extract the <em>p</em>-values and then adjust these, as done here.</li>
<li>When we would want to extract the <em>p</em>-values and adjust is when we have multiple responses for the same experiment and these responses answer the same question, which is common in experimental bench biology and is the case for all three examples above.</li>
</ol>
<section id="options-in-p.adjust" class="level4" data-number="12.6.4.1">
<h4 data-number="12.6.4.1" class="anchored" data-anchor-id="options-in-p.adjust"><span class="header-section-number">12.6.4.1</span> Options in p.adjust()</h4>
<ol type="1">
<li>“BH” or “fdr” – controls the <a href="https://en.wikipedia.org/wiki/False_discovery_rate" target="_blank">false discovery rate</a> using the logic of Benjamini &amp; Hochberg. The BH method assumes independent tests. This or BY should be used for most uses of <em>p</em>-value adjustment in experimental bench biology.</li>
<li>“BY” – is a modification of BH using the logic of Benjamini &amp; Yekutieli. The BY method relaxes the independent test assumption and consequently is more consertive than BH. This or BY should be used for most uses of <em>p</em>-value adjustment in experimental bench biology.</li>
<li>“holm” – <a href="https://en.wikipedia.org/wiki/Holm–Bonferroni_method" target="_blank">Holm-Bonferroni</a> is the Holm modification of Bonferroni and is used to control the FWER. It is more powerful than Bonferroni while still holding FWER at alpha. For most uses of <em>p</em>-value adjustment in experimental bench biology, we are less interested in controling the FWER than the FDR.</li>
<li>“bonferroni” – <a href="https://en.wikipedia.org/wiki/Bonferroni_correction" target="_blank">Bonferroni</a> is the original, general-purpose adjustment for a set of <em>p</em>-values to control the FWER. It has less power than the Holm modification, so it’s use should be historic only.</li>
</ol>
</section>
</section>
<section id="a-holm-sidak-function-for-reproducing-graphpad-prism-results" class="level3" data-number="12.6.5">
<h3 data-number="12.6.5" class="anchored" data-anchor-id="a-holm-sidak-function-for-reproducing-graphpad-prism-results"><span class="header-section-number">12.6.5</span> A Holm-Sidak function for reproducing GraphPad Prism results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>holm_sidak <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assume alpha = 0.05</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(p)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  rank_p <span class="ot">&lt;-</span> <span class="fu">frank</span>(p)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  inv_rank_p <span class="ot">&lt;-</span> n <span class="sc">-</span> rank_p <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put pvalues and the inv rankings in rank order</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  p_order <span class="ot">&lt;-</span> p[<span class="fu">order</span>(p)]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  inv_rank_order <span class="ot">&lt;-</span> inv_rank_p[<span class="fu">order</span>(p)]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the adjusted p-value</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  p_holm_sidak_order <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> p_order)<span class="sc">^</span>(inv_rank_order))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adjusted p-values of higher rank cannot be less than adjusted p-value of lower rank</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># so find and adjust these</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n){</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p_holm_sidak_order[j] <span class="sc">&lt;</span> p_holm_sidak_order[j<span class="dv">-1</span>]){</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      p_holm_sidak_order[j] <span class="ot">&lt;-</span> p_holm_sidak_order[j<span class="dv">-1</span>]</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># any adjusted &gt; 1 make 1</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  p_holm_sidak_order[p_holm_sidak_order <span class="sc">&gt;</span> <span class="fl">1.0</span>] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put back into original order</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  p_holm_sidak <span class="ot">&lt;-</span> p_holm_sidak_order[rank_p]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p_holm_sidak)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes:</p>
<ol type="1">
<li>This function only computes the Holm-Sidak <em>p</em>-value and not the adjusted CIs. The emmeans package uses Bonferroni intervals for the Holm adjustment, and these should be used for the Holm-Sidak adjustment. The function <code>RHSDB::rh.sd.sidak</code> computes CIs in addition to the <em>p</em>-values but I haven’t sleuthed out what these are.</li>
<li>This function is used exactly like any other R function. Here I compare both Holm and Holm-Sidak for the Lipocalin Fig3 dataset. Just like the Sidak adjustment is slightly more powerful than Bonferroni, the Holm-Sidak is slightly more powerful than Holm. These tiny differences are rather moot, given the TL;DR at the start of this chapter (<a href="#sec-multiple-tests" class="quarto-xref"><span>Chapter 12</span></a>).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cardiolipin_d <span class="sc">~</span> genotype <span class="sc">*</span> treatment, <span class="at">data =</span> fig3)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>m1_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(m1, <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the four simple effect p-values</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>m1_simple <span class="ot">&lt;-</span> <span class="fu">contrast</span>(m1_emm,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"revpairwise"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">simple =</span> <span class="st">"each"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">combine =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># compute holm</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>m1_simple[, holm <span class="sc">:</span><span class="er">=</span> <span class="fu">p.adjust</span>(p.value, <span class="st">"holm"</span>)]</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># compute holm-sidak</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>m1_simple[, holm_sidak <span class="sc">:</span><span class="er">=</span> <span class="fu">holm_sidak</span>(p.value)]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>m1_simple <span class="sc">|&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lower.CL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper.CL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">t.ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">holm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">holm_sidak</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Saline</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">KO - WT</td>
<td style="text-align: right;">-0.023</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.043</td>
<td style="text-align: right;">-0.002</td>
<td style="text-align: right;">-2.3</td>
<td style="text-align: right;">0.0348</td>
<td style="text-align: right;">0.1044</td>
<td style="text-align: right;">0.1008</td>
</tr>
<tr class="even">
<td style="text-align: left;">CL</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">KO - WT</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.012</td>
<td style="text-align: right;">0.024</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">0.4973</td>
<td style="text-align: right;">0.9947</td>
<td style="text-align: right;">0.7473</td>
</tr>
<tr class="odd">
<td style="text-align: left;">.</td>
<td style="text-align: left;">WT</td>
<td style="text-align: left;">CL - Saline</td>
<td style="text-align: right;">-0.033</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.052</td>
<td style="text-align: right;">-0.013</td>
<td style="text-align: right;">-3.6</td>
<td style="text-align: right;">0.0031</td>
<td style="text-align: right;">0.0126</td>
<td style="text-align: right;">0.0125</td>
</tr>
<tr class="even">
<td style="text-align: left;">.</td>
<td style="text-align: left;">KO</td>
<td style="text-align: left;">CL - Saline</td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.024</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">-0.4</td>
<td style="text-align: right;">0.6681</td>
<td style="text-align: right;">0.9947</td>
<td style="text-align: right;">0.7473</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="hidden-import-code" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="hidden-import-code"><span class="header-section-number">12.7</span> Hidden Import Code</h2>
<section id="sec-exfig2-import-unhide" class="level3" data-number="12.7.1">
<h3 data-number="12.7.1" class="anchored" data-anchor-id="sec-exfig2-import-unhide"><span class="header-section-number">12.7.1</span> Example 1 (exfig2 data)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"A brain-to-gut signal controls intestinal fat absorption"</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41586_2024_7929_MOESM13_ESM.xlsx"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>exfig2_import <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">phenotype =</span> <span class="st">"xxx"</span>, <span class="at">range_in =</span> <span class="st">"xxx"</span>){</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  exfig2_part <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sheet =</span> <span class="st">"Sheet1"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">range =</span> range_in,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">melt</span>(<span class="at">variable.name =</span> <span class="st">"treatment"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">value.name =</span> phenotype)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(exfig2_part)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>exfig2 <span class="ot">&lt;-</span> <span class="fu">exfig2_import</span>(<span class="at">phenotype =</span> <span class="st">"nefa"</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">range =</span> <span class="st">"A47:C57"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>exfig2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(exfig2,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fecal_tg"</span> <span class="ot">=</span> <span class="fu">exfig2_import</span>(<span class="at">phenotype =</span> <span class="st">"fecal_tg"</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">range =</span> <span class="st">"A64:C74"</span>)<span class="sc">$</span>fecal_tg)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>exfig2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(exfig2,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"jejunal_tg"</span> <span class="ot">=</span> <span class="fu">exfig2_import</span>(<span class="at">phenotype =</span> <span class="st">"jejunal_tg"</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">range =</span> <span class="st">"A81:C91"</span>)<span class="sc">$</span>jejunal_tg)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>exfig2[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">unique</span>(treatment))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-fig5l-import-unhide" class="level3" data-number="12.7.2">
<h3 data-number="12.7.2" class="anchored" data-anchor-id="sec-fig5l-import-unhide"><span class="header-section-number">12.7.2</span> Example 2 (fig5l data)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"A brain-to-gut signal controls intestinal fat absorption"</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41586_2024_7929_MOESM11_ESM.xlsx"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fig5l <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"Sheet1"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A133:AG137"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transpose</span>(<span class="at">make.names =</span> <span class="dv">1</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fig5l)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"treatment_orig"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>fig5l[, ezrin <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(ezrin)]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>fig5l[, cdc42 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(cdc42)]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>fig5l[, eps8 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(eps8)]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>fig5l[, vil1 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(vil1)]</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>fig5l[, treatment_orig <span class="sc">:</span><span class="er">=</span> <span class="fu">fill_down</span>(treatment_orig)]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>fig5l[treatment_orig <span class="sc">==</span> <span class="st">"flox-veh"</span>, group <span class="sc">:</span><span class="er">=</span> <span class="st">"WT Vehicle"</span>]</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>fig5l[treatment_orig <span class="sc">==</span> <span class="st">"flox-Pue"</span>, group <span class="sc">:</span><span class="er">=</span> <span class="st">"WT Puerarin"</span>]</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>fig5l[treatment_orig <span class="sc">==</span> <span class="st">"KO-veh"</span>, group <span class="sc">:</span><span class="er">=</span> <span class="st">"KO Vehicle"</span>]</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>fig5l[treatment_orig <span class="sc">==</span> <span class="st">"KO-Pue"</span>, group <span class="sc">:</span><span class="er">=</span> <span class="st">"KO Puerarin"</span>]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>fig5l[, group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(group, <span class="at">levels =</span> <span class="fu">unique</span>(group))]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>fig5l[, <span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"treatment"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(group, <span class="st">" "</span>)]</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>fig5l[, genotype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(genotype, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"KO"</span>))]</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>fig5l[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Vehicle"</span>, <span class="st">"Puerarin"</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-fig3-import-unhide" class="level3" data-number="12.7.3">
<h3 data-number="12.7.3" class="anchored" data-anchor-id="sec-fig3-import-unhide"><span class="header-section-number">12.7.3</span> Example 3 (fig3 data)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Lipocalin 2 regulates mitochondrial phospholipidome remodeling, dynamics, and function in brown adipose tissue in male mice"</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41467_2023_42473_MOESM7_ESM.xlsx"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># note I had to insert rows in the excel file </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># in between some of the</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># sets because of inconsistency in the file</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>fig3_import <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">range_in =</span> <span class="st">"xxx"</span>, <span class="at">lipid_id =</span> <span class="st">"xxx"</span>){</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  fig3_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sheet =</span> <span class="st">"Fig. 3"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">range =</span> range_in) <span class="sc">|&gt;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>()</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  fig3_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig3_wide,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">measure.vars =</span> <span class="fu">colnames</span>(fig3_wide),</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">variable.name =</span> <span class="st">"group"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">value.name =</span> <span class="fu">paste0</span>(<span class="st">"cardiolipin_"</span>, lipid_id))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  fig3_long[, group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(group,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">colnames</span>(fig3_wide))]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  fig3_long[, mouse_id <span class="sc">:</span><span class="er">=</span> .I]</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fig3_long)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>fig3 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="cn">NULL</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>row_1 <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fig_id <span class="cf">in</span> letters[<span class="dv">4</span><span class="sc">:</span><span class="dv">21</span>]){</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  row_2 <span class="ot">&lt;-</span> row_1 <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  range_in <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span>,row_1,<span class="st">":E"</span>,row_2</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(fig_id <span class="sc">==</span> letters[<span class="dv">4</span>]){</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    fig3 <span class="ot">&lt;-</span> <span class="fu">fig3_import</span>(range_in, fig_id)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    fig3_part <span class="ot">&lt;-</span> <span class="fu">fig3_import</span>(range_in, fig_id)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    fig3 <span class="ot">&lt;-</span> <span class="fu">merge</span>(fig3, fig3_part, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"mouse_id"</span>, <span class="st">"group"</span>))</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fig3 &lt;- rbind(</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   fig3,</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   data.table(</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     figure = fig_id,</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     fig3_import(range_in))</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  row_1 <span class="ot">&lt;-</span> row_2 <span class="sc">+</span> <span class="dv">4</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co"># row 5 and 15 have all missing data</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>fig3 <span class="ot">&lt;-</span> fig3[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">15</span>), ]</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>fig3[, <span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"treatment"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(group, <span class="st">"-"</span>)]</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>y_cols <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">substr</span>(<span class="fu">names</span>(fig3), <span class="dv">1</span>, <span class="dv">11</span>) <span class="sc">==</span> <span class="st">"cardiolipin"</span>)</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>fig3 <span class="ot">&lt;-</span> fig3[, .SD, .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"mouse_id"</span>, <span class="st">"group"</span>, <span class="st">"genotype"</span>, <span class="st">"treatment"</span>, <span class="fu">names</span>(fig3)[y_cols])]</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>fig3[, group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(group, <span class="at">levels =</span> <span class="fu">unique</span>(group))]</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>fig3[, genotype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(genotype, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"KO"</span>))]</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>fig3[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Saline"</span>, <span class="st">"CL"</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/model-checking.html" class="pagination-link" aria-label="Model checking">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model checking</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/two-factors.html" class="pagination-link" aria-label="Linear models with two categorical $X$ -- Factorial linear models (&quot;two-way ANOVA&quot;)">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Linear models with two categorical <span class="math inline">\(X\)</span> – Factorial linear models (“two-way ANOVA”)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>