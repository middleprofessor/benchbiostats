<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>17&nbsp; Models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models – Statistics for the Experimental Bench Biologist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/longitudinal.html" rel="next">
<link href="../chapters/lmm.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/glm.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistics for the Experimental Bench Biologist</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Front Matter</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analyzing experimental data with a linear model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started – R Projects and R Markdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/reading-writing-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data – Reading, Wrangling, and Writing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/plotting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/uncertainty-sd-and-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Variability and Uncertainty (Standard Deviations, Standard Errors, and Confidence Intervals)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/p-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">P-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Errors in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro-stat-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">An introduction to linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/continuous_x.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear models with a single, continuous <em>X</em> (“linear regression”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/one-factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear models with a single, categorical <em>X</em> (“t-tests” and “ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/model-checking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model checking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/multiple-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple tests – why and when to adjust <em>p</em>-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Issues in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/two-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models with two categorical <span class="math inline">\(X\)</span> – Factorial linear models (“two-way ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Linear models with added covariates (“ANCOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/lmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Models for non-independence – linear mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/glm.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Linear models for longitudinal experiments</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr"><span class="header-section-number">17.1</span> TL;DR</a></li>
  <li><a href="#glm-counts" id="toc-glm-counts" class="nav-link" data-scroll-target="#glm-counts"><span class="header-section-number">17.2</span> Introducing Generalized Linear Models using count data examples</a>
  <ul>
  <li><a href="#the-generalized-linear-model-glm" id="toc-the-generalized-linear-model-glm" class="nav-link" data-scroll-target="#the-generalized-linear-model-glm"><span class="header-section-number">17.2.1</span> The Generalized Linear Model (GLM)</a></li>
  </ul></li>
  <li><a href="#kinds-of-data-that-are-modeled-by-a-glm" id="toc-kinds-of-data-that-are-modeled-by-a-glm" class="nav-link" data-scroll-target="#kinds-of-data-that-are-modeled-by-a-glm"><span class="header-section-number">17.3</span> Kinds of data that are modeled by a GLM</a></li>
  <li><a href="#which-model-and-why" id="toc-which-model-and-why" class="nav-link" data-scroll-target="#which-model-and-why"><span class="header-section-number">17.4</span> Which model and why</a>
  <ul>
  <li><a href="#count-data" id="toc-count-data" class="nav-link" data-scroll-target="#count-data"><span class="header-section-number">17.4.1</span> Count data</a>
  <ul class="collapse">
  <li><a href="#alternative-models" id="toc-alternative-models" class="nav-link" data-scroll-target="#alternative-models"><span class="header-section-number">17.4.1.1</span> Alternative models</a></li>
  <li><a href="#the-likelihood-ratio-test-lrt-is-alternative-to-the-wald-test-for-glms." id="toc-the-likelihood-ratio-test-lrt-is-alternative-to-the-wald-test-for-glms." class="nav-link" data-scroll-target="#the-likelihood-ratio-test-lrt-is-alternative-to-the-wald-test-for-glms."><span class="header-section-number">17.4.1.2</span> The Likelihood Ratio Test (LRT) is alternative to the Wald test for GLMs.</a></li>
  <li><a href="#simulation-shows-that-a-quasipoisson-model-qp-has-the-best-performance-over-the-parameter-space" id="toc-simulation-shows-that-a-quasipoisson-model-qp-has-the-best-performance-over-the-parameter-space" class="nav-link" data-scroll-target="#simulation-shows-that-a-quasipoisson-model-qp-has-the-best-performance-over-the-parameter-space"><span class="header-section-number">17.4.1.3</span> Simulation shows that a quasipoisson model (qp) has the best performance over the parameter space</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-glm-count" id="toc-sec-glm-count" class="nav-link" data-scroll-target="#sec-glm-count"><span class="header-section-number">17.5</span> Example 1 – GLM models for count responses (“angiogenic sprouts” fig3a)</a>
  <ul>
  <li><a href="#understand-the-data" id="toc-understand-the-data" class="nav-link" data-scroll-target="#understand-the-data"><span class="header-section-number">17.5.1</span> Understand the data</a></li>
  <li><a href="#model-fit-and-inference" id="toc-model-fit-and-inference" class="nav-link" data-scroll-target="#model-fit-and-inference"><span class="header-section-number">17.5.2</span> Model fit and inference</a>
  <ul class="collapse">
  <li><a href="#fit-the-models" id="toc-fit-the-models" class="nav-link" data-scroll-target="#fit-the-models"><span class="header-section-number">17.5.2.1</span> Fit the models</a></li>
  <li><a href="#check-the-models" id="toc-check-the-models" class="nav-link" data-scroll-target="#check-the-models"><span class="header-section-number">17.5.2.2</span> Check the models</a></li>
  <li><a href="#glm-fig3a-qp-inference" id="toc-glm-fig3a-qp-inference" class="nav-link" data-scroll-target="#glm-fig3a-qp-inference"><span class="header-section-number">17.5.2.3</span> Inference from the model</a></li>
  <li><a href="#lmm-exp5c-plotthemodel" id="toc-lmm-exp5c-plotthemodel" class="nav-link" data-scroll-target="#lmm-exp5c-plotthemodel"><span class="header-section-number">17.5.2.4</span> Plot the model</a></li>
  <li><a href="#alternaplot-the-model" id="toc-alternaplot-the-model" class="nav-link" data-scroll-target="#alternaplot-the-model"><span class="header-section-number">17.5.2.5</span> Alternaplot the model</a></li>
  </ul></li>
  <li><a href="#understanding-example-1" id="toc-understanding-example-1" class="nav-link" data-scroll-target="#understanding-example-1"><span class="header-section-number">17.5.3</span> Understanding Example 1</a>
  <ul class="collapse">
  <li><a href="#modeling-strategy" id="toc-modeling-strategy" class="nav-link" data-scroll-target="#modeling-strategy"><span class="header-section-number">17.5.3.1</span> Modeling strategy</a></li>
  <li><a href="#model-checking-fits-to-count-data" id="toc-model-checking-fits-to-count-data" class="nav-link" data-scroll-target="#model-checking-fits-to-count-data"><span class="header-section-number">17.5.3.2</span> Model checking fits to count data</a></li>
  <li><a href="#biological-count-data-are-rarely-fit-well-by-a-poisson-glm.-instead-fit-a-quasi-poisson-or-negative-binomial-glm-model." id="toc-biological-count-data-are-rarely-fit-well-by-a-poisson-glm.-instead-fit-a-quasi-poisson-or-negative-binomial-glm-model." class="nav-link" data-scroll-target="#biological-count-data-are-rarely-fit-well-by-a-poisson-glm.-instead-fit-a-quasi-poisson-or-negative-binomial-glm-model."><span class="header-section-number">17.5.3.3</span> Biological count data are rarely fit well by a Poisson GLM. Instead, fit a quasi-poisson or Negative Binomial GLM model.</a></li>
  <li><a href="#a-glm-is-a-linear-model-on-the-link-scale" id="toc-a-glm-is-a-linear-model-on-the-link-scale" class="nav-link" data-scroll-target="#a-glm-is-a-linear-model-on-the-link-scale"><span class="header-section-number">17.5.3.4</span> A GLM is a linear model on the link scale</a></li>
  <li><a href="#coeffecients-of-a-generalized-linear-model-with-a-log-link-function-are-on-the-link-scale." id="toc-coeffecients-of-a-generalized-linear-model-with-a-log-link-function-are-on-the-link-scale." class="nav-link" data-scroll-target="#coeffecients-of-a-generalized-linear-model-with-a-log-link-function-are-on-the-link-scale."><span class="header-section-number">17.5.3.5</span> Coeffecients of a Generalized Linear Model with a log-link function are on the link scale.</a></li>
  <li><a href="#modeled-means-in-the-emmeans-table-of-a-generalized-linear-model-can-be-on-the-link-scale-or-response-scale-report-the-response-scale" id="toc-modeled-means-in-the-emmeans-table-of-a-generalized-linear-model-can-be-on-the-link-scale-or-response-scale-report-the-response-scale" class="nav-link" data-scroll-target="#modeled-means-in-the-emmeans-table-of-a-generalized-linear-model-can-be-on-the-link-scale-or-response-scale-report-the-response-scale"><span class="header-section-number">17.5.3.6</span> Modeled means in the emmeans table of a Generalized Linear Model can be on the link scale or response scale – Report the response scale</a></li>
  </ul></li>
  <li><a href="#some-consequences-of-fitting-a-linear-model-to-count-data" id="toc-some-consequences-of-fitting-a-linear-model-to-count-data" class="nav-link" data-scroll-target="#some-consequences-of-fitting-a-linear-model-to-count-data"><span class="header-section-number">17.5.4</span> Some consequences of fitting a linear model to count data</a>
  <ul class="collapse">
  <li><a href="#one-linear-models-can-make-absurd-predictions" id="toc-one-linear-models-can-make-absurd-predictions" class="nav-link" data-scroll-target="#one-linear-models-can-make-absurd-predictions"><span class="header-section-number">17.5.4.1</span> One – linear models can make absurd predictions</a></li>
  <li><a href="#two-linear-models-can-perform-surprisingly-well-if-one-is-only-interested-in-p-values" id="toc-two-linear-models-can-perform-surprisingly-well-if-one-is-only-interested-in-p-values" class="nav-link" data-scroll-target="#two-linear-models-can-perform-surprisingly-well-if-one-is-only-interested-in-p-values"><span class="header-section-number">17.5.4.2</span> Two – linear models can perform surprisingly well if one is only interested in <em>p</em>-values</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-glm-offset" id="toc-sec-glm-offset" class="nav-link" data-scroll-target="#sec-glm-offset"><span class="header-section-number">17.6</span> Example 2–GLM offset models (“dna damage” data fig3b)</a>
  <ul>
  <li><a href="#instead-of-a-t-test-or-mann-whitney-test-of-area-normalized-counts-counts-per-area-fit-a-glm-count-model-with-the-raw-count-as-the-response-and-the-sampling-effort-area-as-an-offset-to-gain-power" id="toc-instead-of-a-t-test-or-mann-whitney-test-of-area-normalized-counts-counts-per-area-fit-a-glm-count-model-with-the-raw-count-as-the-response-and-the-sampling-effort-area-as-an-offset-to-gain-power" class="nav-link" data-scroll-target="#instead-of-a-t-test-or-mann-whitney-test-of-area-normalized-counts-counts-per-area-fit-a-glm-count-model-with-the-raw-count-as-the-response-and-the-sampling-effort-area-as-an-offset-to-gain-power"><span class="header-section-number">17.6.1</span> Instead of a <em>t</em>-test or Mann-Whitney test of area-normalized counts (“counts per area”), fit a GLM count model with the raw count as the response and the sampling effort (area) as an offset to gain power</a></li>
  <li><a href="#fig3b-dna-damage-data" id="toc-fig3b-dna-damage-data" class="nav-link" data-scroll-target="#fig3b-dna-damage-data"><span class="header-section-number">17.6.2</span> fig3b (“dna damage”) data</a></li>
  <li><a href="#understand-the-data-1" id="toc-understand-the-data-1" class="nav-link" data-scroll-target="#understand-the-data-1"><span class="header-section-number">17.6.3</span> Understand the data</a></li>
  <li><a href="#model-fit-and-inference-1" id="toc-model-fit-and-inference-1" class="nav-link" data-scroll-target="#model-fit-and-inference-1"><span class="header-section-number">17.6.4</span> Model fit and inference</a>
  <ul class="collapse">
  <li><a href="#fit-the-models-1" id="toc-fit-the-models-1" class="nav-link" data-scroll-target="#fit-the-models-1"><span class="header-section-number">17.6.4.1</span> Fit the models</a></li>
  <li><a href="#check-the-models-1" id="toc-check-the-models-1" class="nav-link" data-scroll-target="#check-the-models-1"><span class="header-section-number">17.6.4.2</span> Check the models</a></li>
  <li><a href="#sec-glm-fig3b-m3-inference" id="toc-sec-glm-fig3b-m3-inference" class="nav-link" data-scroll-target="#sec-glm-fig3b-m3-inference"><span class="header-section-number">17.6.4.3</span> Inference from the model</a></li>
  <li><a href="#plot-the-model" id="toc-plot-the-model" class="nav-link" data-scroll-target="#plot-the-model"><span class="header-section-number">17.6.4.4</span> Plot the model</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#understanding-example-2" id="toc-understanding-example-2" class="nav-link" data-scroll-target="#understanding-example-2"><span class="header-section-number">17.7</span> Understanding Example 2</a>
  <ul>
  <li><a href="#an-offset-is-an-added-covariate-with-a-coefficient-fixed-at-1" id="toc-an-offset-is-an-added-covariate-with-a-coefficient-fixed-at-1" class="nav-link" data-scroll-target="#an-offset-is-an-added-covariate-with-a-coefficient-fixed-at-1"><span class="header-section-number">17.7.1</span> An offset is an added covariate with a coefficient fixed at 1</a></li>
  <li><a href="#sec-glm-rate" id="toc-sec-glm-rate" class="nav-link" data-scroll-target="#sec-glm-rate"><span class="header-section-number">17.7.2</span> A count GLM with an offset models the ratio of area-normalized means</a></li>
  <li><a href="#compare-an-offset-to-an-added-covariate-with-an-estimated-coefficient" id="toc-compare-an-offset-to-an-added-covariate-with-an-estimated-coefficient" class="nav-link" data-scroll-target="#compare-an-offset-to-an-added-covariate-with-an-estimated-coefficient"><span class="header-section-number">17.7.3</span> Compare an offset to an added covariate with an estimated coefficient</a></li>
  <li><a href="#issues-with-plotting" id="toc-issues-with-plotting" class="nav-link" data-scroll-target="#issues-with-plotting"><span class="header-section-number">17.7.4</span> Issues with plotting</a></li>
  </ul></li>
  <li><a href="#example-3glm-models-for-proportions-percent-of-a-total" id="toc-example-3glm-models-for-proportions-percent-of-a-total" class="nav-link" data-scroll-target="#example-3glm-models-for-proportions-percent-of-a-total"><span class="header-section-number">17.8</span> Example 3–GLM models for proportions (percent of a total)</a>
  <ul>
  <li><a href="#sec-glm-proportion" id="toc-sec-glm-proportion" class="nav-link" data-scroll-target="#sec-glm-proportion"><span class="header-section-number">17.8.1</span> Instead of a <em>t</em>-test or Mann-Whitney test of a proportion (e.g.&nbsp;percent of cells expressing a specific marker), fit a GLM Quasibinomial model to gain power (sox21 Fig. 5d)</a></li>
  <li><a href="#statistical-issues-with-proportions-for-a-linear-model" id="toc-statistical-issues-with-proportions-for-a-linear-model" class="nav-link" data-scroll-target="#statistical-issues-with-proportions-for-a-linear-model"><span class="header-section-number">17.8.2</span> Statistical issues with proportions for a linear model</a></li>
  <li><a href="#alternative-models-for-proportion-data" id="toc-alternative-models-for-proportion-data" class="nav-link" data-scroll-target="#alternative-models-for-proportion-data"><span class="header-section-number">17.8.3</span> Alternative models for proportion data</a>
  <ul class="collapse">
  <li><a href="#the-glm-binomial-model-is-the-standard-but-has-less-power-than-quasibinomial" id="toc-the-glm-binomial-model-is-the-standard-but-has-less-power-than-quasibinomial" class="nav-link" data-scroll-target="#the-glm-binomial-model-is-the-standard-but-has-less-power-than-quasibinomial"><span class="header-section-number">17.8.3.1</span> The GLM binomial model is the standard, but has less power than quasibinomial</a></li>
  <li><a href="#the-glm-quasibinomial-model-works-if-you-have-only-the-proportion-and-not-the-total-count" id="toc-the-glm-quasibinomial-model-works-if-you-have-only-the-proportion-and-not-the-total-count" class="nav-link" data-scroll-target="#the-glm-quasibinomial-model-works-if-you-have-only-the-proportion-and-not-the-total-count"><span class="header-section-number">17.8.3.2</span> The GLM quasibinomial model works if you have only the proportion and not the total count</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#example-4-glm-models-for-continuous-responses" id="toc-example-4-glm-models-for-continuous-responses" class="nav-link" data-scroll-target="#example-4-glm-models-for-continuous-responses"><span class="header-section-number">17.9</span> Example 4 – GLM models for continuous responses</a></li>
  <li><a href="#example-5-glm-models-for-binary-responses" id="toc-example-5-glm-models-for-binary-responses" class="nav-link" data-scroll-target="#example-5-glm-models-for-binary-responses"><span class="header-section-number">17.10</span> Example 5 – GLM models for binary responses</a></li>
  <li><a href="#working-in-r" id="toc-working-in-r" class="nav-link" data-scroll-target="#working-in-r"><span class="header-section-number">17.11</span> Working in R</a>
  <ul>
  <li><a href="#fitting-glms-to-count-data" id="toc-fitting-glms-to-count-data" class="nav-link" data-scroll-target="#fitting-glms-to-count-data"><span class="header-section-number">17.11.1</span> Fitting GLMs to count data</a></li>
  <li><a href="#fitting-a-glm-to-a-continuous-conditional-response-with-right-skew." id="toc-fitting-a-glm-to-a-continuous-conditional-response-with-right-skew." class="nav-link" data-scroll-target="#fitting-a-glm-to-a-continuous-conditional-response-with-right-skew."><span class="header-section-number">17.11.2</span> Fitting a GLM to a continuous conditional response with right skew.</a></li>
  <li><a href="#fitting-a-glm-to-a-binary-success-or-failure-presence-or-absence-survived-or-died-response" id="toc-fitting-a-glm-to-a-binary-success-or-failure-presence-or-absence-survived-or-died-response" class="nav-link" data-scroll-target="#fitting-a-glm-to-a-binary-success-or-failure-presence-or-absence-survived-or-died-response"><span class="header-section-number">17.11.3</span> Fitting a GLM to a binary (success or failure, presence or absence, survived or died) response</a></li>
  <li><a href="#fitting-generalized-linear-mixed-models" id="toc-fitting-generalized-linear-mixed-models" class="nav-link" data-scroll-target="#fitting-generalized-linear-mixed-models"><span class="header-section-number">17.11.4</span> Fitting Generalized Linear Mixed Models</a></li>
  </ul></li>
  <li><a href="#model-checking-glms" id="toc-model-checking-glms" class="nav-link" data-scroll-target="#model-checking-glms"><span class="header-section-number">17.12</span> Model checking GLMs</a>
  <ul>
  <li><a href="#use-dharmasimulateresiduals-to-check-glm-models-using-uniform-residuals" id="toc-use-dharmasimulateresiduals-to-check-glm-models-using-uniform-residuals" class="nav-link" data-scroll-target="#use-dharmasimulateresiduals-to-check-glm-models-using-uniform-residuals"><span class="header-section-number">17.12.1</span> Use DHARMa::simulateResiduals to check GLM models using uniform residuals</a></li>
  <li><a href="#use-ggcheck_the_glm-to-check-the-quasipoisson-model" id="toc-use-ggcheck_the_glm-to-check-the-quasipoisson-model" class="nav-link" data-scroll-target="#use-ggcheck_the_glm-to-check-the-quasipoisson-model"><span class="header-section-number">17.12.2</span> Use ggcheck_the_glm to check the quasipoisson model</a></li>
  </ul></li>
  <li><a href="#hidden-code" id="toc-hidden-code" class="nav-link" data-scroll-target="#hidden-code"><span class="header-section-number">17.13</span> Hidden code</a>
  <ul>
  <li><a href="#import-example-1-data-fig3a-angiogenic-sprouts" id="toc-import-example-1-data-fig3a-angiogenic-sprouts" class="nav-link" data-scroll-target="#import-example-1-data-fig3a-angiogenic-sprouts"><span class="header-section-number">17.13.1</span> Import Example 1 data (fig3a – “angiogenic sprouts”)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-glm" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="tldr" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="tldr"><span class="header-section-number">17.1</span> TL;DR</h2>
<p>Generalized Linear Models are the modern alternative to non-parametric tests (Mann-Whitney, Kruskal-Wallis, Dunn, etc.)</p>
</section>
<section id="glm-counts" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="glm-counts"><span class="header-section-number">17.2</span> Introducing Generalized Linear Models using count data examples</h2>
<p>Biologists frequently count stuff, and design experiments to estimate the effects of different factors on these counts. Count data can cause numerous problems with linear models that assume a normal, conditional distribution, including</p>
<ol type="1">
<li>counts are discrete, and can be zero or positive integers only</li>
<li>counts tend to bunch up on the lower side of the range and spread thinly on the higher side of the range, creating a distribution with a positive skew</li>
<li>the variance of counts increases with the mean (see <a href="#fig-glm-fig3a-histogram" class="quarto-xref">Figure&nbsp;<span>17.1</span></a> for some of these properties).</li>
</ol>
<p>Some count data can be approximated by and reasonably modeled with a normal distribution. More often, count data are better approximated with a <a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/07-0043.1" target="_blank">Quasipoisson distribution</a> or <a href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" target="_blank">Negative Binomial distribution</a> and modeled with a <a href="https://en.wikipedia.org/wiki/Generalized_linear_model%20(GLM)" target="_blank">generalized linear model</a>. Quasipoisson and Negative Binomial distributions are <strong>discrete probability distributions</strong> with two important properties: 1) the distribution contains only non-negative integers and 2) the variance is a function of the mean.</p>
<p>For a researcher using <em>p</em>-values to guide the direction of bench biology experiments, we want a method with good Type I error control and high power and a linear model of raw counts has both (which is why I’ve stated multiple times that the Normal assumption is the least important of the assumptions of the linear model and classical equivalents).</p>
<p>That said, I do recommend a quasipoisson or quasipoisson-like negative binomial model with count data because</p>
<ol type="1">
<li>Confidence intervals are asymmetric, reflecting the distribution of the sample.</li>
<li>The effect is the response of one group relative to the response of another, so we’d report this as “the KO tumor count is 2.1X the WT count”. This is much more natural than a difference (which we get with a linear model) and is nicely scale independent (20 tumors is 2X 10 tumors and 2M CD4+ cells is 2X 1M CD4+ cells).</li>
</ol>
<p>What I don’t recommend</p>
<ol type="1">
<li>Non-parametric tests such as the Mann-Whitney (Wilcoxon) test. The Mann-Whitney has non-trivially less power than a linear model or a quasipoisson GLM. Non-parametric tests were common in the pre-computer era but are much less relevant now.</li>
<li>Linear models of log-transformed counts. I am more ambivalent about these. For small samples (n ~ 6), this has non-trivially less power than a linear model or a quasipoisson GLM. Also, datasets with zeros require log(y + 1) transformation and the addition of 1 to each data point changes the result a little.</li>
<li>A negative binomial GLM for small samples (&lt; ~20). Almost all sources of guidance recommend a a negative binomial (NB) GLM for count data, but a NB GLM has non-trivially inflated type I error with the small sample sizes (n ~ 6) typical of experimental bench biology (but much better control at n &gt; 20).</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="GLMM blues">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
GLMM blues
</div>
</div>
<div class="callout-body-container callout-body">
<p>Generalized linear mixed models (GLMMs) have frequent convergence issues. If this happens, use a linear mixed model of the untransformed data instead of a GLM of a reduced model as the pseudoreplication of a reduced model is (generally) a massively larger problem than that from data that aren’t approximately normal.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm-fig3a-histogram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-histogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-histogram-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-histogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.1: The data for Example 1 shows characteristics of count data including right skew and a variance that is proportional to the mean. The median of each group is shown with the black dot in A.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="the-generalized-linear-model-glm" class="level3" data-number="17.2.1">
<h3 data-number="17.2.1" class="anchored" data-anchor-id="the-generalized-linear-model-glm"><span class="header-section-number">17.2.1</span> The Generalized Linear Model (GLM)</h3>
<p>As outlined in <a href="intro-stat-modeling.html#lm-specifications">Two specifications of a linear model</a>, a common way that biological researchers are taught to think about a response variable is</p>
<p><span class="math display">\[
response = expectation + error
\]</span></p>
<p>or, using the notation of this text,</p>
<p><span id="eq-glm-error-spec"><span class="math display">\[
\begin{align}
y &amp;= \beta_0 + \beta_1 \texttt{treatment} + \varepsilon \\
\varepsilon &amp;\sim \operatorname{Normal}(0, \sigma^2)
\end{align}
\tag{17.1}\]</span></span></p>
<p>That is, we can think of a response as the sum of some systematic part (<span class="math inline">\(\beta_0 + \beta_1 \texttt{treatment}\)</span>) and a stochastic (“random error”) part (<span class="math inline">\(\varepsilon\)</span>), where the stochastic part is a random draw from a normal distribution with mean zero and variance <span class="math inline">\(\sigma^2\)</span>. This way of thinking about the generation of the response is useful for linear models, and model checking linear models, but is much less useful for thinking about generalized linear models or model checking generalized liner models. For example, if we want to model the number of angiogenic sprouts in response to some combination of <span class="math inline">\(\texttt{genotype}\)</span> and <span class="math inline">\(\texttt{treatment}\)</span> using a Quasipoisson distribution, the following is the <strong>wrong</strong> way to think about the statistical model</p>
<p><span id="eq-glm-spec1-qpoisson-misconception"><span class="math display">\[
\begin{align}
\texttt{sprouts} &amp;= \beta_0  + \\
&amp;\quad \ \beta_1 \texttt{treatment}_{\texttt{GAS6}} \ + \\
&amp;\quad \ \beta_2 \texttt{genotype}_{\texttt{FAK\_ko}} + \\
&amp;\quad \ \beta_3 \texttt{treatment}_{\texttt{GAS6}}:\texttt{genotype}_{\texttt{FAK\_ko}} + \\
&amp;\quad \ \varepsilon_i \\
\varepsilon &amp;\sim \ \operatorname{Quasipoisson}(\mu, \theta)
\end{align}
\tag{17.2}\]</span></span></p>
<p>That is, we should not think of a count as the sum of a systematic part and a random draw from a Poisson distribution. Why? Because it is the counts, conditional on the <span class="math inline">\(\texttt{treatment:genotype}\)</span> combination that are quasipoisson distributed, not the residuals from the fit model. A residual is a difference from a mean, so, some residuals from a fit model <strong>have to be negative</strong>. A negative residual cannot be a sample from a quasipoisson or Negative Binomial distribution because these can only generate non-negative integers.</p>
<p>A better way to think about the data generation for a linear model that naturally leads to the <em>correct</em> way to think about data generation for a generalized linear model, is</p>
<p><span id="eq-glm-draw-spec"><span class="math display">\[
\begin{align}
y &amp;\sim N(\mu_{treatment}, \sigma^2) \\
\mathrm{E}(y| \texttt{treatment}) &amp;= \mu_{treatment} \\
\mu_{treatment} &amp;= \beta_0 + \beta_1 \texttt{treatment}
\end{align}
\tag{17.3}\]</span></span></p>
<p>That is, a response is a random draw from a normal distribution with mean <span class="math inline">\(mu\)</span> (not zero!) and variance <span class="math inline">\(\sigma^2\)</span>. Line 1 is the stochastic part of this specification. Line 3 is the systematic part. Line 2 simply states that the expectation, conditional on the treatment, is the treatment mean.</p>
<p>The specification of a generalized linear model has both stochastic and systematic parts but adds a third part, which is a <strong>link function</strong> connecting the stochastic and systematic parts.</p>
<ol type="1">
<li><strong>The stochastic part</strong>, which is a probability distribution from the exponential family (this is sometimes called the “random part”)</li>
</ol>
<p><span class="math display">\[
\begin{equation}
y \sim \operatorname{Prob}(\mu_{treatment})
\end{equation}
\]</span></p>
<ol start="2" type="1">
<li><strong>the systematic part</strong>, which is a linear predictor (I like to think about this as the deterministic part)</li>
</ol>
<p><span class="math display">\[
\begin{equation}
\eta = \beta_0 + \beta_1 \texttt{treatment}
\end{equation}
\]</span></p>
<ol start="3" type="1">
<li>a <strong>link function</strong> connecting the two parts</li>
</ol>
<p><span class="math display">\[
\begin{equation}
\eta_{treatment} = g(\mu_{treatment})
\end{equation}
\]</span></p>
<p><span class="math inline">\(\mu_{treatment}\)</span> (the Greek symbol mu) is the true, conditional (treatment) mean (or expectation <span class="math inline">\(\mathrm{E}(Y|X)\)</span>) of the response on the <strong>response scale</strong> and <span class="math inline">\(\eta_{treatment}\)</span> (the Greek symbol eta) is the true, conditional (treatment) mean of the response on the <strong>link scale</strong>. The response scale is the scale of the raw measurements and has units of the raw measurements. The link scale is the scale of the transformed mean. A GLM models the response with a distribution specified in the stochastic part. The probability distributions introduced in this chapter are the Poisson and Negative Binomial. The natural link function, and default link function in R, for the Poisson and Negative Binomial is the “log link”, <span class="math inline">\(\eta = log(\mu)\)</span>. More generally, while each distribution has a natural (or, “canonical”) link function, one can use alternatives. Given this definition of a generalized linear model, a linear model is a GLM with a normal distribution and an <strong>Identity</strong> link (<span class="math inline">\(\eta = \mu\)</span>).</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \operatorname{Normal}(\mu_{treatment}, \sigma^2)\\
\mathrm{E}(y | \texttt{treatment}) &amp;= \mu_{treatment}\\
\eta &amp;= \beta_0 + \beta_1 \texttt{treatment}\\
\mu_{treatment} &amp;= \eta_{treatment}
\end{align}
\]</span></p>
<p>Think about the link function and GLM more generally like this: the GLM constructs a linear model that predicts the conditional means <em>on the link scale</em>. If the model uses a “log link” then the conditional mean on the link scale is the <em>log of the conditional mean on the response scale</em>. The modeled mean on the response scale is the inverse link function, or</p>
<p><span class="math display">\[
\begin{equation}
\mu_{treatment} = g^{-1}(\eta_{treatment})
\end{equation}
\]</span></p>
<p>For a log link, a true, treatment mean is <span class="math inline">\(\mu_{treatment} = \mathrm{exp}(\eta_{treatment})\)</span>) (<span class="math inline">\(\mathrm{exp}\)</span> is the exponential function which is the inverse of the natural log ln(x)).</p>
<p>Importantly, <strong>in a GLM, the individual data values are not transformed</strong>. A GLM with a log link is not the same as a linear model on log transformed data.</p>
<p>When modeling counts using the Quasipoisson or Negative Binomial distributions with a log link, the link scale is linear, and so the effects are additive on the link scale, while the response scale is nonlinear (it is the exponent of the link scale), and so the <em>effects are multiplicative on the response scale</em>. If this doesn’t make sense now, an example is worked out below. The inverse of the link function backtransforms the parameters from the link scale back to the response scale. So, for example, a prediction on the response sale is <span class="math inline">\(\mathrm{exp}(\hat{\eta})\)</span> and a coefficient on the response scale is <span class="math inline">\(\mathrm{exp}(b_j)\)</span>.</p>
</section>
</section>
<section id="kinds-of-data-that-are-modeled-by-a-glm" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="kinds-of-data-that-are-modeled-by-a-glm"><span class="header-section-number">17.3</span> Kinds of data that are modeled by a GLM</h2>
<ol type="1">
<li>If a response is a count then use a Quasipoisson or Negative Binomial family with a log link.</li>
<li>If a response is binary response, for example, presence/absence or success/failure or survive/die, then use the Binomial family with a logistic link (other link functions are also useful). This is classically known as <strong>logistic regression</strong>.</li>
<li>If a response is a fraction that is a ratio of counts, for example the fraction of total cells that express some marker, then use a Quasi-binomial family with a logistic link. Think of each numerator count as a “success”.</li>
<li>If a response is a fraction of counts per “effort” (cells per area or volume or time), then use a Quasi-Poisson or Negative Binomial family with a log link on the raw count and include the log of the measure of effort as an offset.</li>
<li>If a response is continuous but the variance increases with mean then use the Gamma family</li>
<li>If a response is a fraction of a continuous measure per “effort” (tumor area per total area or volume or time), then use a Gamma family on the raw measure and include the log of the measure of effort as an offset.</li>
</ol>
</section>
<section id="which-model-and-why" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="which-model-and-why"><span class="header-section-number">17.4</span> Which model and why</h2>
<section id="count-data" class="level3" data-number="17.4.1">
<h3 data-number="17.4.1" class="anchored" data-anchor-id="count-data"><span class="header-section-number">17.4.1</span> Count data</h3>
<section id="alternative-models" class="level4" data-number="17.4.1.1">
<h4 data-number="17.4.1.1" class="anchored" data-anchor-id="alternative-models"><span class="header-section-number">17.4.1.1</span> Alternative models</h4>
<p>We might model count data using any of several GLMs for non-negative integer responses, including</p>
<ol type="1">
<li>Poisson model with log link.</li>
<li>Quasipoisson model with log link.</li>
<li>Negative binomial model with log link.</li>
<li>A quasipoisson-like Negative binomial model with log link.</li>
</ol>
<p>Or, we could model count data using a</p>
<ol start="5" type="1">
<li>linear model</li>
<li>linear model on the log transformed response. The log transformation tends to “normalize” a right skewed distribution and “homogenize” variances. If there are zero counts, then a typical strategy is to add one to all responses. This can lead to issues.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>fig3a_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype, <span class="at">data =</span> fig3a)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fig3a_loglm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sprouts <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">~</span> treatment <span class="sc">*</span> genotype, <span class="at">data =</span> fig3a)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>fig3a_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>fig3a_qp <span class="ot">&lt;-</span> <span class="fu">glm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">quasipoisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>fig3a_nb1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">nbinom1</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>fig3a_nb2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">nbinom2</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Inference for the first simple effect of the angiogenic sprout data (fig3a) for the two lm and four glm models fit to the data. Statistics are computed using the emmeans and contrast functions from the emmeans package.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lower CL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper CL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">t/Z</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="1">
<td colspan="10" style="border-bottom: 1px solid"><strong>lm</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FAK_wt</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">GAS6 - PBS</td>
<td style="text-align: right;">6.58</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">11.63</td>
<td style="text-align: right;">2.60</td>
<td style="text-align: right;">0.01154</td>
</tr>
<tr class="odd" data-grouplength="1">
<td colspan="10" style="border-bottom: 1px solid"><strong>loglm</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FAK_wt</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">GAS6 - PBS</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">4.04</td>
<td style="text-align: right;">0.00014</td>
</tr>
<tr class="odd" data-grouplength="1">
<td colspan="10" style="border-bottom: 1px solid"><strong>pois</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FAK_wt</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">GAS6 / PBS</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">5.12</td>
<td style="text-align: right;">7.61</td>
<td style="text-align: right;">0.00000</td>
</tr>
<tr class="odd" data-grouplength="1">
<td colspan="10" style="border-bottom: 1px solid"><strong>qp</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FAK_wt</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">GAS6 / PBS</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">8.11</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">0.00138</td>
</tr>
<tr class="odd" data-grouplength="1">
<td colspan="10" style="border-bottom: 1px solid"><strong>nb1</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FAK_wt</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">GAS6 / PBS</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.55</td>
<td style="text-align: right;">5.21</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">0.00077</td>
</tr>
<tr class="odd" data-grouplength="1">
<td colspan="10" style="border-bottom: 1px solid"><strong>nb2</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FAK_wt</td>
<td style="text-align: left;">.</td>
<td style="text-align: left;">GAS6 / PBS</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">6.43</td>
<td style="text-align: right;">4.53</td>
<td style="text-align: right;">0.00001</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Notes</p>
<ol type="1">
<li>Only the first simple effect of the four is shown</li>
<li>The values in the column “Estimate” are estimates of different ways of computing the effect. For the lm, the estimate is the difference in estimated means. For the loglm, the estimate is the difference in the geometric means. For the generalized linear models, the estimate is the ratio of the means, but the estimate of the means for the nb1 model differs from that of the pois, qp, and nb2 models (which are all the same).</li>
<li>While the estimates are the same for the pois, qp, and nb2 models, the variances (SE) of the estimates differ, so the test statistic (<em>t</em> and <em>Z</em>) and <em>p</em>-values differ.</li>
<li>The tests (“Wald test”) for the GLM use a <em>Z</em> statistic, which assumes infinite sample size. In practice this means, the CI and <em>p</em>-value will be more reliable with larger sample size. n &gt; 30 is pretty good.</li>
<li>No model, and no <em>p</em>-value is either incorrect or correct. Some models fit the data better than other models. By fit, I mean how well the data look like a sample from a normal, poisson, or negative binomial distribution, each with specific mean-variance relationships.</li>
<li>If reliable <em>p</em>-values and high power is our goal, then, how well a model fits the data is not a primary concern. Instead, we want to choose the method with good Type 1 error performance and high power relative to alternative methods.</li>
</ol>
</section>
<section id="the-likelihood-ratio-test-lrt-is-alternative-to-the-wald-test-for-glms." class="level4" data-number="17.4.1.2">
<h4 data-number="17.4.1.2" class="anchored" data-anchor-id="the-likelihood-ratio-test-lrt-is-alternative-to-the-wald-test-for-glms."><span class="header-section-number">17.4.1.2</span> The Likelihood Ratio Test (LRT) is alternative to the Wald test for GLMs.</h4>
<p>This is done pairwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple effect of genotype in GAS6 treatment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fig3a_nb2_full <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(sprouts <span class="sc">~</span> genotype,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">family =</span> <span class="fu">nbinom2</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> fig3a[treatment <span class="sc">==</span> <span class="st">"GAS6"</span>])</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># refit genotype factor</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>fig3a_nb2_reduced <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(sprouts <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">family =</span> <span class="fu">nbinom2</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> fig3a[treatment <span class="sc">==</span> <span class="st">"GAS6"</span>])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>fig3a_nb2_lrt_1 <span class="ot">&lt;-</span> <span class="fu">anova</span>(fig3a_nb2_full, fig3a_nb2_reduced, <span class="at">test=</span><span class="st">"Chisq"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>fig3a_nb2_lrt_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: fig3a[treatment == "GAS6"]
Models:
fig3a_nb2_reduced: sprouts ~ 1, zi=~0, disp=~1
fig3a_nb2_full: sprouts ~ genotype, zi=~0, disp=~1
                  Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)  
fig3a_nb2_reduced  2 309.27 312.84 -152.64   305.27                           
fig3a_nb2_full     3 306.51 311.87 -150.26   300.51 4.7599      1    0.02913 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="simulation-shows-that-a-quasipoisson-model-qp-has-the-best-performance-over-the-parameter-space" class="level4" data-number="17.4.1.3">
<h4 data-number="17.4.1.3" class="anchored" data-anchor-id="simulation-shows-that-a-quasipoisson-model-qp-has-the-best-performance-over-the-parameter-space"><span class="header-section-number">17.4.1.3</span> Simulation shows that a quasipoisson model (qp) has the best performance over the parameter space</h4>
<p>Notes</p>
<ol type="1">
<li>xxx</li>
</ol>
</section>
</section>
</section>
<section id="sec-glm-count" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="sec-glm-count"><span class="header-section-number">17.5</span> Example 1 – GLM models for count responses (“angiogenic sprouts” fig3a)</h2>
<section id="understand-the-data" class="level3" data-number="17.5.1">
<h3 data-number="17.5.1" class="anchored" data-anchor-id="understand-the-data"><span class="header-section-number">17.5.1</span> Understand the data</h3>
<p>Article source <a href="https://www.nature.com/articles/s41467-020-16618-6" target="_blank">Lechertier, Tanguy, et al.&nbsp;“Pericyte FAK negatively regulates Gas6/Axl signalling to suppress tumour angiogenesis and tumour growth.” Nature communications 11.1 (2020): 1-14.</a></p>
<p><a href="https://www.nature.com/articles/s41467-020-16618-6#Sec34" target="_blank">data source</a></p>
<p>The researchers designed a set of experiments to investigate the effects of pericyte derived FAK (focal adhesion kinase, a <a href="https://en.wikipedia.org/wiki/Tyrosine_kinase" target="_blank">protein tyrosine kinase</a>) on the Gas6/Axl pathway regulating angiogenesis promoting tumor growth. Pericytes are cells immediately deep to the endothelium (the epithelial lining) of the smallest blood vessels, including capillaries, arterioles, and venules. Angiogenesis is the growth of new blood vessels. GAS6 (growth arrest specific 6) is a protein commonly expressed in tumors.</p>
<p>The example data is from the experiment for Figure 3a. The design is <span class="math inline">\(2 \times 2\)</span> – two factors (<span class="math inline">\(\texttt{treatment}\)</span> and <span class="math inline">\(\texttt{genotype}\)</span>) each with two levels.</p>
<ol type="1">
<li>Factor 1: <span class="math inline">\(\texttt{treatment}\)</span></li>
</ol>
<ul>
<li>reference level: “PBS”. Phosphate buffered saline added to tissue. This is the control treatment.</li>
<li>treatment level: “GAS6”. Added to tissue in solution. The experiment is designed to test its effect on promoting angiogenesis in the development of tumors.</li>
</ul>
<ol start="2" type="1">
<li>Factor 2: <span class="math inline">\(\texttt{genotype}\)</span></li>
</ol>
<ul>
<li>reference level: “FAK_wt”. The functional genotype.</li>
<li>treatment level: “FAK_ko”. Tissue-specific FAK deletion in pericytes. The experiment is designed to test the effect of pericyte-derived FAK on slowing angiogenesis in the development of tumors. If true, then its deletion should result in increased tumor development.</li>
</ul>
<p>The four treatment by genotype combinations are</p>
<ol type="1">
<li>Control (“PBS FAK_wt”) – negative control</li>
<li>FAK_ko (“PBS FAK_ko”) – PBS control. Unknown response given deletion of putative angiogenesis inhibitor but no added putative angiogenesis promotor</li>
<li>GAS6 (“GAS6 FAK_wt”) – GAS6 control. GAS6 expected to promote angiogenesis but this the response is expected to be inhibited by some amount by FAK</li>
<li>GAS6+FAK_ko (“GAS6 FAK_ko”) – focal treatment. Expected positive angiogenesis</li>
</ol>
<p>The planned contrasts are</p>
<ol type="1">
<li>(PBS FAK_ko) - (PBS FAK_wt) – the effect of FAK deletion given the control treatment</li>
<li>(GAS6 FAK_ko) - (GAS6 FAK_wt) – the effect of FAK deletion given the GAS6 treatment</li>
<li>((PBS FAK_ko) - (PBS FAK_wt)) - ((GAS6 FAK_ko) - (GAS6 FAK_wt)). The interaction effect giving the effect of the combined treatment relative to the individual effects.</li>
</ol>
</section>
<section id="model-fit-and-inference" class="level3" data-number="17.5.2">
<h3 data-number="17.5.2" class="anchored" data-anchor-id="model-fit-and-inference"><span class="header-section-number">17.5.2</span> Model fit and inference</h3>
<section id="fit-the-models" class="level4" data-number="17.5.2.1">
<h4 data-number="17.5.2.1" class="anchored" data-anchor-id="fit-the-models"><span class="header-section-number">17.5.2.1</span> Fit the models</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fig3a_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype, <span class="at">data =</span> fig3a)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>fig3a_qp <span class="ot">&lt;-</span> <span class="fu">glm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">quasipoisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes on the models</p>
<ol type="1">
<li>The Quasipoisson and Negative Binomial distributions tend to fit biological data well and are similar to each other. I find that QP improves test performance in simulations, so prefer it for statistical inference.</li>
</ol>
</section>
<section id="check-the-models" class="level4" data-number="17.5.2.2">
<h4 data-number="17.5.2.2" class="anchored" data-anchor-id="check-the-models"><span class="header-section-number">17.5.2.2</span> Check the models</h4>
<section id="check-the-linear-model" class="level5" data-number="17.5.2.2.1">
<h5 data-number="17.5.2.2.1" class="anchored" data-anchor-id="check-the-linear-model"><span class="header-section-number">17.5.2.2.1</span> Check the linear model</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcheck_the_model</span>(fig3a_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3a_lm-check-lm-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>left panel shows classic right skew conditional distribution with less negative quantiles than expected with a normal distribution on the left hand side and more positive quantiles than expected on the right hand side.</li>
<li>right panel shows heterogeneity and specifically the variance increasing with the mean.</li>
</ol>
</section>
<section id="check-the-quasipoisson-model-sec-glm-fig3a-check" class="level5" data-number="17.5.2.2.2">
<h5 data-number="17.5.2.2.2" class="anchored" data-anchor-id="check-the-quasipoisson-model-sec-glm-fig3a-check"><span class="header-section-number">17.5.2.2.2</span> Check the Quasipoisson model {sec-glm-fig3a-check}</h5>
<p><strong>Check shape and homogeneity</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a wrapper to the DHARMa package with an addition for quasipoisson</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fig3a_qp_check <span class="ot">&lt;-</span> <span class="fu">ggcheck_the_glm</span>(fig3a_qp)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fig3a_qp_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3a-qp-check-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>uniform q-q for Quasipoisson GLM looks good.</li>
<li>spread-location plot looks good.</li>
</ol>
<p><strong>Check dispersion</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html#recognizing-overunderdispersion</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(fig3a_qp_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3a-qp-check-dispersion-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 1.2159, p-value = 0.472
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>good</li>
</ol>
<p><strong>Check zero inflation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(fig3a_qp_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3a-qp-check-zeros-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 0.82372, p-value = 0.512
alternative hypothesis: two.sided</code></pre>
</div>
</div>
</section>
</section>
<section id="glm-fig3a-qp-inference" class="level4" data-number="17.5.2.3">
<h4 data-number="17.5.2.3" class="anchored" data-anchor-id="glm-fig3a-qp-inference"><span class="header-section-number">17.5.2.3</span> Inference from the model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp_coef <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(fig3a_qp)),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">confint</span>(fig3a_qp))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>fig3a_qp_coef <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 32%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 21%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.367</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">1.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatmentGAS6</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">0.406</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">genotypeFAK_ko</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.563</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.937</td>
<td style="text-align: right;">-1.12</td>
<td style="text-align: right;">1.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatmentGAS6:genotypeFAK_ko</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.603</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">0.444</td>
<td style="text-align: right;">-0.71</td>
<td style="text-align: right;">1.70</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fig3a_qp,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"genotype"</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PBS</td>
<td style="text-align: left;">FAK_wt</td>
<td style="text-align: right;">2.47</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">5.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6</td>
<td style="text-align: left;">FAK_wt</td>
<td style="text-align: right;">9.05</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">6.45</td>
<td style="text-align: right;">12.69</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PBS</td>
<td style="text-align: left;">FAK_ko</td>
<td style="text-align: right;">2.58</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">5.97</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6</td>
<td style="text-align: left;">FAK_ko</td>
<td style="text-align: right;">15.04</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">11.71</td>
<td style="text-align: right;">19.33</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fig3a_qp_emm # print in console to get row numbers</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set the mean as the row number from the emmeans table</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>pbs_fak_wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>gas6_fak_wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>pbs_fak_ko <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>gas6_fak_ko <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#1. (PBS FAK_ko) - (PBS FAK_wt)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#2. (GAS6 FAK_ko) - (GAS6 FAK_wt) </span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#3. ((PBS FAK_ko) - (PBS FAK_wt)) - (GAS6 FAK_ko) - (GAS6 FAK_wt). </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>fig3a_qp_planned <span class="ot">&lt;-</span> <span class="fu">contrast</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  fig3a_qp_emm,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">list</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(PBS FAK_ko) - (PBS FAK_wt)"</span> <span class="ot">=</span> <span class="fu">c</span>(pbs_fak_ko <span class="sc">-</span> pbs_fak_wt),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(GAS6 FAK_ko) - (GAS6 FAK_wt)"</span> <span class="ot">=</span> <span class="fu">c</span>(gas6_fak_ko <span class="sc">-</span> gas6_fak_wt),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Interaction"</span> <span class="ot">=</span> <span class="fu">c</span>(gas6_fak_ko <span class="sc">-</span> gas6_fak_wt) <span class="sc">-</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(pbs_fak_ko <span class="sc">-</span> pbs_fak_wt)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="st">"none"</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">null</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z.ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(PBS FAK_ko) / (PBS FAK_wt)</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">0.589</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.07920</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">(GAS6 FAK_ko) / (GAS6 FAK_wt)</td>
<td style="text-align: right;">1.66</td>
<td style="text-align: right;">0.357</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.36644</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Interaction</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">0.959</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">5.18</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.76919</td>
<td style="text-align: right;">0.4</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The df are infinite and the confidence limits are “asymptotic”. In the strict sense, this means that inference assumes that the sample size is infinite. But less strictly, inference assumes a large sample. The smaller the sample, the more optimistic (liberal) the inference. In general, experimental bench biology datasets are small and so asymptotic CIs and p-values will be liberal (increasing false discovery).</li>
</ol>
</section>
<section id="lmm-exp5c-plotthemodel" class="level4" data-number="17.5.2.4">
<h4 data-number="17.5.2.4" class="anchored" data-anchor-id="lmm-exp5c-plotthemodel"><span class="header-section-number">17.5.2.4</span> Plot the model</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm-fig3a-ptm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-ptm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-ptm-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-ptm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.2: FAK KO increases number of angiogenic sprouts compared to FAK WT when given GAS6 (p = 0.028), although it’s unclear what the effect is when given PBS (p = 0.9), or if the effect under GAS6 is larger than expected given an additive effect (interaction p = 0.275)
</figcaption>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The CIs of the means and of the effects are asymmetric – the bar on the higher side is longer. This asymmetry reflects the skewed right distribution.</li>
<li>The effect is a ratio (the non-reference response as a multiple of the reference response) and not a difference. This effect is the number of times larger (if greater than 1) or fraction smaller (if less than one).</li>
</ol>
</section>
<section id="alternaplot-the-model" class="level4" data-number="17.5.2.5">
<h4 data-number="17.5.2.5" class="anchored" data-anchor-id="alternaplot-the-model"><span class="header-section-number">17.5.2.5</span> Alternaplot the model</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm-fig3a-ptr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-ptr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-ptr-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-ptr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.3: FAK KO increases number of angiogenic sprouts compared to FAK WT when given GAS6 (p = 0.028), although it’s unclear what the effect is when given PBS (p = 0.9), or if the effect under GAS6 is larger than expected given an additive effect (interaction p = 0.275)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="understanding-example-1" class="level3" data-number="17.5.3">
<h3 data-number="17.5.3" class="anchored" data-anchor-id="understanding-example-1"><span class="header-section-number">17.5.3</span> Understanding Example 1</h3>
<section id="modeling-strategy" class="level4" data-number="17.5.3.1">
<h4 data-number="17.5.3.1" class="anchored" data-anchor-id="modeling-strategy"><span class="header-section-number">17.5.3.1</span> Modeling strategy</h4>
<p>Instead of testing assumptions of a model using formal hypothesis tests <em>before</em> fitting the model, a better strategy is to 1) fit one or more models based on initial evaluation of the data, and then do 2) <strong>model checking</strong> using <strong>diagnostic plots</strong>, diagnostic statistics, and simulation (see Section <a href="model-checking.html#check-check">All statistical analyses should be followed by model checking</a>).</p>
<p>For the fig3a data, I fit a linear model, a Poisson GLM, and a Negative Binomial GLM. I use the diagnostic plots and statistics to help me decide which model to report.</p>
</section>
<section id="model-checking-fits-to-count-data" class="level4" data-number="17.5.3.2">
<h4 data-number="17.5.3.2" class="anchored" data-anchor-id="model-checking-fits-to-count-data"><span class="header-section-number">17.5.3.2</span> Model checking fits to count data</h4>
<p>We use the fit models to check</p>
<ol type="1">
<li>the compatibility between the quantiles of the observed residuals and the distribution of expected quantiles from the family in the model fit</li>
<li>if the observed distribution is over or under dispersed</li>
<li>if there are more zeros than expected by the theoretical distribution. If so, the observed distribution is <strong>zero-inflated</strong></li>
</ol>
<section id="glm-fig3a-normal-qq" class="level5" data-number="17.5.3.2.1">
<h5 data-number="17.5.3.2.1" class="anchored" data-anchor-id="glm-fig3a-normal-qq"><span class="header-section-number">17.5.3.2.1</span> Checking the linear model fig3a_lm – a Normal-QQ plot</h5>
<p><a href="#fig-glm-fig3a-qq" class="quarto-xref">Figure&nbsp;<span>17.4</span></a> A shows a histogram of the residuals from the fit linear model. The plot shows that the residuals seem to be clumped at the negative end of the range, which suggests that a model with a normally distributed conditional outcome (or normal error) is not well approximated.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm-fig3a-qq" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-qq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-qq-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-qq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.4: Diagnostic plots of angiogenic sprout data (fig3a). A) Distribution of the residuals of the fit linear model. B) Normal-QQ plot of the residuals of the fit linear model.
</figcaption>
</figure>
</div>
</div>
</div>
<p>A better way to investigate this is with the <strong>Normal-QQ</strong> plot in <a href="#fig-glm-fig3a-qq" class="quarto-xref">Figure&nbsp;<span>17.4</span></a> B, which plots the sample quantiles for a variable against their theoretical quantiles. If the conditional outcome approximates a sample from normal distribution,</p>
<ol type="1">
<li>the points should roughly follow the robust regression line,</li>
<li>the points should be largely inside the 95% CI (gray) bounds for sampling a normal distribution with the variance estimated by the model, and</li>
<li>the robust regression line should be largely inside the CI bounds.</li>
</ol>
<p>For the sprout data, the points are above the line at the positive end, hug the upper bound of the 95% CI at the negative end, are well above the 95% CI at the positive end, and the robust regression is distinctly shallower than a line bisecting the CI bounds. At the left (negative) end, the observed values are more positive than the theoretical values. Remembering that this plot is of residuals, if we think about this as counts, this means that our smallest counts are not as small as we would expect given the mean, the variance, and a normal distribution. This shouldn’t be surprising – the counts range down to zero and counts cannot be below zero. At the positive end, the sample values are again more positive than the theoretical values. Thinking about this as counts, this means that largest counts are larger than expected given the mean, the variance, and a normal distribution. This pattern is what we’d expect of count data.</p>
</section>
<section id="glm-fig3a_lm-spreadlevel" class="level5" data-number="17.5.3.2.2">
<h5 data-number="17.5.3.2.2" class="anchored" data-anchor-id="glm-fig3a_lm-spreadlevel"><span class="header-section-number">17.5.3.2.2</span> Checking the linear model fig3a_lm – Spread-level plot for checking homoskedasticity</h5>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm-fig3a-sl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-sl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-sl-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-sl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.5: Diagnostic plots of angiogenic sprout data (fig3a). A) Distribution of the residuals of the fit linear model. B) Normal-QQ plot of the residuals of the fit linear model.
</figcaption>
</figure>
</div>
</div>
</div>
<p>A linear model also assumes that the error is <strong>homoskedastic</strong> – the error variance is not a function of the value of the <span class="math inline">\(X\)</span> variables). Non-homoskedastic error is <strong>heteroskedastic</strong>. I will typically use “homogenous variance” and “heterogenous variance” since these terms are more familiar to biologists. The fit model can be checked for homogeneity using a spread-level (also known as a scale-location) plot, which comes in several forms. I like a spread-level plot that is a scatterplot of the positive square-root of the standardized residuals against the fitted values (remember that the fitted values are the values computed by the linear predictor of the model – they are the “predicted values” of the observed data). If the conditional outcome approximates samples from distributions with the same variance, then,</p>
<ol type="1">
<li>the regression line through the scatter should be close to horizontal.</li>
<li>the grey bounds on the regression line shouldn’t be tilted up more than expected. This means the bottom of the grey bound on the right-hand side shouldn’t be above the top end of the grey bound on the left-hand side.</li>
</ol>
<p>The regression line in the spread-level plot of the fit of the linear model to the sprout data shows a distinct increase in the “scale” (the square root of the standardized residuals) with increased fitted value, which is expected of data sampled from a distribution in which the variance increases with the mean.</p>
</section>
<section id="three-distributions-for-count-data-poisson-negative-binomial-and-quasipoisson" class="level5" data-number="17.5.3.2.3">
<h5 data-number="17.5.3.2.3" class="anchored" data-anchor-id="three-distributions-for-count-data-poisson-negative-binomial-and-quasipoisson"><span class="header-section-number">17.5.3.2.3</span> Three distributions for count data – Poisson, Negative Binomial, and Quasipoisson</h5>
<p>The patterns in the Normal Q-Q plot (<a href="#fig-glm-fig3a-qq" class="quarto-xref">Figure&nbsp;<span>17.4</span></a>) and the spread-level plot (<a href="#fig-glm-fig3a-sl" class="quarto-xref">Figure&nbsp;<span>17.5</span></a>) should discourage a researcher from modeling the data with a linear model and instead model the data with an alternative distribution using a Generalized Linear Model. There is no unique mapping between observed data and a data generating mechanism with a specific distribution, so this decision is not as easy as thinking about the data generation mechanism and then simply choosing the “correct” distribution. Section 4.5 in Bolker (xxx) is an excellent summary of how to think about the generating processes for different distributions in the context of ecological data. Since the response in the angiogenic sprouts data are counts, we need to choose a distribution that generates integer values, such as the Poisson, the Quasipoisson, and the Negative Binomial.</p>
<ol type="1">
<li>Poisson – A Poisson distribution is the probability distribution of the number of occurrences of some thing (a white blood cell, a tumor, or a specific mRNA transcript) generated by a process that generates the thing at a constant rate per unit effort (duration or space). This constant rate is the parameter <span class="math inline">\(\lambda\)</span>, which is the expectation (the expected mean of the counts), so <span class="math inline">\(\mathrm{E}(Y) = \mu = \lambda\)</span>. Because the rate per effort is constant, <em>the variance of a Poisson variable equals the mean</em>, <span class="math inline">\(\sigma^2 = \mu = \lambda\)</span>. <a href="#fig-glm1-fake-poisson" class="quarto-xref">Figure&nbsp;<span>17.6</span></a> shows three samples from a Poisson distribution with <span class="math inline">\(\lambda\)</span> set to 1, 5, and 10. The plots show that, as the mean count (<span class="math inline">\(\lambda\)</span>) moves away from zero, a Poisson distribution 1) becomes less skewed and more closely approximates a normal distribution and 2) has an increasingly low probability of including zero (less than 1% zeros when the mean is 5).</li>
</ol>
<p>A Poisson distribution, then, is useful for count data in which the conditional variance is close to the conditional mean. Very often, biological count data are not well approximated by a Poisson distribution because the variance is either less than the mean, an example of <strong>underdispersion</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, or greater than the mean, an example of <strong>overdispersion</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. A useful distribution for count data with overdispersion is the Negative Binomial.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm1-fake-poisson" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm1-fake-poisson-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm1-fake-poisson-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm1-fake-poisson-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.6: Poisson samples at three values of lambda (= mu).
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Negative Binomial – The Negative Binomial distribution is a discrete probability distribution of the number of successes that occur before a specified number of failures <span class="math inline">\(k\)</span> given a probability <em>p</em> of success. This isn’t a very useful way of thinking about modeling count data in biology. What is useful is that the Negative Binomial distribution can be used simply as way of modeling an <strong>overdispersed</strong> Poisson process, which means that the residuals of the fit model have many more small and many more large values than expected. Using the parameterization in the <code>MASS::glm.nb</code> function, the mean of a Negative Binomial variable is <span class="math inline">\(\mu\)</span> and the variance is <span class="math inline">\(\sigma^2 = \mu + \frac{\mu^2}{\theta}\)</span>. As a method for modeling an overdispersed Poisson variable, <span class="math inline">\(\theta\)</span> functions as an inverse **dispersion parameter* controlling the amount of overdispersion and can be any real, positive value (not simply a positive integer), including values less than 1. As <span class="math inline">\(\theta\)</span> approaches positive infinity, the “overdispersion” bit <span class="math inline">\(\frac{\mu^2}{\theta}\)</span> goes to zero and the variance goes to <span class="math inline">\(\mu\)</span>, which is the same as the Poisson.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="fig-glm1-fake-nb" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm1-fake-nb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm1-fake-nb-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm1-fake-nb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.7: Samples from Negative Binomial with different values of mu and theta parameters. Note the different scales of the x and y axes.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Quasipoisson – The Quasipoisson distribution is similar to the NB distribution in that it models overdispersion, which occurs when the variance increases faster than the mean. The Quasipoisson parameters are <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\theta\)</span>. The mean of the distribution is <span class="math inline">\(\mu\)</span> and the variance is <span class="math inline">\(\theta \mu\)</span>. In the NB, the overdispersion parameter <span class="math inline">\(\theta\)</span> is a function of the mean which makes the variance increase with the square of the mean. In the QP, the overdispersion parameter <span class="math inline">\(\theta\)</span> is not a function of the mean, so the variance increases linearly with the mean.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="NB1 vs NB2 in the glmmTMB package">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
NB1 vs NB2 in the glmmTMB package
</div>
</div>
<div class="callout-body-container callout-body">
<p>The glmmTMB package is a wicked-useful update of the base R glm functions. The glmmTMB package treats the Quasipoisson and the Negative Binomial as two versions of a Negative Binomial distribution and uses the notation:</p>
<ol type="1">
<li>NB1 – the variance increases linearly with the mean, so this is a Quasipoisson fit. Think “1 = linear”.</li>
<li>NB2 – the variance is a quadratic of the mean, so this is the classic Negative Binomial fit. Think “2 = quadratic”.</li>
</ol>
</div>
</div>
</section>
<section id="model-checking-a-glm-i-the-quantile-residual-uniform-qq-plot" class="level5" data-number="17.5.3.2.4">
<h5 data-number="17.5.3.2.4" class="anchored" data-anchor-id="model-checking-a-glm-i-the-quantile-residual-uniform-qq-plot"><span class="header-section-number">17.5.3.2.4</span> Model checking a GLM I – the quantile-residual uniform-QQ plot</h5>
<p>An alternative to a Normal-QQ plot for a GLM fit is a <strong>quantile-residual uniform-QQ</strong> plot of observed <strong>quantile residuals</strong>.</p>
<p>Let’s fit a Poisson GLM to the fig3a data and check the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fig3a_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>fig3a_pois_check <span class="ot">&lt;-</span> <span class="fu">ggcheck_the_glm</span>(fig3a_pois)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plotQQunif</span>(fig3a_pois_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-glm-fig3a-pois-qq" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-pois-qq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-pois-qq-1.png" class="img-fluid figure-img" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-pois-qq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.8: Quantile-residual uniform-QQ plot of the Poisson GLM fit to the angiogenic sprouts (fig3a) data.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The x-axis (“Expected”) contains the expected quantiles from a uniform distribution.</li>
<li>The y-axis (“Observed”) contains the observed quantile residuals from a GLM fit, which are the residuals from the fit model that are transformed in a way that the expected distribution is uniform under the fit model family. This means that we’d expect the quantile residuals to closely approximate the expected quantiles from a uniform distribution. If the approximation is close, the points will fall along the “y = x” line in the plot.</li>
<li>The observed residuals are smaller than expected at the negative (left) end and larger than expected at the right (high) end. This means the residuals are more spread out than expected for a Poisson sample. The residuals are overdispersed, or the data are overdispersed <em>for this model</em>. Understand that overdispersion is not a property of data but of the residuals from a specific model fit to the data.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="Misconceivable">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Misconceivable
</div>
</div>
<div class="callout-body-container callout-body">
<p>A common misconception is that if the distribution of the response approximates a Poisson distribution, then the residuals of a GLM fit with a Poisson distribution should be normally distributed, which could then be checked with a Normal-QQ plot, and homoskedastic, which could be checked with a scale-location plot. Neither of these is true because a GLM does not transform the data and, in fact, the model definition does not specify anything about the distribution of an “error” term – there is no <span class="math inline">\(\varepsilon\)</span> in the model definition above! This is why thinking about the definition of a linear model by specifying an error term with a normal distribution can be confusing and lead to misconceptions when learning GLMs.</p>
</div>
</div>
</section>
<section id="model-checking-a-glm-ii-spread-level-plot-for-checking-homoskedasticity" class="level5" data-number="17.5.3.2.5">
<h5 data-number="17.5.3.2.5" class="anchored" data-anchor-id="model-checking-a-glm-ii-spread-level-plot-for-checking-homoskedasticity"><span class="header-section-number">17.5.3.2.5</span> Model checking a GLM II – Spread-level plot for checking homoskedasticity</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotResiduals</span>(fig3a_pois_check, <span class="at">asFactor =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-glm-fig3a-pois-spreadlevel" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-pois-spreadlevel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-pois-spreadlevel-1.png" class="img-fluid figure-img" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-pois-spreadlevel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.9: Spread-level plot of the Poisson GLM fit to the angiogenic sprouts (fig3a) data.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The distribution of the observed, uniform residuals are summarized with a Box Plot for each of the four groups.</li>
<li>We expect Q1 (the lower edge of the box) to be at 25%, the median to be at 50%, and Q3 to be at 75%.</li>
<li>The uniform residuals for group 4 (“GAS6 FAK_ko”) are shifted more toward zero than expected, indicating that the fit model fits this group less well.</li>
</ol>
</section>
<section id="model-checking-a-glm-iii-checking-dispersion" class="level5" data-number="17.5.3.2.6">
<h5 data-number="17.5.3.2.6" class="anchored" data-anchor-id="model-checking-a-glm-iii-checking-dispersion"><span class="header-section-number">17.5.3.2.6</span> Model checking a GLM III – Checking dispersion</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(fig3a_pois_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 6.914, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-glm-fig3a-pois-dispersion" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-glm-fig3a-pois-dispersion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="glm_files/figure-html/fig-glm-fig3a-pois-dispersion-1.png" class="img-fluid figure-img" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-glm-fig3a-pois-dispersion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.10: Dispersion plot of the Negative Binomial GLM fit to the angiogenic sprouts (fig3a) data.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>This plot is a histogram of the sum of squared <strong>Pearson residuals</strong> of fake data sampled from the fit model. Pearson residuals are the raw residuals divided by the square root of the fitted value. Remember that in the Poisson distribution, the variance is equal to the expectation (mean), so a Pearson residual is the raw residual divided by the standard deviation of the residual. A way to think about this is, Pearson residuals “correct” for the heterogeneity in variance that arises among groups with different mean counts.</li>
<li>The sum of squared <strong>Pearson residuals</strong> is a measure of the dispersion of the residuals.</li>
<li>The red line is the observed sum of the squared Pearson residuals of the fit model.</li>
<li>If the observed dispersion approximates that expected from sampling from the fit model, the red line will be within the histogram.</li>
<li>The red line here is far larger than expected given the histogram, which indicates that the residuals are overdispersed given the fit model.</li>
<li>Overdispersion will be common with Poisson GLM fits to biological data.</li>
</ol>
</section>
<section id="model-checking-a-count-glm-check-zero-inflation" class="level5" data-number="17.5.3.2.7">
<h5 data-number="17.5.3.2.7" class="anchored" data-anchor-id="model-checking-a-count-glm-check-zero-inflation"><span class="header-section-number">17.5.3.2.7</span> Model Checking a count GLM – Check zero inflation</h5>
<p>Counts can have the value zero. Data that have more zeros than expected given a fit count GLM model (Poisson, quasi-Poisson, Negative Binomial) is <strong>zero-inflated</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>zero_inflation_test <span class="ot">&lt;-</span> <span class="fu">testZeroInflation</span>(fig3a_pois_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="1">
<li>This plot is a histogram of the number of zeros in each of the fake data sets generated by the fit model. An observed number of zeros at the extremes of this distribution are unlikely given the fit model. The number of zeros in the observed data is greater than expected by the model.</li>
</ol>
</section>
</section>
<section id="biological-count-data-are-rarely-fit-well-by-a-poisson-glm.-instead-fit-a-quasi-poisson-or-negative-binomial-glm-model." class="level4" data-number="17.5.3.3">
<h4 data-number="17.5.3.3" class="anchored" data-anchor-id="biological-count-data-are-rarely-fit-well-by-a-poisson-glm.-instead-fit-a-quasi-poisson-or-negative-binomial-glm-model."><span class="header-section-number">17.5.3.3</span> Biological count data are rarely fit well by a Poisson GLM. Instead, fit a quasi-poisson or Negative Binomial GLM model.</h4>
<p>The diagnostic plots of the fit Quasipoisson model are given in <span class="quarto-unresolved-ref">?sec-glm-fig3a-check</span>.</p>
</section>
<section id="a-glm-is-a-linear-model-on-the-link-scale" class="level4" data-number="17.5.3.4">
<h4 data-number="17.5.3.4" class="anchored" data-anchor-id="a-glm-is-a-linear-model-on-the-link-scale"><span class="header-section-number">17.5.3.4</span> A GLM is a linear model on the link scale</h4>
<p>The negative-binomial GLM fit to the angiogenic sprout data (fig3a) is</p>
<p><span id="eq-qp-glm-fig3a"><span class="math display">\[
\begin{align}
\texttt{sprouts}_i &amp;\sim \operatorname{quasipoisson}(\mu_i, \theta)\\
\mathrm{E}(\texttt{sprouts}\ | \ \texttt{treatment, genotype}) &amp;= \mu\\
\mu_i &amp;= \mathrm{exp}(\eta_i)\\
\eta_i &amp;= \beta_0 \ + \\
&amp; \quad \; \beta_1 \texttt{treatment}_{\texttt{GAS6}} \ + \\
&amp; \quad \; \beta_2 \texttt{genotype}_{\texttt{FAK\_ko}} \ + \\
&amp; \quad \; \beta_3 \texttt{treatment}_{\texttt{GAS6}}:\texttt{genotype}_{\texttt{FAK\_ko}}
\end{align}
\tag{17.4}\]</span></span></p>
<ol type="1">
<li>The first line of Model <a href="#eq-qp-glm-fig3a" class="quarto-xref">Equation&nbsp;<span>17.4</span></a> is the stochastic part stating the response is modeled as a random, Quasipoisson variable with conditional mean <span class="math inline">\(\mu_i\)</span>, and variance <span class="math inline">\(\theta \mu\)</span>. Fitting the model to the data estimates <span class="math inline">\(\mu_i\)</span> for all cases <em>i</em>. <span class="math inline">\(\mu_i\)</span> will be the same for all mice within each treatment by genotype combination because they share the same conditions (the values of the indicator variables for treatment, genotype, and their interaction).</li>
<li>The second line states the <span class="math inline">\(\mu\)</span> is the mean conditional on the value of <span class="math inline">\(\texttt{treatment}\)</span> and <span class="math inline">\(\texttt{genotype}\)</span></li>
<li>The third line connects the conditional mean on the link scale (<span class="math inline">\(\eta\)</span>) with the conditional mean on the response scale (<span class="math inline">\(\mu\)</span>). This is the backtransformation.</li>
<li>The fourth line is the <strong>linear predictor</strong> – it is a linear model on the link scale. The linear predictor includes three indicator variables.</li>
<li>Remember that a linear model is a model in which the coefficients are additive, meaning that the coefficients do not have exponents or are not multiplied by each other.</li>
</ol>
</section>
<section id="coeffecients-of-a-generalized-linear-model-with-a-log-link-function-are-on-the-link-scale." class="level4" data-number="17.5.3.5">
<h4 data-number="17.5.3.5" class="anchored" data-anchor-id="coeffecients-of-a-generalized-linear-model-with-a-log-link-function-are-on-the-link-scale."><span class="header-section-number">17.5.3.5</span> Coeffecients of a Generalized Linear Model with a log-link function are on the link scale.</h4>
<p>The coefficients of the fit Quasipoisson model are</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 32%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 21%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.90446</td>
<td style="text-align: right;">0.367</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">1.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatmentGAS6</td>
<td style="text-align: right;">1.29805</td>
<td style="text-align: right;">0.406</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">genotypeFAK_ko</td>
<td style="text-align: right;">0.04462</td>
<td style="text-align: right;">0.563</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.937</td>
<td style="text-align: right;">-1.12</td>
<td style="text-align: right;">1.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatmentGAS6:genotypeFAK_ko</td>
<td style="text-align: right;">0.46382</td>
<td style="text-align: right;">0.603</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">0.444</td>
<td style="text-align: right;">-0.71</td>
<td style="text-align: right;">1.70</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The coefficients are on the link scale, which is a linear (additive) scale.</li>
</ol>
<section id="the-intercept-of-a-generalized-linear-model-with-a-log-link-function-is-the-mean-of-the-reference-on-the-link-scale" class="level5" data-number="17.5.3.5.1">
<h5 data-number="17.5.3.5.1" class="anchored" data-anchor-id="the-intercept-of-a-generalized-linear-model-with-a-log-link-function-is-the-mean-of-the-reference-on-the-link-scale"><span class="header-section-number">17.5.3.5.1</span> The intercept of a Generalized Linear Model with a log-link function is the mean of the reference on the link scale</h5>
<ol type="1">
<li>In the linear model <code>fig3a_lm</code>, the intercept is the modeled mean of the reference group. In a GLM with a log-link (including Models <code>fig3a_pois</code> and <code>fig3a_qp</code>), the intercept is the mean of the reference group <em>on the link scale</em>. The modeled mean of the reference on the response scale is computed by the backtransformaiton <span class="math inline">\(\exp(b_1)\)</span>. The function “exp(x)” is the exponent, which is often written using the notation <span class="math inline">\(e^{x}\)</span>.</li>
<li>The transformation between link scale and response scale is part of the specification of a Generalized Linear Model. For the Quasipoisson GLM fit to the fig3a data, this specification is in line 3 of the specification (<a href="#eq-qp-glm-fig3a" class="quarto-xref">Equation&nbsp;<span>17.4</span></a>).</li>
</ol>
<p>Compare the computation here with the modeled mean in the emmeans table (<span class="citation" data-cites="glm-fig3a-qp-inference">(<a href="#ref-glm-fig3a-qp-inference" role="doc-biblioref"><strong>glm-fig3a-qp-inference?</strong></a>)</span>) or with a computation of the sample mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fig3a_qp)[<span class="dv">1</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(b1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   2.470588 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fig3a[group <span class="sc">==</span> <span class="st">"PBS FAK_wt"</span>, sprouts])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.470588</code></pre>
</div>
</div>
</section>
<section id="the-coefficients-of-the-indicator-variables-of-a-generalized-linear-model-with-a-log-link-function-are-effect-ratios-on-the-response-scale" class="level5" data-number="17.5.3.5.2">
<h5 data-number="17.5.3.5.2" class="anchored" data-anchor-id="the-coefficients-of-the-indicator-variables-of-a-generalized-linear-model-with-a-log-link-function-are-effect-ratios-on-the-response-scale"><span class="header-section-number">17.5.3.5.2</span> The coefficients of the indicator variables of a Generalized Linear Model with a log-link function are effect-ratios on the response scale</h5>
<ol type="1">
<li>In the linear model <code>fig3a_lm</code>, the coefficient of an indicator variable is a difference in means. In a GLM with a log-link, the coefficient of an indicator variable is the difference (group minus reference) of the modeled means <em>on the link scale</em>. Let’s check this with some computations.</li>
</ol>
<p>The modeled means on the link scale are in the emmeans table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp_emm_link <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fig3a_qp,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"genotype"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using this table, the difference between the link-scale mean of “GAS6 FAK_wt” and “PBS FAK_wt” (the reference) is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp_emm_link[treatment <span class="sc">==</span> <span class="st">"GAS6"</span> <span class="sc">&amp;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                    genotype <span class="sc">==</span> <span class="st">"FAK_wt"</span>, emmean] <span class="sc">-</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  fig3a_qp_emm_link[treatment <span class="sc">==</span> <span class="st">"PBS"</span> <span class="sc">&amp;</span> genotype <span class="sc">==</span> <span class="st">"FAK_wt"</span>, emmean]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.298045</code></pre>
</div>
</div>
<p>And the coefficient for the <span class="math inline">\(\texttt{treatment}_{\texttt{gas6}}\)</span> indicator variable is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficient for treatment_gas6</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fig3a_qp)[<span class="dv">2</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>b2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>treatmentGAS6 
     1.298045 </code></pre>
</div>
</div>
<ol start="2" type="1">
<li>In a GLM with a log-link, the exponent of the coefficient of an indicator variable is the ratio of the modeled means <em>on the response scale</em>. Let’s check this with some computations.</li>
</ol>
<p>The modeled means on the response scale are in the emmeans table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp_emm_response <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fig3a_qp,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"genotype"</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using this table, the ratio of the mean “GAS6 FAK_wt” on the response scale to the mean “PBS FAK_wt” (the reference) on the response scale is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>gas6_fak_wt_mean <span class="ot">&lt;-</span> fig3a_qp_emm_response[treatment <span class="sc">==</span> <span class="st">"GAS6"</span> <span class="sc">&amp;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                    genotype <span class="sc">==</span> <span class="st">"FAK_wt"</span>, rate]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>pbs_fak_wt_mean <span class="ot">&lt;-</span> fig3a_qp_emm_response[treatment <span class="sc">==</span> <span class="st">"PBS"</span> <span class="sc">&amp;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                    genotype <span class="sc">==</span> <span class="st">"FAK_wt"</span>, rate]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>gas6_fak_wt_mean <span class="sc">/</span> pbs_fak_wt_mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.662132</code></pre>
</div>
</div>
<p>And the coefficient for the <span class="math inline">\(\texttt{treatment}_{\texttt{gas6}}\)</span> indicator variable backtransformed to the response scale is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>exp_b2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(b2)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>exp_b2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>treatmentGAS6 
     3.662132 </code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Since this backtransformed coefficient is both an effect and a ratio, I call it an <strong>effect ratio</strong>. It’s value is a multiple of the non-reference response, that is, how many times bigger (or smaller if less than one) the non-reference response is relative to the reference response. The response of the GAS6 treatment is 3.66<span class="math inline">\(\times\)</span> bigger than the response of the reference treatment.</li>
</ol>
</section>
</section>
<section id="modeled-means-in-the-emmeans-table-of-a-generalized-linear-model-can-be-on-the-link-scale-or-response-scale-report-the-response-scale" class="level4" data-number="17.5.3.6">
<h4 data-number="17.5.3.6" class="anchored" data-anchor-id="modeled-means-in-the-emmeans-table-of-a-generalized-linear-model-can-be-on-the-link-scale-or-response-scale-report-the-response-scale"><span class="header-section-number">17.5.3.6</span> Modeled means in the emmeans table of a Generalized Linear Model can be on the link scale or response scale – Report the response scale</h4>
<section id="glm-fig3a-emmans-link" class="level5" data-number="17.5.3.6.1">
<h5 data-number="17.5.3.6.1" class="anchored" data-anchor-id="glm-fig3a-emmans-link"><span class="header-section-number">17.5.3.6.1</span> The emmeans table on the link scale contains the log means</h5>
<div class="cell">
<div id="fig-fig3a-qp-emm-link" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fig3a-qp-emm-link-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Modeled means on the link scale contain the log means</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">emmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PBS</td>
<td style="text-align: left;">FAK_wt</td>
<td style="text-align: right;">0.90446</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">1.62</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6</td>
<td style="text-align: left;">FAK_wt</td>
<td style="text-align: right;">2.20250</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.86</td>
<td style="text-align: right;">2.54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PBS</td>
<td style="text-align: left;">FAK_ko</td>
<td style="text-align: right;">0.94908</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">1.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6</td>
<td style="text-align: left;">FAK_ko</td>
<td style="text-align: right;">2.71094</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">2.46</td>
<td style="text-align: right;">2.96</td>
</tr>
</tbody>
</table>


</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fig3a-qp-emm-link-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.11: Emmeans table on the link scale
</figcaption>
</figure>
</div>
</div>
<ol type="1">
<li>The values are the statistics on the link scale. The mean and CI, but not the SE, can be meaningfully backtransformed to the response scale using the exponent function to get the mean and CI on the response scale.</li>
<li>The CIs are “asymptotic”, meaning they are computed using infinite degrees of freedom. The consequences is that the CIs will be too narrow, especially for small <em>n</em>.</li>
<li>Check the math! Given asymptotic CIs, the lower CI should be (mean - 1.96 <span class="math inline">\(\times\)</span> SE) and the upper should be (mean + 1.96 <span class="math inline">\(\times\)</span> SE).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.90446</span> <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fl">0.23</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.45366</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>A GLM is linear on the link scale. This means the model is additive on the link scale. Modeled means on the link scale are computed by <em>adding</em> the coefficients.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(fig3a_qp) <span class="co"># the model coefficients</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the way I typically compute these</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>pbs_fak_wt_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>gas6_fak_wt_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>] </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>pbs_fak_ko_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">3</span>]</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>gas6_fak_ko_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>] <span class="sc">+</span> b[<span class="dv">3</span>] <span class="sc">+</span> b[<span class="dv">4</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># but this is the algebra more consistent with the linear model math</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>pbs_fak_wt_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">0</span> <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span><span class="dv">0</span> <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>gas6_fak_wt_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span><span class="dv">0</span> <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>pbs_fak_ko_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">0</span> <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>gas6_fak_ko_link <span class="ot">&lt;-</span> b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># combine into a table</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>fig3a_means <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> group_levels,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mean (link scale)"</span> <span class="ot">=</span> <span class="fu">c</span>(pbs_fak_wt_link,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>                          gas6_fak_wt_link,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                          pbs_fak_ko_link,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                          gas6_fak_ko_link)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table of group treatment by genotype means on the link scale</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">group</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean (link scale)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PBS FAK_wt</td>
<td style="text-align: right;">0.90446</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6 FAK_wt</td>
<td style="text-align: right;">2.20250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PBS FAK_ko</td>
<td style="text-align: right;">0.94908</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6 FAK_ko</td>
<td style="text-align: right;">2.71094</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Compare the values here to those in the emmeans table on the link scale (<a href="#fig-fig3a-qp-emm-link" class="quarto-xref">Figure&nbsp;<span>17.11</span></a>).</p>
</section>
<section id="the-emmeans-table-on-the-response-scale-contains-more-readily-interpretable-means" class="level5" data-number="17.5.3.6.2">
<h5 data-number="17.5.3.6.2" class="anchored" data-anchor-id="the-emmeans-table-on-the-response-scale-contains-more-readily-interpretable-means"><span class="header-section-number">17.5.3.6.2</span> The emmeans table on the response scale contains more readily interpretable means</h5>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>The modeled means on the response scale</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PBS</td>
<td style="text-align: left;">FAK_wt</td>
<td style="text-align: right;">2.47059</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">5.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6</td>
<td style="text-align: left;">FAK_wt</td>
<td style="text-align: right;">9.04762</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">6.45</td>
<td style="text-align: right;">12.69</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PBS</td>
<td style="text-align: left;">FAK_ko</td>
<td style="text-align: right;">2.58333</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">5.97</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6</td>
<td style="text-align: left;">FAK_ko</td>
<td style="text-align: right;">15.04348</td>
<td style="text-align: right;">1.92</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">11.71</td>
<td style="text-align: right;">19.33</td>
</tr>
</tbody>
</table>


</div>
</div>
<ol type="1">
<li>The values in the column “response” are the modeled means on the response scale. These values are the exponent of the values in the “emmean” column of the emmeans table on the link scale.</li>
<li>The values in the columns “asymp.LCL” and “asymp.UCL” are the 95% confidence intervals on the response scale. These values are the exponent of the values in the same columns of the emmeans table on the link scale.</li>
<li>Don’t do additive math on the response scale! Remember, a GLM is linear on the link scale. The CIs on the response scale are not the mean plus or minus 1.96 <span class="math inline">\(\times\)</span> SE!</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fl">2.47059</span> <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fl">0.57</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.35339</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># oops</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Modeled means on the response scale are computed by backtransforming the modeled means on the link scale. Since the fit model used a log-link, the backtransformation is the exponent.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pbs_fak_wt_response <span class="ot">&lt;-</span> <span class="fu">exp</span>(pbs_fak_wt_link)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>gas6_fak_wt_response <span class="ot">&lt;-</span> <span class="fu">exp</span>(gas6_fak_wt_link)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>pbs_fak_ko_response <span class="ot">&lt;-</span> <span class="fu">exp</span>(pbs_fak_ko_link)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>gas6_fak_ko_response <span class="ot">&lt;-</span> <span class="fu">exp</span>(gas6_fak_ko_link)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add a column to the fig3a_means data.table</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>fig3a_means[, <span class="st">"mean (response scale)"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">c</span>(pbs_fak_wt_response,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                                            gas6_fak_wt_response,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                                            pbs_fak_ko_response,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                                            gas6_fak_ko_response)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table of group treatment by genotype means on both the link and response scale.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">group</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean (link scale)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean (response scale)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PBS FAK_wt</td>
<td style="text-align: right;">0.90446</td>
<td style="text-align: right;">2.47059</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6 FAK_wt</td>
<td style="text-align: right;">2.20250</td>
<td style="text-align: right;">9.04762</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PBS FAK_ko</td>
<td style="text-align: right;">0.94908</td>
<td style="text-align: right;">2.58333</td>
</tr>
<tr class="even">
<td style="text-align: left;">GAS6 FAK_ko</td>
<td style="text-align: right;">2.71094</td>
<td style="text-align: right;">15.04348</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Compare the values here to those in the emmeans table on the response scale (<span class="citation" data-cites="fig3a-qp-emm-response">(<a href="#ref-fig3a-qp-emm-response" role="doc-biblioref"><strong>fig3a-qp-emm-response?</strong></a>)</span>).</p>
</section>
</section>
</section>
<section id="some-consequences-of-fitting-a-linear-model-to-count-data" class="level3" data-number="17.5.4">
<h3 data-number="17.5.4" class="anchored" data-anchor-id="some-consequences-of-fitting-a-linear-model-to-count-data"><span class="header-section-number">17.5.4</span> Some consequences of fitting a linear model to count data</h3>
<section id="one-linear-models-can-make-absurd-predictions" class="level4" data-number="17.5.4.1">
<h4 data-number="17.5.4.1" class="anchored" data-anchor-id="one-linear-models-can-make-absurd-predictions"><span class="header-section-number">17.5.4.1</span> One – linear models can make absurd predictions</h4>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="glm_files/figure-html/glm-absurd-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>A) A linear model fit to the fig3a data implies these 95% prediction intervals. B) 100 fake sprout counts for each treatment by genotype combination sampled from the linear model. C) 100 fake sprout counts for each treatment by genotype combination sampled from the Negative Binomial GLM.</figcaption>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>A prediction interval is a confidence interval of a prediction – using the fit model to predict future responses given the same conditions (here, assignment to one of the four different treatment combinations).</li>
<li>Left panel: The prediction intervals from the linear model imply that negative sprouts could be sampled. This is absurd.</li>
<li>Middle panel: The fit linear model is used to make 100 fake predictions in each group.</li>
<li>Right panel: The fit Negative Binomial GLM is used to make 100 fake predictions in each group. Nothing absurd here.</li>
</ol>
</section>
<section id="two-linear-models-can-perform-surprisingly-well-if-one-is-only-interested-in-p-values" class="level4" data-number="17.5.4.2">
<h4 data-number="17.5.4.2" class="anchored" data-anchor-id="two-linear-models-can-perform-surprisingly-well-if-one-is-only-interested-in-p-values"><span class="header-section-number">17.5.4.2</span> Two – linear models can perform surprisingly well if one is only interested in <em>p</em>-values</h4>
<p><em>P</em>-values are a function of the sampling distribution of group means and differences in means, and, due to the magic of the <a href="https://en.wikipedia.org/wiki/Central_limit_theorem" target="_blank">central limit theorem</a>, linear models fit to count data perform surprisingly well in the sense of</p>
<ol type="1">
<li>Type I error that approximates the nominal value</li>
<li>Reasonable power compared to GLM models and many non-parametric tests.</li>
</ol>
</section>
</section>
</section>
<section id="sec-glm-offset" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="sec-glm-offset"><span class="header-section-number">17.6</span> Example 2–GLM offset models (“dna damage” data fig3b)</h2>
<section id="instead-of-a-t-test-or-mann-whitney-test-of-area-normalized-counts-counts-per-area-fit-a-glm-count-model-with-the-raw-count-as-the-response-and-the-sampling-effort-area-as-an-offset-to-gain-power" class="level3" data-number="17.6.1">
<h3 data-number="17.6.1" class="anchored" data-anchor-id="instead-of-a-t-test-or-mann-whitney-test-of-area-normalized-counts-counts-per-area-fit-a-glm-count-model-with-the-raw-count-as-the-response-and-the-sampling-effort-area-as-an-offset-to-gain-power"><span class="header-section-number">17.6.1</span> Instead of a <em>t</em>-test or Mann-Whitney test of area-normalized counts (“counts per area”), fit a GLM count model with the raw count as the response and the sampling effort (area) as an offset to gain power</h3>
<p>A problem that often arises in count data (and other kinds of measures) are counts that are taken in samples with different areas or volumes of tissue. As a consequence, the sampling “effort” (area) is confounded with the treatment response–samples with higher counts may have higher counts because of a different response to treatment, a larger amount of tissue, or some combination. The common practice in experimental biology is to adjust for tissue size variation by area-normalizing the count using the ratio <span class="math inline">\(\frac{count}{area}\)</span> and then testing for a difference in the normalized count using either a linear model NHST (<em>t</em>-test/ANOVA) or a non-parametric NHST (Mann-Whitney-Wilcoxan). These practices raise at least two statistical issues.</p>
<ol type="1">
<li>The ratio will have some kind of <a href="https://en.wikipedia.org/wiki/Ratio_distribution" target="_blank">ratio distribution</a> that violates the normal distribution assumption of the linear model.</li>
<li>A Mann-Whitney-Wilcoxan does not estimate meaningful effects, is less powerful than GLM models, and is not flexible for complex designs including factorial or covariate models.</li>
</ol>
<p>A better practice is to model the count using a GLM that adds the denominator of the ratio (the area or volume) as an <strong>offset</strong> in the model. A count GLM with offset also models the ratio (see section <a href="#sec-glm-rate" class="quarto-xref"><span>Section 17.7.2</span></a>) below), but in a way that is likely to be much more compatible with the data.</p>
<p>NHST of the ratios will perform okay in the sense of Type I error that is close to nominal but will have relatively low power compared to a generalized linear model with offset. If the researcher is interested in best practices including the reporting of uncertainty of estimated effects, a GLM with offset will have more useful confidence intervals – for example CIs from linear model assuming Normal error can often include absurd values such as ratios less than zero.</p>
</section>
<section id="fig3b-dna-damage-data" class="level3" data-number="17.6.2">
<h3 data-number="17.6.2" class="anchored" data-anchor-id="fig3b-dna-damage-data"><span class="header-section-number">17.6.2</span> fig3b (“dna damage”) data</h3>
<p>Source article (Fernández, Álvaro F., et al.&nbsp;“Disruption of the beclin 1–BCL2 autophagy regulatory complex promotes longevity in mice.” Nature 558.7708 (2018): 136-140.)<span target="_blank">https://www.nature.com/articles/s41586-018-0162-7</span></p>
<p>These data were first introduced in the Issues chapter, Section <span class="quarto-unresolved-ref">?sec-issues-offset</span>. There, only the age 20 month data were analyzed. Here, the full dataset is analyzed.</p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5992097/" target="_blank">Public source</a></p>
<p><a href="https://www.nature.com/articles/s41586-018-0162-7#Sec15" target="_blank">Source data for Fig. 3</a></p>
<p>The example here is from Fig 3b.</p>
</section>
<section id="understand-the-data-1" class="level3" data-number="17.6.3">
<h3 data-number="17.6.3" class="anchored" data-anchor-id="understand-the-data-1"><span class="header-section-number">17.6.3</span> Understand the data</h3>
<p>Response variable – number of <a href="https://en.wikipedia.org/wiki/TUNEL_assay" target="_blank">TUNEL+</a> cells measured in kidney tissue, where a positive marker indicates nuclear DNA damage.</p>
<p>Background. The experiments in Figure 3 were designed to measure the effect of a knock-in mutation in the gene for the <a href="https://en.wikipedia.org/wiki/BECN1" target="_blank">beclin 1 protein</a> on autophagy and tissue health in the kidney and heart. The researchers were interested in autophagy because there is evidence in many non-mammalian model organisms that increased autophagy reduces age-related damage to tissues and increases health and lifespan. <a href="https://en.wikipedia.org/wiki/Bcl-2" target="_blank">BCL2</a> is an autophagy inhibitor. Initial experiments showed that the knock-in mutation in beclin 1 inhibits BCL2. Inhibiting BCL2 with the knock-in mutation should increase autophagy and, as a consequence, reduce age-related tissue damage.</p>
<p>Design - <span class="math inline">\(2 \times 2\)</span> factorial</p>
<ol type="1">
<li>Factor 1: <span class="math inline">\(\texttt{age}\)</span> with levels “Young” (two months) and “Old” (twenty months).</li>
<li>Factor 2: <span class="math inline">\(\texttt{genotype}\)</span> with levels “WT” (wildtype) and “KI” (knock-in).</li>
<li>Offset (a covariate): <span class="math inline">\(\texttt{area\_mm2}\)</span>. The area of the kidney tissue containing the counted cells.</li>
</ol>
<p>The planned contrasts are</p>
<ol type="1">
<li>(Young KI) - (Young WT) – the effect of the beclin 1 knock-in mutation in the 2 month old mice. We expect this effect to be negative (more damage in the WT) but small, assuming there is little BCL2-related DNA damage by 2 months.</li>
<li>(Old KI) - (Old WT) – the effect of the beclin 1 knock-in mutation in the 20 month old mice. We expect this effect to be negative (more damage in the WT) but large assuming there is substantial BCL2-related DNA damage by 20 months.</li>
<li>Interaction. The magnitude of the interaction will largely be a function of the difference in BCL2-related DNA damage between 2 and 20 months and not really a function with how the knockin functions at these two ages.</li>
</ol>
</section>
<section id="model-fit-and-inference-1" class="level3" data-number="17.6.4">
<h3 data-number="17.6.4" class="anchored" data-anchor-id="model-fit-and-inference-1"><span class="header-section-number">17.6.4</span> Model fit and inference</h3>
<section id="fit-the-models-1" class="level4" data-number="17.6.4.1">
<h4 data-number="17.6.4.1" class="anchored" data-anchor-id="fit-the-models-1"><span class="header-section-number">17.6.4.1</span> Fit the models</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lm with ratio response</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fig3b_m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(count_per_area <span class="sc">~</span> age <span class="sc">*</span> genotype,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> fig3b)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># poisson offset</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>fig3b_m2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(positive_nuclei <span class="sc">~</span> age <span class="sc">*</span> genotype <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">offset</span>(<span class="fu">log</span>(area_mm2)),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="st">"poisson"</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3b)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># nb offset</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>fig3b_m3 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(positive_nuclei <span class="sc">~</span> age <span class="sc">*</span> genotype <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">offset</span>(<span class="fu">log</span>(area_mm2)),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> fig3b)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># non-parametric</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>fig3b_m4_2mo <span class="ot">&lt;-</span> <span class="fu">wilcox.test</span>(count_per_area <span class="sc">~</span> genotype,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> fig3b[age <span class="sc">==</span> <span class="st">"Young"</span>])</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>fig3b_m4_20mo <span class="ot">&lt;-</span> <span class="fu">wilcox.test</span>(count_per_area <span class="sc">~</span> genotype,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> fig3b[age <span class="sc">==</span> <span class="st">"Old"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wilcox.test.default(x = DATA[[1L]], y = DATA[[2L]], ...): cannot
compute exact p-value with ties</code></pre>
</div>
</div>
</section>
<section id="check-the-models-1" class="level4" data-number="17.6.4.2">
<h4 data-number="17.6.4.2" class="anchored" data-anchor-id="check-the-models-1"><span class="header-section-number">17.6.4.2</span> Check the models</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcheck_the_model</span>(fig3b_m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3b_m1-check-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig3b_m2_check <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> fig3b_m2, <span class="at">n =</span> <span class="dv">250</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fig3b_m2_check, <span class="at">asFactor =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3b_m2_check-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig3b_m3_check <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> fig3b_m3,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">n =</span> <span class="dv">250</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fig3b_m3_check, <span class="at">asFactor =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3b_m3_check-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-glm-fig3b-m3-inference" class="level4" data-number="17.6.4.3">
<h4 data-number="17.6.4.3" class="anchored" data-anchor-id="sec-glm-fig3b-m3-inference"><span class="header-section-number">17.6.4.3</span> Inference from the model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig3b_m3_coef <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(fig3b_m3)),</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">confint</span>(fig3b_m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;&amp;#124;z&amp;#124;)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2.5 %</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.508</td>
<td style="text-align: right;">-0.1</td>
<td style="text-align: right;">0.887</td>
<td style="text-align: right;">-0.95</td>
<td style="text-align: right;">1.09</td>
</tr>
<tr class="even">
<td style="text-align: left;">ageOld</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.575</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.133</td>
<td style="text-align: right;">-0.39</td>
<td style="text-align: right;">1.91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">genotypeKI</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.722</td>
<td style="text-align: right;">-0.1</td>
<td style="text-align: right;">0.887</td>
<td style="text-align: right;">-1.56</td>
<td style="text-align: right;">1.36</td>
</tr>
<tr class="even">
<td style="text-align: left;">ageOld:genotypeKI</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">0.806</td>
<td style="text-align: right;">-0.8</td>
<td style="text-align: right;">0.416</td>
<td style="text-align: right;">-2.27</td>
<td style="text-align: right;">0.96</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mean_area <span class="ot">&lt;-</span> <span class="fu">mean</span>(fig3b[age <span class="sc">==</span> <span class="st">"Old"</span> <span class="sc">&amp;</span> genotype <span class="sc">==</span> <span class="st">"WT"</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                        positive_nuclei])</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fig3b_m3_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fig3b_m3,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"genotype"</span>),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type=</span><span class="st">"response"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">offset =</span> <span class="fu">log</span>(mean_area))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">response</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Young</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">58.20</td>
<td style="text-align: right;">29.6</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">21.51</td>
<td style="text-align: right;">157.48</td>
</tr>
<tr class="even">
<td style="text-align: left;">Old</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">137.86</td>
<td style="text-align: right;">37.0</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">81.42</td>
<td style="text-align: right;">233.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Young</td>
<td style="text-align: left;">KI</td>
<td style="text-align: right;">52.53</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">19.20</td>
<td style="text-align: right;">143.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">Old</td>
<td style="text-align: left;">KI</td>
<td style="text-align: right;">64.57</td>
<td style="text-align: right;">15.3</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">40.55</td>
<td style="text-align: right;">102.80</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fig3b_m3_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(fig3b_m3_emm,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">method =</span> <span class="st">"revpairwise"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fig3b_m3_emm # print in console to get row numbers</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set the mean as the row number from the emmeans table</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>young_wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>old_wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>young_ki <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>old_ki <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">#1. (Young KI) - (Young WT)</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#2. (Old   KI) - (Old   WT)</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">#3. Interaction</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>fig3b_m3_planned <span class="ot">&lt;-</span> <span class="fu">contrast</span>(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  fig3b_m3_emm,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">list</span>(</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(Young KI) - (Young WT)"</span> <span class="ot">=</span> <span class="fu">c</span>(young_ki <span class="sc">-</span> young_wt),</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"(Old   KI) - (Old   WT)"</span> <span class="ot">=</span> <span class="fu">c</span>(old_ki <span class="sc">-</span> old_wt),</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Interaction"</span> <span class="ot">=</span> <span class="fu">c</span>((old_ki <span class="sc">-</span> old_wt) <span class="sc">-</span> (young_ki <span class="sc">-</span> young_wt))</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "Interaction" = c(old_ki - old_wt) -</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   c(young_ki - young_wt)</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">adjust =</span> <span class="st">"none"</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">contrast</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">null</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z.ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Young KI) / (Young WT)</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.652</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.14200</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Old KI) / (Old WT)</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.168</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.11608</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Interaction</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.418</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">2.52</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.81353</td>
<td style="text-align: right;">0.4</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Notes</p>
</section>
<section id="plot-the-model" class="level4" data-number="17.6.4.4">
<h4 data-number="17.6.4.4" class="anchored" data-anchor-id="plot-the-model"><span class="header-section-number">17.6.4.4</span> Plot the model</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-eg2-fig3b-m3-gg1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="understanding-example-2" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="understanding-example-2"><span class="header-section-number">17.7</span> Understanding Example 2</h2>
<section id="an-offset-is-an-added-covariate-with-a-coefficient-fixed-at-1" class="level3" data-number="17.7.1">
<h3 data-number="17.7.1" class="anchored" data-anchor-id="an-offset-is-an-added-covariate-with-a-coefficient-fixed-at-1"><span class="header-section-number">17.7.1</span> An offset is an added covariate with a coefficient fixed at 1</h3>
<p>The systematic part (the linear predictor) of the Negative Binomial model fit to the fig3b data is</p>
<p><span class="math display">\[
\begin{align}
\texttt{positive\_nuclei} = \ &amp;\beta_0 + \beta_1 \texttt{age}_\texttt{Old} + \beta_2 \texttt{genotype}_\texttt{KI} \ + \\ &amp;\beta_3 \texttt{age}_\texttt{Old}\texttt{:genotype}_\texttt{KI} \ + \\
&amp;1.0 \times \textrm{log}(\texttt{area\_mm2})
\end{align}
\]</span></p>
<p>Notes</p>
<ol type="1">
<li>The offset variable is <span class="math inline">\(\textrm{log}(\texttt{area\_mm2})\)</span>. An offset is a covariate with a fixed coefficient of 1.0 – this coefficient is not estimated.</li>
<li><span class="quarto-unresolved-ref">?fig-glm-eg2-fig3b-m3-plot-offset</span> illustrates the offset on the response and the log scale.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="glm_files/figure-html/glm-eg2-fig3b-m3-plot-offset-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>What an offset looks like. A. The offset on the response scale. B. The offset on the log scale. In A and B, only the lines for the 20 month old mice are shown.</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>On the log-link scale (@-fig-glm-eg2-fig3b-m3-plot-offset B), the offset curves are parallel because each is forced to have a slope of one on this scale. On the response scale, these curves have different slopes – this slope is <span class="math inline">\(\mathrm{exp}(b_0)\)</span>, that is, the exponent of the intercept on the log scale).</li>
<li>The plot on the log scale (<span class="quarto-unresolved-ref">?fig-glm-eg2-fig3b-m3-plot-offset</span> B) is easy to misinterpret as a regression with a slope of 1 fit to the log transformed values. It isn’t, because individual values are not transformed in a GLM. I’m specifically referring to this space as the log and not link scale to try to avoid this misinterpretation.</li>
</ol>
</section>
<section id="sec-glm-rate" class="level3" data-number="17.7.2">
<h3 data-number="17.7.2" class="anchored" data-anchor-id="sec-glm-rate"><span class="header-section-number">17.7.2</span> A count GLM with an offset models the ratio of area-normalized means</h3>
<p>In the <em>t</em>-test or ANOVA of the difference in the area-normalized count of TUNEL+ nuclei, the systematic component of the equivalent linear model is (using only the 20 month old mice for simplicity)</p>
<p><span class="math display">\[
\frac{\mu}{\texttt{area\_mm2}} = \beta_0 + \beta_1 \texttt{genotype}_\texttt{KI}
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean response (<span class="math inline">\(\texttt{positive\_nuclei}\)</span>) conditional on the level of genotype. Statisticians typically refer to the ratio <span class="math inline">\(\frac{\mu}{\texttt{area\_mm2}}\)</span> as a rate – here, it is the expected rate of observing a TUNEL+ nucleus as more area is searched.</p>
<p>Let’s compare this to the GLM model recommended here. Recall that the conditional expecation on the link scale is <span class="math inline">\(\eta\)</span> and, using the inverse link function, <span class="math inline">\(\mathrm{log}(\mu) = \eta\)</span>, the systematic part of the count GLM model with offset is</p>
<p><span class="math display">\[
\begin{align}
\eta &amp;= \beta_0 + \beta_1 \texttt{genotype}_\texttt{KI} + \mathrm{log}(\texttt{area\_mm2}) \\
\mathrm{log}(\mu) &amp;= \beta_0 + \beta_1 \texttt{genotype}_\texttt{KI} + \mathrm{log}(\texttt{area\_mm2}) \\
\mathrm{log}(\mu) - \mathrm{log}(\texttt{area\_mm2}) &amp;= \beta_0 + \beta_1 \texttt{genotype}_\texttt{KI} \\
\mathrm{log}(\frac{\mu}{\texttt{area\_mm2}}) &amp;= \beta_0 + \beta_1 \texttt{genotype}_\texttt{KI} \\
\frac{\mu}{\texttt{area\_mm2}} &amp;= \mathrm{exp}(\beta_0 + \beta_1 \texttt{genotype}_\texttt{KI}) \\
\end{align}
\]</span></p>
<p>That is, the GLM with offset also models the conditional mean of the area-normalized count, but in a way where the data are much more compatible with the assumptions of the statistical model (in the sense that model checks show that the data look like a sample from the statistical model).</p>
<p>If you want the area-normalized means and their uncertainty under the assumptions of the count GLM offset model, here is some code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mean_area <span class="ot">&lt;-</span> <span class="fu">mean</span>(fig3b[, area_mm2])</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># link scale</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute rate or normalized count using emmeans</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># setting the offset will compute mean at the specified</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># value of the offset</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># be sure the stats are on the link scale</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>m3_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fig3b_m3,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"genotype"</span>),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">offset =</span> <span class="fu">log</span>(mean_area)) <span class="sc">|&gt;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans is returning the first line in equations above.</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># We want the last line. So subtract the log of the offset value.</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>m3_emm[, log_rate <span class="sc">:</span><span class="er">=</span> emmean <span class="sc">-</span> <span class="fu">log</span>(mean_area)]</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co"># and compute the 95% asymptotic CIs</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>m3_emm[, log_rate_lcl <span class="sc">:</span><span class="er">=</span> log_rate <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>SE]</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>m3_emm[, log_rate_ucl <span class="sc">:</span><span class="er">=</span> log_rate <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>SE]</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co"># m3_emm</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co"># response scale</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>m3_emm_response <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fig3b_m3,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"genotype"</span>),</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">offset =</span> <span class="fu">log</span>(mean_area),</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="co"># replace the mean and CIs with the backtransformed values from the</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="co"># link scale table</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>m3_emm_rates <span class="ot">&lt;-</span> m3_emm_response</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>m3_emm_rates[, response <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(m3_emm<span class="sc">$</span>log_rate)]</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>m3_emm_rates[, asymp.LCL <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(m3_emm<span class="sc">$</span>log_rate_lcl)]</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>m3_emm_rates[, asymp.UCL <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>(m3_emm<span class="sc">$</span>log_rate_ucl)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Modeled mean area-normalized counts of TUNEL+ cells, estimated using Negative Binomial GLM.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">response</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Young</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">10.79</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">2.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Old</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">2.20</td>
<td style="text-align: right;">13.52</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">3.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Young</td>
<td style="text-align: left;">KI</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">9.85</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">2.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Old</td>
<td style="text-align: left;">KI</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">5.59</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">1.6</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Notes</p>
<ol type="1">
<li>Again, no ratios were computed. The mean area-normalized counts were computed using the coefficients of the GLM. Here, we used the emmeans package to do this. See section xxx below for code that does this withouth the emmeans package.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3b-rate-plot-show-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Area-normalized counts modeled using Negative Binomial GLM with offset, with the raw count as the response (A) and linear model with the area-normalized count as the response.</figcaption>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>In Panel B, the CIs of the two Young treatment groups have lower bounds that extend below zero. This is absurd – negative area-normalized-count means cannot exist. But this inference is implied by an ANOVA of these data.</li>
<li>Panel A has the potential to lead to misconceptions because the GLM model with offset is not fit to the area-normalized data but to the raw counts. Regardless, the GLM model with offset is modeling the means of these ratios.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="More than I need to know">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
More than I need to know
</div>
</div>
<div class="callout-body-container callout-body">
<p>The modeled means of a count GLM on the link scale are <span class="math inline">\(\mathbf{X} \mathbf{b}\)</span>, where <span class="math inline">\(\mathbf{X}\)</span> is the model matrix and <span class="math inline">\(\mathbf{b}\)</span> is the vector of model coefficients. In a model with an offset, the values of the offset variable are not in the model matrix and the coefficient (1.0) is not in the vector of coefficients. Following the math above, this expectation is the modeled mean normalized-count (on the link scale) and not the modeled mean count conditional on some offset value (on the link scale). Again, following the math above, to compute the expected count conditional on some value of the offset, use <span class="math inline">\(\mathbf{X} \mathbf{b} + \mathrm{log}(offset)\)</span>. But we want the rate not the mean, and we want the rate on the response scale, so simply use <span class="math inline">\(\mathrm{exp}(\mathbf{X} \mathbf{b})\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute rate or normalized count using matrix algebra using</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># final line of equations above</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(fig3b_m3)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fig3b_m3)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>fig3b[, rate <span class="sc">:</span><span class="er">=</span> <span class="fu">exp</span>((X <span class="sc">%*%</span> b)[,<span class="dv">1</span>])]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compare rate to area-normalized count</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>rates <span class="ot">&lt;-</span> fig3b[, .(<span class="at">rate_manual =</span> <span class="fu">mean</span>(rate),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">norm_count =</span> <span class="fu">mean</span>(count_per_area)),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                    by <span class="ot">=</span> .(age, genotype)]</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>m3_emm <span class="ot">&lt;-</span> <span class="fu">merge</span>(m3_emm_rates, rates, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"genotype"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Mean area-normalized-counts computed using the emmeans package ($\texttt{response}$), the matrix algebra code in this section ($\texttt{rate_manual}$), and as the simple average of the normalized counts ($\texttt{norm_count}$)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">genotype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">response</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">df</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.LCL</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">asymp.UCL</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">g_by_age</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rate_manual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">norm_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Young</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">0.9304</td>
<td style="text-align: right;">10.79</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">2.52</td>
<td style="text-align: left;">WT Young</td>
<td style="text-align: right;">0.9304</td>
<td style="text-align: right;">0.9269</td>
</tr>
<tr class="even">
<td style="text-align: left;">Young</td>
<td style="text-align: left;">KI</td>
<td style="text-align: right;">0.8397</td>
<td style="text-align: right;">9.85</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: left;">KI Young</td>
<td style="text-align: right;">0.8397</td>
<td style="text-align: right;">0.8432</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Old</td>
<td style="text-align: left;">WT</td>
<td style="text-align: right;">2.2039</td>
<td style="text-align: right;">13.52</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">3.73</td>
<td style="text-align: left;">WT Old</td>
<td style="text-align: right;">2.2039</td>
<td style="text-align: right;">2.2027</td>
</tr>
<tr class="even">
<td style="text-align: left;">Old</td>
<td style="text-align: left;">KI</td>
<td style="text-align: right;">1.0322</td>
<td style="text-align: right;">5.59</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">1.64</td>
<td style="text-align: left;">KI Old</td>
<td style="text-align: right;">1.0322</td>
<td style="text-align: right;">1.0284</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</div>
</section>
<section id="compare-an-offset-to-an-added-covariate-with-an-estimated-coefficient" class="level3" data-number="17.7.3">
<h3 data-number="17.7.3" class="anchored" data-anchor-id="compare-an-offset-to-an-added-covariate-with-an-estimated-coefficient"><span class="header-section-number">17.7.3</span> Compare an offset to an added covariate with an estimated coefficient</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fig3b_m5 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(positive_nuclei <span class="sc">~</span> age <span class="sc">*</span> genotype <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">log</span>(area_mm2),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> fig3b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Coefficients from model fig3b_m5 (covariate) and model fig3b_m3 (offset).</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;&amp;#124;z&amp;#124;)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2.5 %</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="5">
<td colspan="7" style="border-bottom: 1px solid"><strong>fig3b_m5 (covariate)</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">(Intercept)</td>
<td style="text-align: right;">-3.36</td>
<td style="text-align: right;">1.48</td>
<td style="text-align: right;">-2.27</td>
<td style="text-align: right;">0.0232</td>
<td style="text-align: right;">-6.27</td>
<td style="text-align: right;">-0.33</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ageOld</td>
<td style="text-align: right;">-0.67</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">-0.75</td>
<td style="text-align: right;">0.4528</td>
<td style="text-align: right;">-2.33</td>
<td style="text-align: right;">1.00</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">genotypeKI</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.7299</td>
<td style="text-align: right;">-1.20</td>
<td style="text-align: right;">1.69</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">log(area_mm2)</td>
<td style="text-align: right;">2.48</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">3.89</td>
<td style="text-align: right;">0.0001</td>
<td style="text-align: right;">1.19</td>
<td style="text-align: right;">3.74</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ageOld:genotypeKI</td>
<td style="text-align: right;">-1.16</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">-1.48</td>
<td style="text-align: right;">0.1390</td>
<td style="text-align: right;">-2.81</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd" data-grouplength="4">
<td colspan="7" style="border-bottom: 1px solid"><strong>fig3b_m3 (offset)</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">(Intercept)</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">0.8871</td>
<td style="text-align: right;">-0.95</td>
<td style="text-align: right;">1.09</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ageOld</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">0.1334</td>
<td style="text-align: right;">-0.39</td>
<td style="text-align: right;">1.91</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">genotypeKI</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">0.8871</td>
<td style="text-align: right;">-1.56</td>
<td style="text-align: right;">1.36</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ageOld:genotypeKI</td>
<td style="text-align: right;">-0.66</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">-0.81</td>
<td style="text-align: right;">0.4159</td>
<td style="text-align: right;">-2.27</td>
<td style="text-align: right;">0.96</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The coefficient table for Model fig3b_m5 has a row for the added covariate <span class="math inline">\(\texttt{area\_mm2}\)</span>. This row is absent for Model fig3b_m3 since the coefficient is fixed at 1.0.</li>
<li>The estimate of the coefficient of <span class="math inline">\(\texttt{area\_mm2}\)</span> in Model fig3b_m5 is 2.48. A value of 1.0 – the value assumed by the offset model or an analysis of the ratio – is not very compatible with the data.</li>
<li>A coefficient greater than 1.0 means that the rate of DNA damage (the number of TUNEL positive cells per area) increases with the size of the area measured. Does this make any biological sense? The area measured should not have a biological component unless it is a function of the size of the organ. If the area measured is a function of the size of the organ, then we would want to use the ANCOVA model and not the offset model.</li>
<li>This increase in the rate of TUNEL positive cells is seen in the response-scale plot of the fit model in Figure @ref(fig:glm-fig3b-m5-plot)A, where the slope of the regression line increases as <span class="math inline">\(\texttt{area\_mm2}\)</span> increases.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-fig3b-m5-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li>Note that on the log scale (Figure @ref(fig:glm-fig3b-m5-plot)B), the two regression lines are parallel, as they must be in an ANCOVA linear model.</li>
</ol>
</section>
<section id="issues-with-plotting" class="level3" data-number="17.7.4">
<h3 data-number="17.7.4" class="anchored" data-anchor-id="issues-with-plotting"><span class="header-section-number">17.7.4</span> Issues with plotting</h3>
</section>
</section>
<section id="example-3glm-models-for-proportions-percent-of-a-total" class="level2" data-number="17.8">
<h2 data-number="17.8" class="anchored" data-anchor-id="example-3glm-models-for-proportions-percent-of-a-total"><span class="header-section-number">17.8</span> Example 3–GLM models for proportions (percent of a total)</h2>
<section id="sec-glm-proportion" class="level3" data-number="17.8.1">
<h3 data-number="17.8.1" class="anchored" data-anchor-id="sec-glm-proportion"><span class="header-section-number">17.8.1</span> Instead of a <em>t</em>-test or Mann-Whitney test of a proportion (e.g.&nbsp;percent of cells expressing a specific marker), fit a GLM Quasibinomial model to gain power (sox21 Fig. 5d)</h3>
<p>Source article: <a href="https://elifesciences.org/articles/57325" target="_blank">Evelien Eenjes Marjon Buscop-van Kempen Anne Boerema-de Munck Gabriela G Edel Floor Benthem Lisette de Kreij-de Bruin Marco Schnater Dick Tibboel Jennifer Collins Robbert J Rottier (2021) SOX21 modulates SOX2-initiated differentiation of epithelial cells in the extrapulmonary airways eLife 10:e57325.</a></p>
<p>Source Figure: 5d</p>
<p>About the data:</p>
<p>Researcher’s results: “At 20 DPI, fewer FOXJ1+ ciliated cells, but more dividing and non-dividing basal cells were observed in Sox2+/− TE compared to WT, Sox21+/−, or to Sox2+/− CO exposed mice”</p>
<p>Researcher’s methods: One-way ANOVA</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...9`
• `` -&gt; `...10`
• `` -&gt; `...18`</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>glm1.qb <span class="ot">&lt;-</span> <span class="fu">glm</span>(foxj1_prop <span class="sc">~</span> genotype,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> quasibinomial,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> dapi,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> fig5d)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>glm1.qb_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(glm1.qb, <span class="at">specs =</span> <span class="st">"genotype"</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>glm1.qb_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(glm1.qb_emm,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>glm1.qb_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast         odds.ratio     SE  df asymp.LCL asymp.UCL null z.ratio
 Sox2KO / WT           0.553 0.0942 Inf     0.396     0.772    1  -3.478
 Sox21KO / WT          1.315 0.2060 Inf     0.968     1.787    1   1.752
 Sox21KO / Sox2KO      2.380 0.4110 Inf     1.697     3.339    1   5.022
 p.value
  0.0005
  0.0798
  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log odds ratio scale 
Tests are performed on the log odds ratio scale </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggptm</span>(glm1.qb, glm1.qb_emm, glm1.qb_pairs,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">palette =</span> pal_okabe_ito,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">ci_bar_color =</span> <span class="st">"black"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">rescale =</span> <span class="st">"percent"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_label =</span> <span class="st">"% Foxj1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-glm1-qb-ptm-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The family is quasibinomial. A binomial response is 0 or 1 (survived/died, or success/fail) but these data are proprotions and not binomial responses. Here’s how to think about this with proportion data. Within a sample, if 18% are cells express a specific marker, then there are 18 successess (and 82 failures) for every 100 cells sampled.</li>
<li>The weights argument in the function takes the total number of cells counted.</li>
<li>The effect is an odds ratio. The probability of a cell being FOXJ1+ in the Sox2KO group is .553 times (about half) that of a FOXJ1+ cell in the WT group.</li>
</ol>
</section>
<section id="statistical-issues-with-proportions-for-a-linear-model" class="level3" data-number="17.8.2">
<h3 data-number="17.8.2" class="anchored" data-anchor-id="statistical-issues-with-proportions-for-a-linear-model"><span class="header-section-number">17.8.2</span> Statistical issues with proportions for a linear model</h3>
<p>Any variable that is a proportion has a hard lower (zero) and upper (one) bound (or 0% and 100% if using percents). Some consequences of this are</p>
<ol type="1">
<li>If the mean proportion is closer to zero, the distribution of values will often be right skewed. If the mean proportion is closer to one, the distribution of values will often be left skewed.</li>
<li>The variance willy typically increase with the mean for proportions &lt; 0.5 but decrease for proportions &gt; 0.5.</li>
</ol>
</section>
<section id="alternative-models-for-proportion-data" class="level3" data-number="17.8.3">
<h3 data-number="17.8.3" class="anchored" data-anchor-id="alternative-models-for-proportion-data"><span class="header-section-number">17.8.3</span> Alternative models for proportion data</h3>
<section id="the-glm-binomial-model-is-the-standard-but-has-less-power-than-quasibinomial" class="level4" data-number="17.8.3.1">
<h4 data-number="17.8.3.1" class="anchored" data-anchor-id="the-glm-binomial-model-is-the-standard-but-has-less-power-than-quasibinomial"><span class="header-section-number">17.8.3.1</span> The GLM binomial model is the standard, but has less power than quasibinomial</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>glm2.logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(foxj1_prop <span class="sc">~</span> genotype,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> dapi,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> fig5d)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>glm2.logit_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(glm2.logit,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">specs =</span> <span class="st">"genotype"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">vcov. =</span> <span class="fu">vcovHC</span>(glm2.logit, <span class="at">type=</span><span class="st">"HC3"</span>),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>glm2.logit_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(glm2.logit_emm,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>glm2.logit_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast         odds.ratio    SE  df asymp.LCL asymp.UCL null z.ratio p.value
 Sox2KO / WT           0.553 0.105 Inf     0.381     0.801    1  -3.127  0.0018
 Sox21KO / WT          1.315 0.231 Inf     0.932     1.856    1   1.559  0.1191
 Sox21KO / Sox2KO      2.380 0.461 Inf     1.628     3.480    1   4.475  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log odds ratio scale 
Tests are performed on the log odds ratio scale </code></pre>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>The <code>vcov. = vcovHC(glm2.logit, type="HC3")</code> argument is passed to the emmeans function to use robust (“sandwich”) estimates of the covariance matrix. Without this, the binomial GLM has very high Type I error. The <code>vcovHC</code> function is in the sandwich package.</li>
<li>In my simulations, the quasibinomial has non-trivially higher power than the binomial.</li>
</ol>
</section>
<section id="the-glm-quasibinomial-model-works-if-you-have-only-the-proportion-and-not-the-total-count" class="level4" data-number="17.8.3.2">
<h4 data-number="17.8.3.2" class="anchored" data-anchor-id="the-glm-quasibinomial-model-works-if-you-have-only-the-proportion-and-not-the-total-count"><span class="header-section-number">17.8.3.2</span> The GLM quasibinomial model works if you have only the proportion and not the total count</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>glm3.qb <span class="ot">&lt;-</span> <span class="fu">glm</span>(foxj1_prop <span class="sc">~</span> genotype,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> quasibinomial,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#         weights = dapi,</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> fig5d)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>glm3.qb_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(glm3.qb, <span class="at">specs =</span> <span class="st">"genotype"</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>glm3.qb_pairs <span class="ot">&lt;-</span> <span class="fu">contrast</span>(glm3.qb_emm,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">adjust =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>glm3.qb_pairs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast         odds.ratio     SE  df asymp.LCL asymp.UCL null z.ratio
 Sox2KO / WT           0.568 0.0956 Inf     0.408      0.79    1  -3.363
 Sox21KO / WT          1.304 0.1980 Inf     0.968      1.76    1   1.747
 Sox21KO / Sox2KO      2.297 0.3870 Inf     1.650      3.20    1   4.930
 p.value
  0.0008
  0.0807
  &lt;.0001

Confidence level used: 0.95 
Intervals are back-transformed from the log odds ratio scale 
Tests are performed on the log odds ratio scale </code></pre>
</div>
</div>
<p>Notes</p>
<ol type="1">
<li>Why would you have only the proportion?</li>
<li>The results are only slightly different from the model with the total counts used as weights</li>
<li>In simulations, the model with weights has non-trivially higher power</li>
<li>Researchers almost always archive only the proportions and not the raw counts and total counts. Don’t do this. Archive all data!</li>
</ol>
</section>
</section>
</section>
<section id="example-4-glm-models-for-continuous-responses" class="level2" data-number="17.9">
<h2 data-number="17.9" class="anchored" data-anchor-id="example-4-glm-models-for-continuous-responses"><span class="header-section-number">17.9</span> Example 4 – GLM models for continuous responses</h2>
</section>
<section id="example-5-glm-models-for-binary-responses" class="level2" data-number="17.10">
<h2 data-number="17.10" class="anchored" data-anchor-id="example-5-glm-models-for-binary-responses"><span class="header-section-number">17.10</span> Example 5 – GLM models for binary responses</h2>
</section>
<section id="working-in-r" class="level2" data-number="17.11">
<h2 data-number="17.11" class="anchored" data-anchor-id="working-in-r"><span class="header-section-number">17.11</span> Working in R</h2>
<section id="fitting-glms-to-count-data" class="level3" data-number="17.11.1">
<h3 data-number="17.11.1" class="anchored" data-anchor-id="fitting-glms-to-count-data"><span class="header-section-number">17.11.1</span> Fitting GLMs to count data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># poisson - less likely to fit to real biological data well </span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># because of overdispersion</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> treatment, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> dt)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatives to overdispersed poisson fit</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. quasipoisson using Base R</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> treatment, <span class="at">family =</span> <span class="fu">quasipoisson</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> dt)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. nbinom1 from glmmTMB package models the variance like quasipoisson. The result differs from Base R quasipoisson</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> treatment, <span class="at">family =</span> <span class="fu">nbinom1</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> dt)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. negative binomial using nbinom2 from glmmTMB package. Equivalent to glm.nb from MASS</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> treatment, <span class="at">family =</span> <span class="fu">nbinom1</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> dt)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. negative binomial using glm.nb from MASS package. Equivalent to nbinom2 from glmmTMB</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> treatment, <span class="at">data =</span> dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-a-glm-to-a-continuous-conditional-response-with-right-skew." class="level3" data-number="17.11.2">
<h3 data-number="17.11.2" class="anchored" data-anchor-id="fitting-a-glm-to-a-continuous-conditional-response-with-right-skew."><span class="header-section-number">17.11.2</span> Fitting a GLM to a continuous conditional response with right skew.</h3>
<p>The Gamma family is specified with the base R <code>glm()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> treatment, <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-a-glm-to-a-binary-success-or-failure-presence-or-absence-survived-or-died-response" class="level3" data-number="17.11.3">
<h3 data-number="17.11.3" class="anchored" data-anchor-id="fitting-a-glm-to-a-binary-success-or-failure-presence-or-absence-survived-or-died-response"><span class="header-section-number">17.11.3</span> Fitting a GLM to a binary (success or failure, presence or absence, survived or died) response</h3>
<p>The binomial family is specified with base R <code>glm()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if the data includes a 0 or 1 for every observation of y</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> treatment, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fitting-generalized-linear-mixed-models" class="level3" data-number="17.11.4">
<h3 data-number="17.11.4" class="anchored" data-anchor-id="fitting-generalized-linear-mixed-models"><span class="header-section-number">17.11.4</span> Fitting Generalized Linear Mixed Models</h3>
<p>Generalized linear mixed models are fit with <code>glmer</code> from the lmer package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random intercept of factor "id"</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y <span class="sc">~</span> treatment <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>id), <span class="at">family =</span> <span class="st">"poisson"</span>, <span class="at">data =</span> dt)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># random intercept and slope of factor "id"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y <span class="sc">~</span> treatment <span class="sc">+</span> (treatment<span class="sc">|</span>id), <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> dt)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, Negative Binomial uses a special function</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmer.nb</span>(y <span class="sc">~</span> treatment <span class="sc">+</span> (treatment<span class="sc">|</span>id), <span class="at">data =</span> dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another good package for GLMMs is <code>glmmTMB</code> from the glmmTMB package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative Binomial</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> treatment <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>id), <span class="at">family=</span><span class="st">"nbinom2"</span>, <span class="at">data =</span> dt)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># nbinom1, the mean variance relationship is that of quasipoisson</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> treatment <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>id), <span class="at">family=</span><span class="st">"nbinom1"</span>, <span class="at">data =</span> dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-checking-glms" class="level2" data-number="17.12">
<h2 data-number="17.12" class="anchored" data-anchor-id="model-checking-glms"><span class="header-section-number">17.12</span> Model checking GLMs</h2>
<section id="use-dharmasimulateresiduals-to-check-glm-models-using-uniform-residuals" class="level3" data-number="17.12.1">
<h3 data-number="17.12.1" class="anchored" data-anchor-id="use-dharmasimulateresiduals-to-check-glm-models-using-uniform-residuals"><span class="header-section-number">17.12.1</span> Use DHARMa::simulateResiduals to check GLM models using uniform residuals</h3>
<p>The <code>DHARMa</code> package has an excellent set of model checking tools. The DHARMa package uses simulation to generate fake data sampled from the fit model using the function <code>simulateResiduals</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fig3a_nb1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">nbinom1</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>fig3a_nb1_check <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(fig3a_nb1, <span class="at">n_sim =</span> <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fig3a_nb1_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/glm-dharma-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Three test statistics are superimposed. Use these <em>p</em>-values cautiously – they are guides and not thresholds of demarcation. The two we care about here are * The KS statistic indicates that the quantile residuals are not very compatible with a Poisson model – think of this as having a very low probability of sampling these counts from a Poisson with the estimated <span class="math inline">\(\lambda\)</span>. * The dispersion statistic indicates that the value of the dispersion of the quantile residuals is not very compatible with a Poisson model – think of this as having a very low probability of sampling counts with this dispersion from a Poisson with the estimated <span class="math inline">\(\lambda\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(fig3a_nb1_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 1.284, p-value = 0.28
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(fig3a_nb1_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 1.0356, p-value = 1
alternative hypothesis: two.sided</code></pre>
</div>
</div>
</section>
<section id="use-ggcheck_the_glm-to-check-the-quasipoisson-model" class="level3" data-number="17.12.2">
<h3 data-number="17.12.2" class="anchored" data-anchor-id="use-ggcheck_the_glm-to-check-the-quasipoisson-model"><span class="header-section-number">17.12.2</span> Use ggcheck_the_glm to check the quasipoisson model</h3>
<p>Here, I use <code>ggcheck_the_glm</code> which uses DHARMa underneath the hood. DHARMa does not simulate Quasipoisson model fits, but I have included these in <code>ggcheck_the_glm</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp <span class="ot">&lt;-</span> <span class="fu">glm</span>(sprouts <span class="sc">~</span> treatment <span class="sc">*</span> genotype,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">quasipoisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> fig3a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>fig3a_qp_check <span class="ot">&lt;-</span> <span class="fu">ggcheck_the_glm</span>(fig3a_qp, <span class="at">n_sim =</span> <span class="dv">500</span>) <span class="co"># 250 fake data sets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fig3a_qp_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(fig3a_qp_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="glm_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 1.233, p-value = 0.388
alternative hypothesis: two.sided</code></pre>
</div>
</div>
</section>
</section>
<section id="hidden-code" class="level2" data-number="17.13">
<h2 data-number="17.13" class="anchored" data-anchor-id="hidden-code"><span class="header-section-number">17.13</span> Hidden code</h2>
<section id="import-example-1-data-fig3a-angiogenic-sprouts" class="level3" data-number="17.13.1">
<h3 data-number="17.13.1" class="anchored" data-anchor-id="import-example-1-data-fig3a-angiogenic-sprouts"><span class="header-section-number">17.13.1</span> Import Example 1 data (fig3a – “angiogenic sprouts”)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Pericyte FAK negatively regulates Gas6-Axl signalling to suppress tumour angiogenesis and tumour growth"</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41467_2020_16618_MOESM3_ESM.xlsx"</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>fig3a_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="st">"Figure 3"</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">range =</span> <span class="st">"B4:E26"</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>input_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PBS FAK_wt"</span>, <span class="st">"PBS FAK_ko"</span>, <span class="st">"GAS6 FAK_wt"</span>, <span class="st">"GAS6 FAK_ko"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fig3a_wide) <span class="ot">&lt;-</span> input_labels</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>fig3a <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig3a_wide,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">measure.vars =</span> input_labels,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable.name =</span> <span class="st">"group"</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">value.name =</span> <span class="st">"sprouts"</span>) <span class="sc">|&gt;</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co"># change order of factor levels</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>group_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PBS FAK_wt"</span>, <span class="st">"GAS6 FAK_wt"</span>, <span class="st">"PBS FAK_ko"</span>, <span class="st">"GAS6 FAK_ko"</span>)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>fig3a[, <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"genotype"</span>)<span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(group,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">" "</span>,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">fixed =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>fig3a[, group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(group, <span class="at">levels =</span> group_levels)]</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>treatment_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PBS"</span>, <span class="st">"GAS6"</span>)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>fig3a[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(treatment, <span class="at">levels =</span> treatment_levels)]</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>genotype_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FAK_wt"</span>, <span class="st">"FAK_ko"</span>)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>fig3a[, genotype <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(genotype, <span class="at">levels =</span> genotype_levels)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>the variance is less than that expected by the probability model<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>the variance is greater than that expected by the probability model<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/middleprofessor\.github\.io\/benchbiostats\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/lmm.html" class="pagination-link" aria-label="Models for non-independence -- linear mixed models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Models for non-independence – linear mixed models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/longitudinal.html" class="pagination-link" aria-label="Linear models for longitudinal experiments">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Linear models for longitudinal experiments</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>