<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; Linear models with a single, continuous X (“linear regression”) – Statistics for the Experimental Bench Biologist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/one-factor.html" rel="next">
<link href="../chapters/intro-stat-modeling.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/continuous_x.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear models with a single, continuous <em>X</em> (“linear regression”)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistics for the Experimental Bench Biologist</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Front Matter</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Analyzing experimental data with a linear model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started – R Projects and R Markdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/reading-writing-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data – Reading, Wrangling, and Writing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/plotting-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/uncertainty-sd-and-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Variability and Uncertainty (Standard Deviations, Standard Errors, and Confidence Intervals)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/p-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">P-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Errors in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro-stat-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">An introduction to linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/continuous_x.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear models with a single, continuous <em>X</em> (“linear regression”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/one-factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear models with a single, categorical <em>X</em> (“t-tests” and “ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/model-checking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Model checking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/multiple-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple tests – why and when to adjust <em>p</em>-values</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/inference-issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Issues in inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/two-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models with two categorical <span class="math inline">\(X\)</span> – Factorial linear models (“two-way ANOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Linear models with added covariates (“ANCOVA”)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/lmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Models for non-independence – linear mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Models for counts, binary responses, skewed responses, and proportions – Generalized Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Linear models for longitudinal experiments</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#stats-101-what-is-classical-linear-regression" id="toc-stats-101-what-is-classical-linear-regression" class="nav-link active" data-scroll-target="#stats-101-what-is-classical-linear-regression"><span class="header-section-number">9.1</span> Stats 101 What is classical linear regression?</a></li>
  <li><a href="#a-linear-model-with-a-single-continuous-x-is-classical-regression" id="toc-a-linear-model-with-a-single-continuous-x-is-classical-regression" class="nav-link" data-scroll-target="#a-linear-model-with-a-single-continuous-x-is-classical-regression"><span class="header-section-number">9.2</span> A linear model with a single, continuous <em>X</em> is classical “regression”</a>
  <ul>
  <li><a href="#analysis-of-green-down-data" id="toc-analysis-of-green-down-data" class="nav-link" data-scroll-target="#analysis-of-green-down-data"><span class="header-section-number">9.2.1</span> Analysis of “green-down” data</a></li>
  <li><a href="#learning-from-the-green-down-example" id="toc-learning-from-the-green-down-example" class="nav-link" data-scroll-target="#learning-from-the-green-down-example"><span class="header-section-number">9.2.2</span> Learning from the green-down example</a></li>
  <li><a href="#using-a-regression-model-for-explanation-causal-models" id="toc-using-a-regression-model-for-explanation-causal-models" class="nav-link" data-scroll-target="#using-a-regression-model-for-explanation-causal-models"><span class="header-section-number">9.2.3</span> Using a regression model for “explanation” – causal models</a>
  <ul class="collapse">
  <li><a href="#what-a-regression-coefficient-means" id="toc-what-a-regression-coefficient-means" class="nav-link" data-scroll-target="#what-a-regression-coefficient-means"><span class="header-section-number">9.2.3.1</span> What a regression coefficient means</a></li>
  <li><a href="#causal-interpretation-conditional-on-doing-x-x" id="toc-causal-interpretation-conditional-on-doing-x-x" class="nav-link" data-scroll-target="#causal-interpretation-conditional-on-doing-x-x"><span class="header-section-number">9.2.3.2</span> Causal interpretation – conditional on “doing” X = x</a></li>
  <li><a href="#observational-interpretation-conditional-on-seeing-x-x." id="toc-observational-interpretation-conditional-on-seeing-x-x." class="nav-link" data-scroll-target="#observational-interpretation-conditional-on-seeing-x-x."><span class="header-section-number">9.2.3.3</span> Observational interpretation – conditional on “seeing” X = x.</a></li>
  <li><a href="#omitted-variable-bias" id="toc-omitted-variable-bias" class="nav-link" data-scroll-target="#omitted-variable-bias"><span class="header-section-number">9.2.3.4</span> Omitted variable bias</a></li>
  <li><a href="#causal-modeling-with-experimental-versus-observational-data" id="toc-causal-modeling-with-experimental-versus-observational-data" class="nav-link" data-scroll-target="#causal-modeling-with-experimental-versus-observational-data"><span class="header-section-number">9.2.3.5</span> Causal modeling with experimental versus observational data</a></li>
  </ul></li>
  <li><a href="#using-a-regression-model-for-prediction-prediction-models" id="toc-using-a-regression-model-for-prediction-prediction-models" class="nav-link" data-scroll-target="#using-a-regression-model-for-prediction-prediction-models"><span class="header-section-number">9.2.4</span> Using a regression model for prediction – prediction models</a>
  <ul class="collapse">
  <li><a href="#ci-and-p-value" id="toc-ci-and-p-value" class="nav-link" data-scroll-target="#ci-and-p-value"><span class="header-section-number">9.2.4.1</span> 95% CI and <em>p</em>-value</a></li>
  <li><a href="#prediction-interval-and-r2" id="toc-prediction-interval-and-r2" class="nav-link" data-scroll-target="#prediction-interval-and-r2"><span class="header-section-number">9.2.4.2</span> 95% prediction interval and <span class="math inline">\(R^2\)</span></a></li>
  <li><a href="#r2" id="toc-r2" class="nav-link" data-scroll-target="#r2"><span class="header-section-number">9.2.4.3</span> <span class="math inline">\(R^2\)</span></a></li>
  <li><a href="#prediction-interval" id="toc-prediction-interval" class="nav-link" data-scroll-target="#prediction-interval"><span class="header-section-number">9.2.4.4</span> Prediction interval</a></li>
  <li><a href="#median-absolute-error-and-root-mean-square-error-are-absolute-measures-of-predictability" id="toc-median-absolute-error-and-root-mean-square-error-are-absolute-measures-of-predictability" class="nav-link" data-scroll-target="#median-absolute-error-and-root-mean-square-error-are-absolute-measures-of-predictability"><span class="header-section-number">9.2.4.5</span> Median Absolute Error and Root Mean Square Error are absolute measures of predictability</a></li>
  <li><a href="#prediction-modeling-is-more-sophisticated-than-presented-here" id="toc-prediction-modeling-is-more-sophisticated-than-presented-here" class="nav-link" data-scroll-target="#prediction-modeling-is-more-sophisticated-than-presented-here"><span class="header-section-number">9.2.4.6</span> Prediction modeling is more sophisticated than presented here</a></li>
  </ul></li>
  <li><a href="#using-a-regression-model-for-creating-a-new-response-variable-comparing-slopes-of-longitudinal-data" id="toc-using-a-regression-model-for-creating-a-new-response-variable-comparing-slopes-of-longitudinal-data" class="nav-link" data-scroll-target="#using-a-regression-model-for-creating-a-new-response-variable-comparing-slopes-of-longitudinal-data"><span class="header-section-number">9.2.5</span> Using a regression model for creating a new response variable – comparing slopes of longitudinal data</a></li>
  <li><a href="#using-a-regression-model-for-for-calibration" id="toc-using-a-regression-model-for-for-calibration" class="nav-link" data-scroll-target="#using-a-regression-model-for-for-calibration"><span class="header-section-number">9.2.6</span> Using a regression model for for calibration</a></li>
  </ul></li>
  <li><a href="#working-in-r" id="toc-working-in-r" class="nav-link" data-scroll-target="#working-in-r"><span class="header-section-number">9.3</span> Working in R</a>
  <ul>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model"><span class="header-section-number">9.3.1</span> Fitting the linear model</a></li>
  <li><a href="#getting-to-know-the-linear-model-the-summary-function" id="toc-getting-to-know-the-linear-model-the-summary-function" class="nav-link" data-scroll-target="#getting-to-know-the-linear-model-the-summary-function"><span class="header-section-number">9.3.2</span> Getting to know the linear model: the <code>summary</code> function</a></li>
  <li><a href="#inference-the-coefficient-table" id="toc-inference-the-coefficient-table" class="nav-link" data-scroll-target="#inference-the-coefficient-table"><span class="header-section-number">9.3.3</span> Inference – the coefficient table</a></li>
  <li><a href="#how-good-is-our-model-model-checking" id="toc-how-good-is-our-model-model-checking" class="nav-link" data-scroll-target="#how-good-is-our-model-model-checking"><span class="header-section-number">9.3.4</span> How good is our model? – Model checking</a></li>
  <li><a href="#plotting-models-with-continuous-x" id="toc-plotting-models-with-continuous-x" class="nav-link" data-scroll-target="#plotting-models-with-continuous-x"><span class="header-section-number">9.3.5</span> Plotting models with continuous <em>X</em></a>
  <ul class="collapse">
  <li><a href="#quick-plot" id="toc-quick-plot" class="nav-link" data-scroll-target="#quick-plot"><span class="header-section-number">9.3.5.1</span> Quick plot</a></li>
  <li><a href="#ggpubr-plots" id="toc-ggpubr-plots" class="nav-link" data-scroll-target="#ggpubr-plots"><span class="header-section-number">9.3.5.2</span> ggpubr plots</a></li>
  <li><a href="#ggplots" id="toc-ggplots" class="nav-link" data-scroll-target="#ggplots"><span class="header-section-number">9.3.5.3</span> ggplots</a></li>
  </ul></li>
  <li><a href="#creating-a-table-of-predicted-values-and-95-prediction-intervals" id="toc-creating-a-table-of-predicted-values-and-95-prediction-intervals" class="nav-link" data-scroll-target="#creating-a-table-of-predicted-values-and-95-prediction-intervals"><span class="header-section-number">9.3.6</span> Creating a table of predicted values and 95% prediction intervals</a></li>
  </ul></li>
  <li><a href="#hidden-code" id="toc-hidden-code" class="nav-link" data-scroll-target="#hidden-code"><span class="header-section-number">9.4</span> Hidden code</a>
  <ul>
  <li><a href="#import-and-plot-of-fig2c-ecosystem-warming-experimental-data" id="toc-import-and-plot-of-fig2c-ecosystem-warming-experimental-data" class="nav-link" data-scroll-target="#import-and-plot-of-fig2c-ecosystem-warming-experimental-data"><span class="header-section-number">9.4.1</span> Import and plot of fig2c (ecosystem warming experimental) data</a></li>
  <li><a href="#import-and-plot-efig_3d-ecosysem-warming-observational-data" id="toc-import-and-plot-efig_3d-ecosysem-warming-observational-data" class="nav-link" data-scroll-target="#import-and-plot-efig_3d-ecosysem-warming-observational-data"><span class="header-section-number">9.4.2</span> Import and plot efig_3d (Ecosysem warming observational) data</a></li>
  <li><a href="#import-and-plot-of-fig1f-methionine-restriction-data" id="toc-import-and-plot-of-fig1f-methionine-restriction-data" class="nav-link" data-scroll-target="#import-and-plot-of-fig1f-methionine-restriction-data"><span class="header-section-number">9.4.3</span> Import and plot of fig1f (methionine restriction) data</a></li>
  </ul></li>
  <li><a href="#try-it" id="toc-try-it" class="nav-link" data-scroll-target="#try-it"><span class="header-section-number">9.5</span> Try it</a>
  <ul>
  <li><a href="#a-prediction-model-from-the-literature" id="toc-a-prediction-model-from-the-literature" class="nav-link" data-scroll-target="#a-prediction-model-from-the-literature"><span class="header-section-number">9.5.1</span> A prediction model from the literature</a></li>
  </ul></li>
  <li><a href="#intuition-pumps" id="toc-intuition-pumps" class="nav-link" data-scroll-target="#intuition-pumps"><span class="header-section-number">9.6</span> Intuition pumps</a>
  <ul>
  <li><a href="#correlation-and-r2" id="toc-correlation-and-r2" class="nav-link" data-scroll-target="#correlation-and-r2"><span class="header-section-number">9.6.1</span> Correlation and $R^2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="regression" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear models with a single, continuous <em>X</em> (“linear regression”)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'data.table' was built under R version 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'car' was built under R version 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'knitr' was built under R version 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'insight' was built under R version 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'Matrix' was built under R version 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'emmeans' was built under R version 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'DHARMa' was built under R version 4.4.1</code></pre>
</div>
</div>
<section id="stats-101-what-is-classical-linear-regression" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="stats-101-what-is-classical-linear-regression"><span class="header-section-number">9.1</span> Stats 101 What is classical linear regression?</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/regression-101-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The figure above is a <strong>scatterplot</strong> of the values of relative hepatic slc16a13 (a membrane transporter protein) expression against Hepatic TAG (triacylglycerol) from a sample of 38 humans. The plot shows a trend: humans with higher levels of TAG tend to have higher slc16a13 expression levels and humans with low levels of TAG tend to have lower slc16a13 expression levels. “Trend” and “Tend to” means the relationship isn’t perfect, that there are exceptions. <strong>Classical linear regression</strong> is a method for measuring this trend. The line through the scatter of points is the linear regression model fit to the data, or simply the “regression line”. It is the line of expected values of <span class="math inline">\(Y\)</span> (slc16a13) given a specific value of <span class="math inline">\(X\)</span> (TAG). The slope of the model is the magnitude of the trend.</p>
<p>A <strong>correlation</strong> is a measure of the closeness of the scatter of points to the line and ranges between -1 and 1. If the trend is positive (a regression line that slopes up when moving to the right), the correlation is positive. If the trend is negative (a regression line that slopes down when moving to the right), the correlation is negative. If there is no slope, the correlation is zero. The direction and magnitude of a correlation is denoted by <span class="math inline">\(r\)</span>.</p>
<p>The <strong>p-value</strong> in the plot is the probability of randomly sampling 38 pairs of numbers with a slope and correlation as high or higher than the observed slope and correlation, if the true slope and correlation in the sampled population are zero.</p>
<p>In most uses of classical linear regression that I see in the experimental bench biology literature, the researchers don’t care about the magnitude of the slope – they simply want to test if two variables are associated (a non-zero slope and correlation) because an association suggests some causal link between the two. And that’s the goal of experimental bench biology, to sleuth out the details of causal links between measured sets of variables.</p>
</section>
<section id="a-linear-model-with-a-single-continuous-x-is-classical-regression" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="a-linear-model-with-a-single-continuous-x-is-classical-regression"><span class="header-section-number">9.2</span> A linear model with a single, continuous <em>X</em> is classical “regression”</h2>
<section id="analysis-of-green-down-data" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="analysis-of-green-down-data"><span class="header-section-number">9.2.1</span> Analysis of “green-down” data</h3>
<p>To introduce some principles of modeling with a single continuous <span class="math inline">\(X\)</span> variable, I’ll use a dataset from</p>
<p><a href="https://doi.org/10.1038/s41586-018-0399-1" target="_blank">Richardson, A.D., Hufkens, K., Milliman, T. et al.&nbsp;Ecosystem warming extends vegetation activity but heightens vulnerability to cold temperatures. Nature 560, 368–371 (2018).</a></p>
<p>which has nothing to do with experimental bench biology using mouse models but does have a really really nice dataset for understanding classical linear regression.</p>
<p><a href="https://www.nature.com/articles/s41586-018-0399-1#Sec15" target="_blank">Source data</a></p>
<p>The data are from a <a href="https://mnspruce.ornl.gov" target="_blank">long-term experiment on the effects of warming and CO2 on a high-carbon northern temperate peatland</a> and is the focal dataset of the study. The experiment involves 10 large, temperature and CO2 controlled enclosures. CO2 is set to 400 ppm in five enclosures and 900 ppm in five enclosures. Temperature of the five enclosures within each CO2 level is set to 0, 2.25, 4.5, 6.75, or 9 °C above ambient temperature. The multiple temperature levels is a <strong>regression design</strong>, which allows a researcher to measure non-linear effects. Read more about the experimental design and the <a href="https://mnspruce.ornl.gov/design" target="_blank">beautiful implementation</a>.</p>
<p>The question pursued is in this study is, what is the causal effect of warming on the timing (or phenology) of the transition into photosynthetic activity (“green-up”) in the spring and of the transition out of photosynthetic activity (“green-down”) in the fall? The researchers measured these transition dates, or Day of Year (DOY), using foliage color. Here, we focus on the transition out of photosynthesis or “green-down” DOY.</p>
<p><strong>Import the data</strong></p>
<ol type="1">
<li><strong>Examine the data</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">qplot</span>(<span class="at">x =</span> temperature,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> transition_date,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> fig2c) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `qplot()` was deprecated in ggplot2 3.4.0.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">qplot</span>(<span class="at">x =</span> temperature,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> transition_date,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> fig2c) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>gg3 <span class="ot">&lt;-</span> <span class="fu">qplot</span>(<span class="at">x =</span> temperature,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> transition_date,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> fig2c) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(gg1, gg2, gg3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-vet-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No plot shows any obvious outlier that might be due to measurement blunders or curation error. The linear regression in the left-most plot clearly shows that a linear response is sufficient to capture the effect of temperature on day of green-down.</p>
<ol start="2" type="1">
<li><p><strong>choose a model</strong>. Because the <span class="math inline">\(X\)</span> variable (<span class="math inline">\(temperature\)</span>) was experimentally set to five levels, the data could reasonably be modeled using either a linear model with a categorical <span class="math inline">\(X\)</span> or a linear model with a continuous <span class="math inline">\(X\)</span>. The advantage of modeling <span class="math inline">\(temperature\)</span> as a continuous variable is that there is only one effect, the slope of the regression line. If modeled as a categorical factor with five levels, there are, at a minimum, four interesting effects (the difference in means between each non-reference level and reference (temperature = 0) level). Also, for inference, modeling <span class="math inline">\(temperature\)</span> as a continuous variable increases power for hypothesis tests.</p></li>
<li><p><strong>fit the model</strong></p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: fit the model</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(transition_date <span class="sc">~</span> temperature, <span class="at">data =</span> fig2c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li><strong>check the model</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check normality assumption</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(m1, <span class="at">id=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-check-qq-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Q-Q plot indicates the distribution of residuals is well within that expected for a normal sample and there is no cause for concern with inference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check homogeneity assumption</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">spreadLevelPlot</span>(m1, <span class="at">id=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-check-spread-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Suggested power transformation:  0.6721303 </code></pre>
</div>
</div>
<p>The spread-location plot shows no conspicuous trend in how the spread changes with the conditonal mean. There is no cause for concern with inference.</p>
<ol start="5" type="1">
<li><strong>inference from the model</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>m1_coeff <span class="ot">&lt;-</span> <span class="fu">summary</span>(m1) <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>m1_confint <span class="ot">&lt;-</span> <span class="fu">confint</span>(m1)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>m1_coeff <span class="ot">&lt;-</span> <span class="fu">cbind</span>(m1_coeff, m1_confint)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>m1_coeff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error   t value     Pr(&gt;|t|)      2.5 %     97.5 %
(Intercept) 289.458750  3.0593949 94.613071 1.738650e-13 282.403773 296.513728
temperature   4.982745  0.5541962  8.990941 1.866888e-05   3.704767   6.260724</code></pre>
</div>
</div>
<p>The effect of added temperature on the day of green-down is 4.98 d per 1 °C (95% CI: 3.7, 6.3; p &lt; 0.001).</p>
<ol start="6" type="1">
<li><strong>plot the model</strong></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Modification of the published Figure 2c showing the experimental effect of warming on the date of autumn green-down (the transition to fall foliage color) in a mixed shrub community. The bottom panel is a scatterplot. The regression line shows the expected value of Y (transition day of year) given a value of X (added temperature). The slope of the regression line is the estimate of the effect. The estimate and 95% confidence interval of the estimate are given in the top panel.</figcaption>
</figure>
</div>
</div>
</div>
<ol start="7" type="1">
<li>Report the results</li>
</ol>
<p>The modeled effect of added temperature is Slope: 4.98 (3.7, 6.26) d per 1 °C (@ref(fig:continuous-x-plot)).</p>
</section>
<section id="learning-from-the-green-down-example" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="learning-from-the-green-down-example"><span class="header-section-number">9.2.2</span> Learning from the green-down example</h3>
<p>Figure @ref(fig:continuous-x-plot) is a <strong>scatterplot</strong> with the green-down DOY for the mixed-shrub community on the <span class="math inline">\(Y\)</span> axis and added temperature on the <span class="math inline">\(X\)</span> axis. The line through the data is a regression line, which is the expected value of <em>Y</em> (green-down DOY) given a specific value of <em>X</em> (added temperature). The slope of the line is the <strong>effect</strong> of added temperature on timing of green-down. The intercept of the regression line is the value of the response (day of green-down) when <span class="math inline">\(X\)</span> is equal to zero. Very often, this value is not of interest although the value should be reported to allow predictions from the model. Also very often, the value of the intercept is not meaningful because a value of <span class="math inline">\(X = 0\)</span> is far outside the range of measured <span class="math inline">\(X\)</span>, or the value is absurd because it is impossible (for example, if investigating the effect of body weight on metabolic rate, the value <span class="math inline">\(weight = 0\)</span> is impossible).</p>
<p>The intercept and slope are the coefficients of the model fit to the data, which is</p>
<p><span class="math display">\[\begin{equation}
day_i = b_0 + b_1 temperature_i + e_i
(\#eq:continuous-x-fit)
\end{equation}\]</span></p>
<p>where <em>day</em> is the day of green-down, <em>temperature</em> is the added temperature, and <em>i</em> refers (or “indexes”) the <em>i</em>th enclosure. This model completely reconstructs the day of green-down for all ten enclosures. For example, the day of green-down for enclosure 8 is</p>
<p><span class="math display">\[\begin{equation}
332 = 289.458750 + 4.982745 \times 6.73 + 9.00737
\end{equation}\]</span></p>
<p>The coefficients in the model are estimates of the parameters of the <strong>generating model</strong> fit to the data</p>
<p><span class="math display">\[\begin{align}
day &amp;= \beta_0 + \beta_1 temperature + \varepsilon\\
\varepsilon &amp;\sim N(0, \sigma^2)
(\#eq:continuous-x-m1)
\end{align}\]</span></p>
<p>A generating model of the data is used to make inference, for example, a measure of uncertainty in a prediction in the timing of green-down with future warming, or a measure of uncertainty about the effect of temperature on green-down.</p>
</section>
<section id="using-a-regression-model-for-explanation-causal-models" class="level3" data-number="9.2.3">
<h3 data-number="9.2.3" class="anchored" data-anchor-id="using-a-regression-model-for-explanation-causal-models"><span class="header-section-number">9.2.3</span> Using a regression model for “explanation” – causal models</h3>
<p>In this text, “explanatory” means “causal” and a goal of explanatory modeling is the estimate of causal effects using a <strong>causal interpretation</strong> of the linear model (=regression) coefficients. “What what? I learned in my stats 101 course that we cannot interpret regression coefficients causally”.</p>
<p>Statisticians (and statistics textbooks) have been quite rigid that a regression coefficient has a descriptive (or “observational”, see below) interpretation but not a causal interpretation. At the same time, statisticians (and statistics textbooks) do not seem to have any issue with interpeting the modeled effects from an experiment causally, since this is how they are interpreted. But if the modeled effects are simply coefficients from a linear (= regression) model, then this historical practice is muddled.</p>
<p>Part of this muddled history arises from the use of “regression” for models fit to observational data with one or more continuous <span class="math inline">\(X\)</span> variables and the use of “ANOVA” for models fit to experimental data with one or more categorical <span class="math inline">\(X\)</span>. This separation seems to have blinded statisticians from working on the formal probabilistic statements underlying causal interpretations of effect estimates in ANOVA and the synthesis of these statements with the probabilistic statements in regression modeling. Two major approaches to developing formal, probabilistic statements of causal modeling in statistics are the <strong>Rubin causal model</strong> and the <strong>do-operator</strong> of Pearl. Despite the gigantic progress in these approaches, little to none of this has found its way into biostatistics textbooks.</p>
<section id="what-a-regression-coefficient-means" class="level4" data-number="9.2.3.1">
<h4 data-number="9.2.3.1" class="anchored" data-anchor-id="what-a-regression-coefficient-means"><span class="header-section-number">9.2.3.1</span> What a regression coefficient means</h4>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p>Description: when we saw a one unit larger value in <em>X</em>, we saw, on average, a difference of <em>b</em> in <em>Y</em>.</p>
<p>Prediction: when we see a one unit larger value in <em>X</em>, we expect to see a difference of <em>b</em> in <em>Y</em>.</p>
<p>Explanation (causation): when we set <em>X</em> to have one unit larger value, we expect <em>Y</em> to change by <em>b</em>.</p>
</div>
<p>A linear (“regression”) model coefficient, such as the coefficient for temperature, <span class="math inline">\(\beta_1\)</span>, has three interpretations, an <strong>observational</strong> interpretation, a <strong>predictive interpretation</strong>, and a <strong>causal interpretation</strong>. This text is about causal interpretations, but to explain what is meant by this, I need to clarify the differences between causal and observational interpretations.</p>
<p>To clarify the differences, it’s useful to remember that an expected value from a regression model is a <strong>conditional mean</strong></p>
<p><span class="math display">\[\begin{equation}
\textrm{E}[day|temperature] = \beta_0 + \beta_1 temperature
(\#eq:continuous-x-conditional-mean)
\end{equation}\]</span></p>
<p>In words “the expected value of day conditional on temperature is beta-knot plus beta-one times temperature”. An <strong>expected value</strong> is a long run average – if we had an infinite number of enclosures with <span class="math inline">\(temperature=x\)</span> (where <span class="math inline">\(x\)</span> is a specific value of added temperature, say 2.5 °C), the average <span class="math inline">\(day\)</span> of these enclosures is <span class="math inline">\(\beta_0 + \beta_1 x\)</span>.</p>
<p>The parameter <span class="math inline">\(\beta_1\)</span> is a <em>difference</em> in conditional means.</p>
<p><span class="math display">\[\begin{equation}
\beta_1 = \textrm{E}[day|temperature = x+1] - \textrm{E}[day|temperature = x]
(\#eq:beta)
\end{equation}\]</span></p>
<p>In words, “beta-one is the expected value of day of green-down when the temperature equals x + 1 minus the expected value of day of green-down when the temperature equals x.” A very short way to state this is “beta-one is a difference in conditional means”.</p>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p>tl;dr. Note that the “+ 1” in this definition is mere convenience. Since the slope of a line is <span class="math inline">\(\frac{y_2 - y_1}{x_2 - x_1}\)</span>, where (<span class="math inline">\(x_1\)</span>, <span class="math inline">\(y_1\)</span>) and (<span class="math inline">\(x_2\)</span>, <span class="math inline">\(y_2\)</span>) are the coordinates of any two points on the line, it is convenient to choose two points that differ in <span class="math inline">\(X\)</span> by one unit, which makes the fraction equal to the numerator only. The numerator is a difference in conditional means. It is also why the units of a regression coefficient are “per unit of <span class="math inline">\(X\)</span> even if defined as a difference in two <span class="math inline">\(Y\)</span> values.</p>
</div>
<p>The difference between observational and causal interpretations of <span class="math inline">\(\beta_1\)</span> depends on the “event” conditioned on in <span class="math inline">\(\textrm{E}[day|temperature]\)</span>. Let’s start with the causal interpretation, which is how we should think about the regression coefficients in the green-down experiment.</p>
</section>
<section id="causal-interpretation-conditional-on-doing-x-x" class="level4" data-number="9.2.3.2">
<h4 data-number="9.2.3.2" class="anchored" data-anchor-id="causal-interpretation-conditional-on-doing-x-x"><span class="header-section-number">9.2.3.2</span> Causal interpretation – conditional on “doing” X = x</h4>
<p>In the causal interpretation of regression, <span class="math inline">\(\textrm{E}[day|temperature]\)</span> is conditioned on “doing” a real or hypothetical intervention in the system where we set the value of <span class="math inline">\(temperature\)</span> to a specific value <span class="math inline">\(x\)</span> (“<span class="math inline">\(temperature=x\)</span>), while keeping everything else about the system the same. This can be stated explicitly as <span class="math inline">\(\textrm{E}[day|\;do\;temperature = x]\)</span>. Using the do-operator, we can interpret <span class="math inline">\(\beta_1\)</span> as an <strong>effect coefficient</strong>.</p>
<p><span class="math display">\[\begin{equation}
\beta_1 = \textrm{E}[day|\;do\;temperature = x+1] - \textrm{E}[day|\;do\;temperature = x]
\end{equation}\]</span></p>
<p>In words, “beta-one is the expected value of day of green-down were we to set the temperature to x + 1, minus the expected value of day of green-down were we to set the temperature to x.”</p>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p>tl;dr. In the green-down experiment, the researchers didn’t set the temperature in the intervened enclosures to the ambient temperature + 1 but to ambient + 2.25, ambient + 4.5, ambient + 6.75, and ambient + 9.0. Again (see tl;dr above), the + 1 is mere convenience in the definition.</p>
</div>
</section>
<section id="observational-interpretation-conditional-on-seeing-x-x." class="level4" data-number="9.2.3.3">
<h4 data-number="9.2.3.3" class="anchored" data-anchor-id="observational-interpretation-conditional-on-seeing-x-x."><span class="header-section-number">9.2.3.3</span> Observational interpretation – conditional on “seeing” X = x.</h4>
<p>In the observational interpretation of regression, <span class="math inline">\(\textrm{E}[day|temperature]\)</span> is conditioned on sampling data and “seeing” a value of <span class="math inline">\(temperature\)</span>. We can state this explicitly as <span class="math inline">\(\textrm{E}[day|\;see\;temperature]\)</span>. From this, we can interpret <span class="math inline">\(\beta_1\)</span> as an <strong>observational coefficient</strong></p>
<p><span class="math display">\[\begin{equation}
\beta_1 = \textrm{E}[day|\;see\;temperature = x+1] - \textrm{E}[day|\;see \;temperature = x]
\end{equation}\]</span></p>
<p>In words, “beta-one is the expected value of day of green-down when see that temperature equals x + 1 minus the expected value of day of green-down when we see that temperature equals x.” To understand what I mean by “observational”, let’s imagine that the green-down data do not come from an experiment in which the researchers intervened and set the added temperature to a specifc value but from ten sites that naturally vary in mean annual temperature. Or from a single site with 10 years of data, with some years warmer and some years colder. Data from this kind of study is <strong>observational</strong> – the researcher didn’t intervene and set the <span class="math inline">\(X\)</span> values but merely observed the <span class="math inline">\(X\)</span> values.</p>
<p>If we sample (or “see”) a site with a mean annual temperature that is 2.5 °C above a reference value, the expected day of green-down is <span class="math inline">\(\textrm{E}[day|temperature = 2.5 °C]\)</span>. That is, values near <span class="math inline">\(\textrm{E}[day|temperature = 2.5 °C]\)</span> are more probable than values away from <span class="math inline">\(\textrm{E}[day|temperature = 2.5 °C]\)</span>. Or, if the only information that we have about this site is a mean annual temperature that is 2.5 °C above some reference, then our best prediction of the day of green-down would be <span class="math inline">\(\textrm{E}[day|temperature = 2.5 °C]\)</span>. We do not claim that the 4.98 day delay in green-down is caused by the warmer temperature, only that this is the expected delay relative to the reference having seen the data.</p>
<p>The seeing interpretation of a regression coefficient is <strong>descriptive</strong>– it is a description of a mathematical relationship. In this interpretation, the coefficient is not causal in the sense of what the expected <strong>response</strong> in <span class="math inline">\(Y\)</span> would be were we to intervene in the system and change <span class="math inline">\(X\)</span> from <span class="math inline">\(x\)</span> to <span class="math inline">\(x+1\)</span>.</p>
</section>
<section id="omitted-variable-bias" class="level4" data-number="9.2.3.4">
<h4 data-number="9.2.3.4" class="anchored" data-anchor-id="omitted-variable-bias"><span class="header-section-number">9.2.3.4</span> Omitted variable bias</h4>
<p>What is the consequence of interpreting a regression coefficient causally instead of observationally?</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-dag-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>a Directed Acyclic (or causal) Graph of a hypothetical world where the day of green-down is caused by two, correlated environmental variables, temperature and moisture, and to a noise factor (U) that represents an unspecified set of additional variables that are not correlated to either temperature or moisture.</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s expand the thought experiment where we have an observational data set of green down dates. In this thought experiment, only two variables systematically affect green-down DOY. The first is the temperature that the plants experience; the effect of <span class="math inline">\(temperature\)</span> is <span class="math inline">\(\beta_1\)</span>. The second is the soil moisture that the plants experience; the effect of <span class="math inline">\(moisture\)</span> is <span class="math inline">\(\beta_2\)</span>. <span class="math inline">\(temperature\)</span> and <span class="math inline">\(moisture\)</span> are correlated with a value <span class="math inline">\(\rho\)</span>. This causal model is graphically represented by the <strong>causal graph</strong> above.</p>
<p>Lets fit two linear models.</p>
<p><span class="math display">\[\begin{align}
(\mathcal{M}_1)\; day &amp;= b_0 + b_1 \; temperature + b_2 \; moisture + \varepsilon\\
(\mathcal{M}_2)\; day &amp;= b_0 + b_1 \; temperature + \varepsilon
\end{align}\]</span></p>
<p><span class="math inline">\(\mathcal{M}_1\)</span> the linear model including both <span class="math inline">\(temperature\)</span> and <span class="math inline">\(moisture\)</span> as <span class="math inline">\(X\)</span> variables and <span class="math inline">\(\mathcal{M}_2\)</span> the linear model including only <span class="math inline">\(temperature\)</span> as an <span class="math inline">\(X\)</span> variable. Given the true causal model above, <span class="math inline">\(b_1\)</span> is an <strong>unbiased</strong> estimate of the true causal effect of temperature <span class="math inline">\(\beta_1\)</span> in <span class="math inline">\(\mathcal{M}_1\)</span> because the expected value of <span class="math inline">\(b_1\)</span> is <span class="math inline">\(\beta_1\)</span>. By contrast, <span class="math inline">\(b_1\)</span> is a <strong>biased</strong> estimate of the true causal effect of temperature <span class="math inline">\(\beta_1\)</span> in <span class="math inline">\(\mathcal{M}_2\)</span>. The expected value of <span class="math inline">\(b_1\)</span> in <span class="math inline">\(\mathcal{M}_2\)</span> is the true, causal effect plus a bias term.</p>
<p><span class="math display">\[\begin{equation}
\mathrm{E}(b_1|\mathcal{M}_1) = \beta + \rho \alpha \frac{\sigma_{moisture}}{\sigma_{temperature}}
\end{equation}\]</span></p>
<p>This bias (<span class="math inline">\(\rho \alpha \frac{\sigma_{moisture}}{\sigma_{temperature}}\)</span>) is <strong>omitted variable bias</strong>. The omitted variable <span class="math inline">\(moisture\)</span> is an unmeasured, <strong>confounding variable</strong>. A variable <span class="math inline">\(X_2\)</span> is a confounder for variable <span class="math inline">\(X_1\)</span> if <span class="math inline">\(X_2\)</span> has both a correlation with <span class="math inline">\(X_1\)</span> and a path to the response <span class="math inline">\(Y\)</span> that is not through <span class="math inline">\(X_1\)</span>. With ommitted variable bias, as we sample more and more data, our estimate of the effect doesn’t converge on the truth but the truth plus some bias.</p>
</section>
<section id="causal-modeling-with-experimental-versus-observational-data" class="level4" data-number="9.2.3.5">
<h4 data-number="9.2.3.5" class="anchored" data-anchor-id="causal-modeling-with-experimental-versus-observational-data"><span class="header-section-number">9.2.3.5</span> Causal modeling with experimental versus observational data</h4>
<p>Causal interpretation requires conditioning on “doing X=x”. For the green-down data, “doing X=x” is achieved by the random treatment assignment of the enclosures. How does random treatment assignment achieve this? Look again at Figure @ref(fig:continuous-x-dag). If the values of <span class="math inline">\(treatment\)</span> are randomly assigned, then, by definition, the expected value of the correlation between <span class="math inline">\(treatment\)</span> and <span class="math inline">\(moisture\)</span> is zero. In fact, the expected value of the correlation between <span class="math inline">\(treatment\)</span> and any measurable variable at the study site is zero. Given, this, the expected value of the regression coefficient for <span class="math inline">\(temperature\)</span> (<span class="math inline">\(b_1\)</span>) is <span class="math inline">\(\beta\)</span> because <span class="math inline">\(\rho=0\)</span>. That is, the estimate of the true effect is unbiased. It doesn’t matter if <span class="math inline">\(moisture\)</span>, or any other variable, is excluded from the model. (That said, we may want to include moisture or other variables in the model to increase precision of the causal effect. This is addressed in the chapter “Models with Covariates”). This is what an experiment does and why experiments are used to answer causal questions.</p>
<p>Can we use observational data for causal modeling? Yes, but the methods for this are outside of the scope of this text. The mathematical foundation for this is known as <strong>path analysis</strong>, which was developed by geneticist and evolutionary biologist Sewell Wright (I include this because this work has inspired much of how I think about biology and because he is both my academic grandfather and great-grandfather). Causal analysis of observational data in biology is rare outside of ecology and epidemiology. Good starting points for the modern development of causal analysis are <a href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" target="_blank">Hernán MA and Robins JM (2020)</a> and <a href="https://www.annualreviews.org/doi/abs/10.1146/annurev-genom-083117-021731" target="_blank">Burgess et al.&nbsp;(2018)</a>. A gentle introduction is <a href="https://www.basicbooks.com/titles/judea-pearl/the-book-of-why/9780465097609/" target="_blank">Pearl and Mackenzie (2018)</a>.</p>
</section>
</section>
<section id="using-a-regression-model-for-prediction-prediction-models" class="level3" data-number="9.2.4">
<h3 data-number="9.2.4" class="anchored" data-anchor-id="using-a-regression-model-for-prediction-prediction-models"><span class="header-section-number">9.2.4</span> Using a regression model for prediction – prediction models</h3>
<p>The researchers in the green-down study also presented estimates of the effect of temperature on green-down using two observational datasets. Let’s use the one in Extended Data Figure 3d to explore using a regression model for prediction. The data are taken from measurements of the day of green-down over an 86 year period at a single site. The response variable is <span class="math inline">\(green\_down\_anomaly\)</span> (the difference between the day of green down for the year and the mean of these days over the 86 years). The predictor variable is <span class="math inline">\(autumn\_temp\_anomaly\)</span> (the difference between the mean temperature over the year and the mean of these means).</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..rr.label..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(rr.label)` instead.
ℹ The deprecated feature was likely used in the ggpubr package.
  Please report the issue at &lt;https://github.com/kassambara/ggpubr/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-pred-fig-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot in figure @ref(fig:continuous-x-pred-fig) shows the regression line of a linear model fit to the data. Two statistics are given in the plot.</p>
<ol type="1">
<li>The <em>p</em>-value of the slope (the coefficient <span class="math inline">\(b_1\)</span> of <span class="math inline">\(autumn\_temp\_anomaly\)</span>)</li>
<li>The <span class="math inline">\(R^2\)</span> of the model fit.</li>
</ol>
<p>In addition, two intervals are shown.</p>
<ol type="1">
<li>95% <strong>confidence interval</strong> of the expected values in blue. The width of this band is a measure of the precision of the estimates of expected values.</li>
<li>95% <strong>prediction interval</strong> of the predictions in gray. The width of this band is a measure of how well the model predicts.</li>
</ol>
<p>It is important that researchers knows what each of these statistics and bands are, when to compute them and when to ignore them them, and what to say about each when communicating the results.</p>
<section id="ci-and-p-value" class="level4" data-number="9.2.4.1">
<h4 data-number="9.2.4.1" class="anchored" data-anchor-id="ci-and-p-value"><span class="header-section-number">9.2.4.1</span> 95% CI and <em>p</em>-value</h4>
<p>Both the 95% confidence interval of the expected values and the <em>p</em>-value are a function of the standard error of the slope coefficient <span class="math inline">\(b_1\)</span> and so are complimentary statistics. The <em>p</em>-value is the probability of sampling the null that results in a <span class="math inline">\(t\)</span>-value as or more extreme than the observed <em>t</em> for the coefficient <span class="math inline">\(b_1\)</span>. This null includes the hypothesis <span class="math inline">\(\beta_1 = 0\)</span>. The 95% confidence interval of the expected values is the band containing expected values (mean <span class="math inline">\(green\_down\_anomaly\)</span> conditional on <span class="math inline">\(autumn\_temp\_anomaly\)</span>) that are compatible with the data. There are a couple of useful ways of thinking about this band.</p>
<ol type="1">
<li>The band captures an infinite number of regression lines that are compatible with the data. Some are more steep and predict smaller expected values at the low end of <span class="math inline">\(autumn\_temp\_anomaly\)</span> and higher expected values at the high end of <span class="math inline">\(autumn\_temp\_anomaly\)</span>. Others are less steep and predict higher expected values at the low end of <span class="math inline">\(autumn\_temp\_anomaly\)</span> and lower expected values at the high end of <span class="math inline">\(autumn\_temp\_anomaly\)</span>.</li>
<li>The band captures the 95% CI of the conditional mean at every value of <span class="math inline">\(X\)</span>. Consider the 95% CI of the conditional mean at the mean value of <span class="math inline">\(X\)</span>. As we move away from this mean value (lower to higher <span class="math inline">\(X\)</span>), the 95% CI of the conditional mean increases.</li>
</ol>
<p>A 95% CI and <em>p</em>-value are useful statistics to report if the purpose is <em>causal modeling</em>, as in the example above using the experimental green-down data (where the 95% CI was not presented as a confidence band of the expected values but a CI of the estimate of the effect of added temperature). A 95% CI and <em>p</em>-value are also useful statistics to report if the purpose is <em>descriptive modeling</em>, simply wanting to know how the conditional mean of the response is related to an <span class="math inline">\(X\)</span> variable.</p>
</section>
<section id="prediction-interval-and-r2" class="level4" data-number="9.2.4.2">
<h4 data-number="9.2.4.2" class="anchored" data-anchor-id="prediction-interval-and-r2"><span class="header-section-number">9.2.4.2</span> 95% prediction interval and <span class="math inline">\(R^2\)</span></h4>
<p>Both the <span class="math inline">\(R^2\)</span> and the 95% prediction interval are a function of the <em>population</em> variability of <span class="math inline">\(green\_down\_anomaly\)</span> conditional on <span class="math inline">\(autumn\_temp\_anomaly\)</span> (the spread of points along a vertical axis about the regression line) and are complimentary statistics. Briefly,</p>
<ol type="1">
<li>the <span class="math inline">\(R^2\)</span> is a measure of the fraction of the variance in the response that is accounted by the model (some sources say “explained by the model” but this is an odd use of “explain”). It is a number between 0 and 1 and is a measure of “predictability” if the goal is prediction modeling.</li>
<li>The 95% prediction interval will contain a new observation 95% of the time. It provides bounds on a <strong>prediction</strong> – given a new observation, there is a 95% probability that the interval at <span class="math inline">\(x_{new}\)</span> will contain <span class="math inline">\(y_{new}\)</span>.</li>
</ol>
<p>To understand <span class="math inline">\(R^2\)</span> and the 95% prediction interval a bit better, let’s back up.</p>
<p><span class="math display">\[\begin{equation}
green\_down\_anomaly_i = b_0 + b_1 autumn\_temp\_anomaly_i + e_i
(\#eq:doy_fit)
\end{equation}\]</span></p>
<p>Model @ref(eq:eq:doy_fit) recovers the measured value of <span class="math inline">\(green\_down\_anomaly\)</span> for any year, given the <span class="math inline">\(autumn\_temp\_anomaly\)</span> for the year. The equation includes the linear predictor (<span class="math inline">\(b_0 + b_1 autumn\_temp\_anomaly_i\)</span>) and the <strong>residual</strong> from the predictor (<span class="math inline">\(e_i\)</span>). The predictor part of @ref(eq:doy_fit) is used to compute <span class="math inline">\(\hat{y}\)</span> (“y hat”).</p>
<p><span class="math display">\[\begin{equation}
\hat{y}_i = b_0 + b_1 autumn\_temp\_anomaly_i
(\#eq:doy_hat)
\end{equation}\]</span></p>
<p>The <span class="math inline">\(\hat{y}\)</span> are <strong>fitted values</strong>, if the values are computed from the data that were used for the fit, or <strong>predicted values</strong> (or simply the <strong>prediction</strong>), if the values are computed from values of the predictor variables outside the set used to fit the model. For the purpose of plotting, generally, with models with categorical factors as <span class="math inline">\(X\)</span>, I prefer either <strong>modeled values</strong> or <strong>conditional means</strong> to fitted values.</p>
</section>
<section id="r2" class="level4" data-number="9.2.4.3">
<h4 data-number="9.2.4.3" class="anchored" data-anchor-id="r2"><span class="header-section-number">9.2.4.3</span> <span class="math inline">\(R^2\)</span></h4>
<p>A good model accounts for a sizable fraction of the total variance in the response. This fraction is the <span class="math inline">\(R^2\)</span> value, which is given in <code>summary(m1)</code> and accessed directly with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1305754</code></pre>
</div>
</div>
<p><span class="math inline">\(R^2\)</span> is the fraction of the total variance of <span class="math inline">\(Y\)</span> that is generated by the linear predictor.</p>
<p><span class="math display">\[\begin{equation}
R^2 = \frac{\mathrm{VAR}(\hat{y})}{\mathrm{VAR}(y)}
\end{equation}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(m1)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> efig_3d[, green_down_anomaly]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(yhat)<span class="sc">/</span><span class="fu">var</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1305754</code></pre>
</div>
</div>
<p><span class="math inline">\(R^2\)</span> will vary from zero (the model accounts for nothing) to one (the model accounts for everything). <span class="math inline">\(R^2\)</span> is often described as the fraction of total variation <em>explained</em> by the model” but the usage of “explain” is observational and not causal. Because of the ambiguous usage of “explain” in statistics, I prefer to avoid the word.</p>
<p>It can be useful sometimes to think of <span class="math inline">\(R^2\)</span> in terms of <strong>residual error</strong>, which is the variance of the residuals from the model. The larger the residual error, the smaller the <span class="math inline">\(R^2\)</span>, or</p>
<p><span class="math display">\[\begin{equation}
R^2 = 1 - \frac{\mathrm{VAR}(e)}{\mathrm{VAR}(y)}
\end{equation}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">residuals</span>(m1)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> efig_3d[, green_down_anomaly]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">var</span>(e)<span class="sc">/</span><span class="fu">var</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1305754</code></pre>
</div>
</div>
<p>The smaller the residuals, the higher the <span class="math inline">\(R^2\)</span> and the closer the predicted values are to the measured values. The sum of the model variance and residual variance equals the total variance and, consequently, <span class="math inline">\(R^2\)</span> is a signal to signal + noise ratio. The noise in <span class="math inline">\(R^2\)</span> is the sampling variance of the individual measures. The noise in a <em>t</em>-value is the sampling variance of the parameter (for m1, this is the sampling variance of <span class="math inline">\(b_1\)</span>). This is an important distinction because it means that <em>t</em> and <span class="math inline">\(R^2\)</span> are not related 1:1. In a simple model with only a single <span class="math inline">\(X\)</span>, one might expect <span class="math inline">\(R^2\)</span> to be big if the <em>p</em>-value for the slope is tiny, but this isn’t necessarily true because of the different meaning of noise in each. A study with a very large sample size <span class="math inline">\(n\)</span> can have a tiny <em>p</em>-value <em>and</em> a small <span class="math inline">\(R^2\)</span>. A <em>p</em>-value is not a good indicator of predictability. <span class="math inline">\(R^2\)</span> is. This is explored more below.</p>
</section>
<section id="prediction-interval" class="level4" data-number="9.2.4.4">
<h4 data-number="9.2.4.4" class="anchored" data-anchor-id="prediction-interval"><span class="header-section-number">9.2.4.4</span> Prediction interval</h4>
<p>A good prediction model has high predictability, meaning the range of predicted values is narrow. A 95% CI is a reasonable range to communicate. For any decision making using prediction, it is better to look at numbers than a band on a plot.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Autumn Temp Anomaly (°C)</th>
<th style="text-align: right;">Expected (days)</th>
<th style="text-align: right;">2.5% (days)</th>
<th style="text-align: right;">97.5% (days)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">-8.7</td>
<td style="text-align: right;">10.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">-7.9</td>
<td style="text-align: right;">11.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">-7.2</td>
<td style="text-align: right;">12.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">-6.4</td>
<td style="text-align: right;">12.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">4.0</td>
<td style="text-align: right;">-5.7</td>
<td style="text-align: right;">13.7</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Given these data and the fit model, if we see a 2 °C increase in mean fall temperature, we expect the autumn green-down to extend 3.2 days. This expectation is an average. We’d expect 95% of actual values to range between -6.4 days and 12.8 days. This is a lot of variability. Any prediction has a reasonable probability of being over a week early or late. This may seem surprising given the <em>p</em>-value of the fit, which is 0.0006. But the <em>p</em>-value is not a reliable indicator of predictability. It is a statistic related to the blue band, not the gray band.</p>
<p>To understand this prediction interval a bit more, and why a <em>p</em>-value is not a good indicator of predictability, it’s useful to understand what makes a prediction interval “wide”. The width of the prediction interval is a function of two kinds of variability</p>
<ol type="1">
<li>The variance of the expected value at a specific value of <span class="math inline">\(X\)</span>. This is the square of the standard error of <span class="math inline">\(b_1\)</span>. The blue band is communicating the CI based on this variance. The <em>p</em>-value is related to the wideth of this band.</li>
<li>The variance of <span class="math inline">\(Y\)</span> at a specific value of <span class="math inline">\(X\)</span>. This variance is <span class="math inline">\(\sigma^2\)</span>. It is useful for learning to think about the equation for the estimate of this variance.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\hat\sigma^2 = \frac{\sum{e_i^2}}{N-2}
\end{equation}\]</span></p>
<p>Again, <span class="math inline">\(e_i\)</span> is the residual for the <em>i</em>th case. The denominator (<span class="math inline">\(N-2\)</span>) is the degrees of freedom of the model. Computing <span class="math inline">\(\hat\sigma^2\)</span> manually helps to insure that we understand what is going on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)<span class="sc">$</span>sigma <span class="co"># R's calculation of sigma hat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.736643</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">summary</span>(m1)<span class="sc">$</span>df[<span class="dv">2</span>] <span class="co"># R's calculation of df. Check that this is n-2!</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">sum</span>(e<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.736643</code></pre>
</div>
</div>
<p>Remember that an assumption of the linear models that we are working with at this point is, this variance is constant for all values of <span class="math inline">\(X\)</span>, so we have a single <span class="math inline">\(\sigma\)</span>. Later, we will cover linear models that model heterogeneity in this variance. <span class="math inline">\(\sigma\)</span> is a function of variability in the population – it is the population standard deviation conditional on <span class="math inline">\(X\)</span>.</p>
<p>Importantly, predictability is a function of both these components of variability. As a consequence, it is <span class="math inline">\(R^2\)</span>, and not the <em>p</em>-value, that is the indicator of predictability. In the observational green-down data, even if we had thousands of years of data, we would still have a pretty low <span class="math inline">\(R^2\)</span> because of the population variability of <span class="math inline">\(green\_down\_anomaly\)</span> at a given <span class="math inline">\(autumn\_temp\_anomaly\)</span>.</p>
</section>
<section id="median-absolute-error-and-root-mean-square-error-are-absolute-measures-of-predictability" class="level4" data-number="9.2.4.5">
<h4 data-number="9.2.4.5" class="anchored" data-anchor-id="median-absolute-error-and-root-mean-square-error-are-absolute-measures-of-predictability"><span class="header-section-number">9.2.4.5</span> Median Absolute Error and Root Mean Square Error are absolute measures of predictability</h4>
<p>A <em>p</em>-value is not <em>at all</em> a good guide to predictability. <span class="math inline">\(R^2\)</span> is proportional to predictability but is not really useful in any absolute sense. If we want to predict the effect of warming on the day of green-down, I would like to have a measure of predictability in the units of green-down, which is days. The prediction interval gives this for any value of <span class="math inline">\(X\)</span>. But what about an overall measure of predictability?</p>
<p>Three overall measures of predictability are</p>
<ol type="1">
<li><span class="math inline">\(\hat{\sigma}\)</span>, the estimate of <span class="math inline">\(\sigma\)</span>. This is the standard deviation of the sample conditional on <span class="math inline">\(X\)</span>.</li>
<li><span class="math inline">\(RMSE\)</span>, the root mean squared error. This is</li>
</ol>
<p><span class="math display">\[\begin{align}
SSE &amp;= \sum{(y_i - \hat{y}_i)^2}\\
MSE &amp;= \frac{SSE}{N}\\
RMSE &amp;= \sqrt{MSE}
\end{align}\]</span></p>
<p><span class="math inline">\(SSE\)</span> (“sum of squared error”) is the sum of the squared residuals (<span class="math inline">\(y_i - \hat{y}_i\)</span>) of the model. <span class="math inline">\(MSE\)</span> (“mean squared error”) is the mean of the squared errors. <span class="math inline">\(RMSE\)</span> is the square root of the mean squared error. <span class="math inline">\(RMSE\)</span> is almost equal to <span class="math inline">\(\hat{\sigma}\)</span>. The difference is the denominator, which is <span class="math inline">\(N\)</span> in the computation of <span class="math inline">\(RMSE\)</span> and <span class="math inline">\(df\)</span> (the degrees of freedom of the model, which is <span class="math inline">\(N\)</span> minus the number of fit parameters) in the computation of <span class="math inline">\(\hat{\sigma}\)</span>.</p>
<ol start="3" type="1">
<li><span class="math inline">\(MAE\)</span>, the mean absolute error. This is</li>
</ol>
<p><span class="math display">\[\begin{equation}
MAE = \frac{1}{N}\sum{|y_i - \hat{y}_i|}
\end{equation}\]</span></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.681241</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4.74</td>
<td style="text-align: right;">4.68</td>
<td style="text-align: right;">3.58</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If the goal of an analysis is prediction, one of these statistics should be reported. For the model fit to the observational green-down data in Extended Figure 3d, these three statistics are given in Table @ref(table:continuous-x-average-error) above (to two decimal places simply to show numerical difference between <span class="math inline">\(\hat{\sigma}\)</span> and <span class="math inline">\(RMSE\)</span>). All of these are measures of an “average” prediction error in the units of the response. The average error is either 4.7 or 3.6 days, depending on which statistic we report. Why the difference? Both <span class="math inline">\(\hat{\sigma}\)</span> and <span class="math inline">\(RMSE\)</span> are functions of squared error and so big differences between predicted and actual value are emphasized. If an error of 6 days is more than twice as bad than an error of 3 days, report <span class="math inline">\(RMSE\)</span>. Why <span class="math inline">\(RMSE\)</span> and not <span class="math inline">\(\hat{\sigma}\)</span>? Simply because researchers using prediction models are more familiar with <span class="math inline">\(RMSE\)</span>. If an error of 6 days is <em>not</em> more than twice as bad than an error of 3 days, report <span class="math inline">\(MAE\)</span>.</p>
</section>
<section id="prediction-modeling-is-more-sophisticated-than-presented-here" class="level4" data-number="9.2.4.6">
<h4 data-number="9.2.4.6" class="anchored" data-anchor-id="prediction-modeling-is-more-sophisticated-than-presented-here"><span class="header-section-number">9.2.4.6</span> Prediction modeling is more sophisticated than presented here</h4>
<p>For data where the response is a non-linear function of the predictor, or for data with many predictor variables, researchers will often build a model using a <strong>model selection</strong> method. Stepwise regression is a classical model selection method that is commonly taught in intro biostatistics and commonly used by researchers. Stepwise regression as a method of model selection has many well-known problems and should be avoided.</p>
<p>Some <em>excellent</em> books that are useful for building models and model selection are</p>
<ol type="1">
<li><a href="https://web.stanford.edu/~hastie/ElemStatLearn/" target="_blank">The Elements of Statistical Learning</a></li>
<li><a href="https://avehtari.github.io/ROS-Examples/" target="_blank">Regression and Other Stories</a></li>
<li><a href="http://hbiostat.org/doc/rms/4day.html" target="_blank">Regression Modeling Strategies</a></li>
</ol>
</section>
</section>
<section id="using-a-regression-model-for-creating-a-new-response-variable-comparing-slopes-of-longitudinal-data" class="level3" data-number="9.2.5">
<h3 data-number="9.2.5" class="anchored" data-anchor-id="using-a-regression-model-for-creating-a-new-response-variable-comparing-slopes-of-longitudinal-data"><span class="header-section-number">9.2.5</span> Using a regression model for creating a new response variable – comparing slopes of longitudinal data</h3>
<p>In the study in this example, the researchers compared the growth rate of tumors in mice fed normal chow versus mice with a methionine restricted diet. Growth rate wasn’t actually compared. Instead, the researchers used a <em>t</em>-test to compare the size of the tumor measured at six different days. A problem with multiple <em>t</em>-tests for this dataset is that the errors (residuals from the model) on one day are correlated with the errors from another day because of the repeated measures on each mouse. This correlation will inflate Type I error rate.</p>
<p>Instead of six <em>t</em>-tests, a better strategy for these data is to use a regression to calculate a tumor growth rate for each mouse. There are sixteen mice so this is sixteen fit models. Here I use a “for loop” to fit the model to the data from a single mouse and use the slope (<span class="math inline">\(b_1\)</span>) as the estimate of the tumor growth rate for that mouse.</p>
<p>Use a for-loop to estimate growth rate for each mouse. In each pass through the loop</p>
<ol type="1">
<li>the subset of fig1f (the data in long format) belonging to mouse <em>i</em> is created</li>
<li>the linear model <code>volume ~ day</code> is fit to the subset</li>
<li>the coefficient of day (the slope, <span class="math inline">\(b_1\)</span>) is inserted in mouse <em>i</em>’s row in the column “growth” in the data.table “fig1f_wide”.</li>
</ol>
<p>At the end of the loop, we have the data.table fig1f_wide which has one row for each mouse, a column for the treatment factor (diet) and a column called “growth” containing each mouse’s growth rate. There are also columns of tumor volume for each mouse on each day but these are ignored.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(fig1f_wide)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>id_list <span class="ot">&lt;-</span> fig1f_wide[, id]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  mouse_i_data <span class="ot">&lt;-</span> fig1f[id <span class="sc">==</span> id_list[i]] <span class="co"># subset</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(volume <span class="sc">~</span> day, <span class="at">data =</span> mouse_i_data)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  fig1f_wide[id <span class="sc">==</span> id_list[i], growth <span class="sc">:</span><span class="er">=</span> <span class="fu">coef</span>(fit)[<span class="dv">2</span>]]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig1f_wide)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(x = treatment, y = growth, data = fig1f_wide)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(x = day, y = volume, color = treatment, data = fig1f) + geom_smooth(aes(group = id), method = "lm", se = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 3. <strong>fit the model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(growth <span class="sc">~</span> treatment, <span class="at">data =</span> fig1f_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Step 5. <strong>inference from the model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>m1_coef <span class="ot">&lt;-</span> <span class="fu">summary</span>(m1) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>m1_ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(m1)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>(m1_coef_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(m1_coef, m1_ci))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error   t value     Pr(&gt;|t|)     2.5 %    97.5 %
(Intercept)  52.63406   3.102096 16.967258 9.865155e-11  45.98072  59.28739
treatmentMR -23.57616   4.387026 -5.374065 9.809457e-05 -32.98540 -14.16693</code></pre>
</div>
</div>
<p>Step 6. <strong>plot the model</strong></p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2
3.5.0.
ℹ Please use the `legend.position.inside` argument of `theme()` instead.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/continuous-x-long-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="using-a-regression-model-for-for-calibration" class="level3" data-number="9.2.6">
<h3 data-number="9.2.6" class="anchored" data-anchor-id="using-a-regression-model-for-for-calibration"><span class="header-section-number">9.2.6</span> Using a regression model for for calibration</h3>
</section>
</section>
<section id="working-in-r" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="working-in-r"><span class="header-section-number">9.3</span> Working in R</h2>
<section id="fit-the-model" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="fit-the-model"><span class="header-section-number">9.3.1</span> Fitting the linear model</h3>
<p>A linear model is fit with the <code>lm</code> function, which is very flexible and will be a workhorse in much of this text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(transition_date <span class="sc">~</span> temperature, <span class="at">data =</span> fig2c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>m1 is an lm model object that contains many different kinds information, such as the model coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) temperature 
 289.458750    4.982745 </code></pre>
</div>
</div>
<p>We’ll return to others, but first, let’s explore some of the flexibility of the <code>lm</code> function. Two arguments were sent to the function</p>
<ol type="1">
<li>the model formula <code>transition_date ~ temperature</code> with the form <code>Y ~ X</code>, where Y and X are names of columns in the data.</li>
</ol>
<ul>
<li>The model formula itself can be assigned to a variable, which is useful when building functions. An example</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>coef_table <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, data){</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  m1_form <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(y, <span class="st">"~"</span>, x))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(m1_form, <span class="at">data =</span> data)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(m1)))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">coef_table</span>(<span class="at">x =</span> <span class="st">"temperature"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"transition_date"</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> fig2c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error   t value     Pr(&gt;|t|)
(Intercept) 289.458750  3.0593949 94.613071 1.738650e-13
temperature   4.982745  0.5541962  8.990941 1.866888e-05</code></pre>
</div>
</div>
<ul>
<li>Both Y and X can also be column names embedded within a function, for example</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(transition_date) <span class="sc">~</span> temperature, <span class="at">data =</span> fig2c)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) temperature 
  5.6690276   0.0160509 </code></pre>
</div>
</div>
<p>or</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">scale</span>(transition_date) <span class="sc">~</span> <span class="fu">scale</span>(temperature), <span class="at">data =</span> fig2c)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept) scale(temperature) 
      4.171921e-16       9.539117e-01 </code></pre>
</div>
</div>
<ol start="2" type="1">
<li>The data frame (remember that a data.table is a data frame) containing the columns with the variable names in the model formula. A data argument is not necessary but it is usually the better way (an exception is when a researcher wants to create a matrix of Y variables or to construct their own model matrix)</li>
</ol>
<p>type <code>?lm</code> into the console to see other arguments of the <code>lm</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> fig2[, temperature]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> fig2[, transition_date]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           x 
204.8866185   0.4324755 </code></pre>
</div>
</div>
</section>
<section id="getting-to-know-the-linear-model-the-summary-function" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="getting-to-know-the-linear-model-the-summary-function"><span class="header-section-number">9.3.2</span> Getting to know the linear model: the <code>summary</code> function</h3>
<p>The <code>lm</code> function returns an <code>lm</code> object, which we’ve assigned to the name <code>m1</code>. <code>m1</code> contains lots of information about our fit of the linear model to the data. Most of the information that we want for most purposes can be retrieved with the <code>summary</code> function, which is a general-purpose R command the works with many R objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = transition_date ~ temperature, data = fig2c)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.5062 -3.8536  0.6645  2.7537  9.0074 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 289.4588     3.0594  94.613 1.74e-13 ***
temperature   4.9827     0.5542   8.991 1.87e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.443 on 8 degrees of freedom
Multiple R-squared:  0.9099,    Adjusted R-squared:  0.8987 
F-statistic: 80.84 on 1 and 8 DF,  p-value: 1.867e-05</code></pre>
</div>
</div>
<p>What is here:</p>
<p><strong>Call</strong>. This is the model that was fit</p>
<p><strong>Residuals</strong>. This is a summary of the distribution of the residuals. From this one can get a sense of the distribution (for inference, the model assumes a normal distribution with mean zero). More useful ways to examine this distribution will be introduced later in this chapter.</p>
<p><strong>Coefficients table</strong>. This contains the linear model coefficients and their standard error and associated <span class="math inline">\(t\)</span> and <span class="math inline">\(p\)</span> values.</p>
<ol type="1">
<li>The column of values under “Estimate” are the coefficients of the fitted model (equation @ref(eq:continuous-x-fit)). Here, 289.4587503 is the intercept (<span class="math inline">\(b_0\)</span>) and 4.9827453 is the effect of <span class="math inline">\(temperature\)</span> (<span class="math inline">\(b_1\)</span>).</li>
<li>The column of values under “Std. Error” are the standard errors of the coefficients.</li>
<li>The column of values under “t value” are the <em>t-statistics</em> for each coefficient. A <em>t</em>-value is a <strong>signal to noise ratio</strong>. The coefficient <span class="math inline">\(b_1\)</span> is the “signal” and the SE is the noise. Get used to thinking about this ratio. A <em>t</em>-value greater than about 3 indicates a “pretty good” signal relative to noise, while one much below than 2 is not.</li>
<li>The column of values under “Pr(&gt;|t|)” is the <em>p</em>-value, which is the t-test of the estimate. What is the <em>p</em>-value a test of? The <em>p</em>-value tests the hypothesis “how probable are the data, or more extreme than than the data, if the true parameter is zero?”. Formally <span class="math inline">\(p = \mathrm{freq(t' \ge t|H_o)}\)</span>, where <span class="math inline">\(t'\)</span> is the hypothetical <em>t</em>-value, <em>t</em> is the observed <span class="math inline">\(t\)</span>-value, and <span class="math inline">\(H_o\)</span> is the null hypothesis. We will return to <em>p</em>-values in Chapter xxx.</li>
</ol>
<p><strong>Signif. codes</strong>. Significance codes are extremely common in the wet bench experimental biology literature but do not have much to recommend. I’ll return to these in the <em>p</em>-values chapter.</p>
<p>Beneath the Signif. codes are some model statistics which are useful</p>
<p><strong>Residual standard error</strong> This is <span class="math inline">\(\sqrt{\sum{e_i^2}/(n-2)}\)</span>, where <span class="math inline">\(e_i\)</span> are the residuals in the fitted model. “degrees of freedom” is the number of <span class="math inline">\(e_i\)</span> that are “allowed to vary” after fitting the parameters, so is the total sample size (<span class="math inline">\(n\)</span>) minus the number of parameters in the model. The fit model has two fit parameters (<span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> so the df is <span class="math inline">\(n-2\)</span>. Note that this is the denominator in the residual standard error equation.</p>
<p><strong>Multiple R-squared</strong>. This is an important but imperfect summary measure of the whole model that effectively measures how much of the total variance in the response variable “is explained by” the model. Its value lies between zero and 1. <strong>It’s a good measure to report in a manuscript</strong>, especially for observational data.</p>
<p><strong>F-statistic and p-value</strong>. These are statistics for the whole model (not the individual coefficients) and I just don’t find these very useful.</p>
</section>
<section id="inference-the-coefficient-table" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="inference-the-coefficient-table"><span class="header-section-number">9.3.3</span> Inference – the coefficient table</h3>
<p>There are different ways of</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step by step</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>m1_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(m1) <span class="co"># get summary</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>m1_coef_p1 <span class="ot">&lt;-</span> <span class="fu">coef</span>(m1_summary) <span class="co"># extract coefficient table</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>m1_coef_p2 <span class="ot">&lt;-</span> <span class="fu">confint</span>(m1) <span class="co"># get CIs</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>m1_coef <span class="ot">&lt;-</span> <span class="fu">cbind</span>(m1_coef_p1, m1_coef_p2) <span class="co"># column bind the two</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># this can be shortened (but still readable) using</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>m1_coef <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(m1)),</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">confint</span>(m1))</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>m1_coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error   t value     Pr(&gt;|t|)      2.5 %     97.5 %
(Intercept) 289.458750  3.0593949 94.613071 1.738650e-13 282.403773 296.513728
temperature   4.982745  0.5541962  8.990941 1.866888e-05   3.704767   6.260724</code></pre>
</div>
</div>
<p>Note that the <em>p</em>-value for the coefficient for <em>temperature</em> is very small and we could conclude that the data are not compatible with a model of no temperature effect on day of green-down. But did we need a formal hypothesis test for this? We haven’t learned much if we have only learned that the slope is “not likely to be exactly zero” (Temperature effects everything in biology). A far more important question is not <em>if</em> there is a relationship between <em>temperature</em> and <em>day</em> of green-down, but what is the sign and magnitude of the effect and what is the uncertainty in our estimate of this effect. For this, we we want the coefficient and its SE or confidence interval, both of which are in this table. Remember, our working definition of a confidence interval:</p>
<p><strong>A confidence interval contains the range of parameter values that are compatible with the data, in the sense that a <span class="math inline">\(t\)</span>-test would not reject the null hypothesis of a difference between the estimate and any value within the interval</strong></p>
<p>A more textbook way of defining a CI is: A 95% CI of a parameter has a 95% probability of including the true value of the parameter. It does not mean that there is a 95% probability that the true value lies in the interval. This is a subtle but important difference. Here is a way of thinking about the proper meaning of the textbook definition: we don’t know the true value of <span class="math inline">\(\beta_1\)</span> but we can 1) repeat the experiment or sampling, 2) re-estimate <span class="math inline">\(\beta_1\)</span>, and 3) re-compute a 95% CI. If we do 1-3 many times, 95% of the CIs will include <span class="math inline">\(\beta_1\)</span> within the interval.</p>
<p>Confidence intervals are often interpreted like <span class="math inline">\(p\)</span>-values. That is, the researcher looks to see if the CI overlaps with zero and if it does, concludes there is “no effect”. First, this conclusion is not correct – <strong>the inability to find sufficient evidence for an effect does not mean there is no effect, it simply means there is insufficient evidence to conclude there is an effect</strong>!</p>
<p>Second, what we want to use the CI for is to guide us about how big or small the effect might reasonably be, given the data. Again, A CI is a measure of parameter values that are “compatible” with the data. If our biological interpretations at the small-end and at the big-end of the interval’s range radically differ, then we don’t have enough <em>precision</em> in our analysis to reach an unambiguous conclusion.</p>
</section>
<section id="how-good-is-our-model-model-checking" class="level3" data-number="9.3.4">
<h3 data-number="9.3.4" class="anchored" data-anchor-id="how-good-is-our-model-model-checking"><span class="header-section-number">9.3.4</span> How good is our model? – Model checking</h3>
<p>There are two, quite different senses of what is meant by a good model.</p>
<ol type="1">
<li>How good is the model at predicting? Or, how much of the variance in the response (the stuff to be “explained”) is accounted for by the model? This was described above.</li>
<li>How well do the data look like a sample from the modeled distribution? If not well, we should consider alternative models. This is <strong>model checking</strong>.</li>
</ol>
<p>For inference, a good model generates data that look like the real data. If this is true, our fit model will have well-behaved residuals. There are several aspects of “well-behaved” and each is checked with a diagnostic plot. This <strong>model checking</strong> is covered in more detail in chapter xxx.</p>
<p>Inference from model @ref(eq:continuous-x-m1) assumes the data were sampled from a normal distribution. To check this, use a quantile-quantile or <strong>Q-Q plot</strong>. The <code>qqPlot</code> function from the car package generates a more useful plot than that from Base R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(m1, <span class="at">id=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Approximately normal residuals will track the solid line and stay largely within the boundaries marked by the dashed lines. The residuals from m1 fit to the green-down data track the solid line and remain within the dashed lines, indicating adequate model fit.</p>
<div style="background-color:#cccccc; text-align:left; vertical-align: middle; padding:20px 47px;">
<p>Note that a formal test of normality is often recommended. Formal tests do not add value above a diagnostic check. Robustness of inference (for example, a <em>p</em>-value) is a function of the type and degree of “non-normalness”, not of a p-value. For a small sample, there is not much power to test for normality, so samples from non-normal distributions pass the test (<span class="math inline">\(p &gt; 0.05\)</span>) and are deemed “normal”. For large samples, samples from distributions that deviate slightly from normal fail the test (<span class="math inline">\(p &lt; 0.05\)</span>) and are deemed “not normal”. Inference with many non-normal samples with large <span class="math inline">\(n\)</span> are very robust (meaning infernece is not likely to fool you with randomness).</p>
</div>
<p>Inference from model @ref(eq:continuous-x-m1) assumes homogeneity of the response conditional on <span class="math inline">\(X\)</span>. For a continuous <span class="math inline">\(X\)</span>, this means the residuals should have approximately equal variance at low, mid, and high values of <span class="math inline">\(X\)</span> (and everywhere in between). One can visually inspect the spread of points in the <span class="math inline">\(Y\)</span> direction across the groups for categorical <span class="math inline">\(X\)</span> or along the <em>X</em>-axis for continuous <span class="math inline">\(X\)</span>. A useful method for checking how residual variance changes (usually increases) with the conditional mean of <span class="math inline">\(Y\)</span> is a <strong>spread-location plot</strong>. The <code>spreadLevelPlot(m1)</code> function from the car package is useful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spreadLevelPlot</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Suggested power transformation:  0.6721303 </code></pre>
</div>
</div>
<p>The dashed blue line shows linear trends while the magenta line shows non-linear trends. For the green-down data, the dashed line is very flat while the magenta-line shows what looks like random fluctations. Taken together, the two lines indicate adequate model fit.</p>
</section>
<section id="plotting-models-with-continuous-x" class="level3" data-number="9.3.5">
<h3 data-number="9.3.5" class="anchored" data-anchor-id="plotting-models-with-continuous-x"><span class="header-section-number">9.3.5</span> Plotting models with continuous <em>X</em></h3>
<section id="quick-plot" class="level4" data-number="9.3.5.1">
<h4 data-number="9.3.5.1" class="anchored" data-anchor-id="quick-plot"><span class="header-section-number">9.3.5.1</span> Quick plot</h4>
<p><code>qplot</code> from the ggplot package is useful for initial examinations of the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> transition_date, <span class="at">data =</span> fig2c) <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Some variations of this quick plot to explore include</p>
<ol type="1">
<li>use <code>geom_smooth(method = "lm")</code></li>
</ol>
</section>
<section id="ggpubr-plots" class="level4" data-number="9.3.5.2">
<h4 data-number="9.3.5.2" class="anchored" data-anchor-id="ggpubr-plots"><span class="header-section-number">9.3.5.2</span> ggpubr plots</h4>
<p>ggpubr is a package with functions that automates the construction of publication-ready ggplots. <code>ggscatter</code> can generate a publishable plot with little effort.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(<span class="at">data =</span> fig2c,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"temperature"</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"transition_date"</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"Added Temperature (°C)"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"Day of Green-down (DOY)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It take only a little more effort to add useful modifications.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(<span class="at">data =</span> fig2c,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"temperature"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"transition_date"</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"red"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill =</span> <span class="st">"lightgray"</span>),</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"Added Temperature (°C)"</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"Day of Green-down (DOY)"</span>) <span class="sc">+</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_regline_equation</span>(<span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label.y =</span> <span class="dv">340</span>) <span class="sc">+</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_cor</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..rr.label.., ..p.label.., <span class="at">sep =</span> <span class="st">"~`,`~"</span>)),</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">label.y =</span> <span class="dv">335</span>) <span class="sc">+</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notes</p>
<ol class="example" type="1">
<li>The interval shown is the 95% confidence interval of the expected values, which is what we want to communicate with the experimental green-down data. Were we to want to use this as a prediction model, we would want the 95% prediction interval. I’m not sure that ggpubr can plot a prediction interval. To see how I plotted the prediction interval in Figure @ref(fig:continuous-x-pred-fig) above, see the Hidden Code section below.</li>
<li>The arguments of the <code>ggscatter</code> function are typed in explicitly (<code>x = "temperarture"</code> and not just <code>"temperature"</code>). Each argument starts on a new line to increase readability.</li>
<li>The <code>+</code> after the <code>ggscatter</code> function adds additional layers to the plot. Each additional component is started on a new line to increase readability.</li>
<li>The first line of the <code>stat_cor</code> function (everything within <code>aes()</code>) plots the <span class="math inline">\(R^2\)</span> instead of the correlation coefficient <span class="math inline">\(r\)</span>. Copy and pasting this whole line just works.</li>
<li>Comment out the line of the ggplot script starting with <code>stat_cor</code> and re-run (comment out by inserting a <code>#</code> at the front of the line. A consistent way to do this is to triple-click the line to highlight the line and then type command-shift-c on Mac OS). The script runs without error because <code>NULL</code> has been added as the final plot component. Adding “NULL” is a useful trick.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(<span class="at">data =</span> efig_3d,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"autumn_temp_anomaly"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"green_down_anomaly"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"red"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill =</span> <span class="st">"lightgray"</span>),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"Added Temperature (°C)"</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"Day of Green-down (DOY)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggplots" class="level4" data-number="9.3.5.3">
<h4 data-number="9.3.5.3" class="anchored" data-anchor-id="ggplots"><span class="header-section-number">9.3.5.3</span> ggplots</h4>
<p>Use <code>ggplot</code> from the ggplot2 package for full control of plots. See the Hidden Code below for how I generated the plots in Figure @ref(fig:continuous-x-plot) above.</p>
</section>
</section>
<section id="creating-a-table-of-predicted-values-and-95-prediction-intervals" class="level3" data-number="9.3.6">
<h3 data-number="9.3.6" class="anchored" data-anchor-id="creating-a-table-of-predicted-values-and-95-prediction-intervals"><span class="header-section-number">9.3.6</span> Creating a table of predicted values and 95% prediction intervals</h3>
<p>efig_3d is the data.table created from importing the data in Extended Data Figure 3d above. The fit model is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>efig3d_m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(green_down_anomaly <span class="sc">~</span> autumn_temp_anomaly, <span class="at">data =</span> efig_3d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>predict(efig3d_m1)</code> function is used to compute either fitted or predicted values, and either the confidence or prediction interval of these values.</p>
<p>Unless specified by <code>newdata</code>, the default x-values used to generate the y in <code>predict(efig3d_m1)</code> are the x-values in the data used to fit the model. The returned values are the expected value for each <span class="math inline">\(x_i\)</span> in the data. The argument <code>newdata</code> passes a data.frame (remember a data.table is a data.frame!) with new x-values. Since these x-values were not in the data used to fit the model, the returned <span class="math inline">\(y_{hat}\)</span> are predicted values.</p>
<p>The range of x-values in the data is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(efig_3d[,autumn_temp_anomaly])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.673793  2.568045</code></pre>
</div>
</div>
<p>Let’s get predicted values for a value of <span class="math inline">\(autumn\_temp\_anomaly = 2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(efig3d_m1, <span class="at">newdata =</span> <span class="fu">data.table</span>(<span class="at">autumn_temp_anomaly =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
3.192646 </code></pre>
</div>
</div>
<p>And predicted values across the range of measured values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>new_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">autumn_temp_anomaly =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(efig3d_m1, <span class="at">newdata =</span> new_dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4 
-3.192646 -1.596323  1.596323  3.192646 </code></pre>
</div>
</div>
<p>Add 95% confidence intervals (this could be used to create the band for plotting)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(efig3d_m1, </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> new_dt,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">interval =</span> <span class="st">"confidence"</span>,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        fit        lwr        upr
1 -3.192646 -5.2485713 -1.1367215
2 -1.596323 -2.9492686 -0.2433778
3  1.596323  0.2433778  2.9492686
4  3.192646  1.1367215  5.2485713</code></pre>
</div>
</div>
<p>Change to the 95% prediction intervals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(efig3d_m1, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata =</span> new_dt,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">interval =</span> <span class="st">"prediction"</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        fit        lwr       upr
1 -3.192646 -12.833739  6.448446
2 -1.596323 -11.112325  7.919679
3  1.596323  -7.919679 11.112325
4  3.192646  -6.448446 12.833739</code></pre>
</div>
</div>
<p>Put this all together in a pretty table. I’ve used knitr’s <code>kable</code> function but there are table packages in R that allow extensive control of the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>efig3d_m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(green_down_anomaly <span class="sc">~</span> autumn_temp_anomaly, <span class="at">data =</span> efig_3d)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>new_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">autumn_temp_anomaly =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>prediction_table <span class="ot">&lt;-</span> <span class="fu">predict</span>(efig3d_m1, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">newdata =</span> new_dt,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">interval =</span> <span class="st">"prediction"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fit</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>prediction_table <span class="ot">&lt;-</span> <span class="fu">data.table</span>(new_dt, prediction_table)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>pretty_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Autumn Temp Anomaly"</span>, <span class="st">"Estimate"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(prediction_table, <span class="at">old =</span> <span class="fu">colnames</span>(prediction_table), <span class="at">new =</span> pretty_names)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(prediction_table, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Autumn Temp Anomaly</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">97.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-2</td>
<td style="text-align: right;">-3.2</td>
<td style="text-align: right;">-12.8</td>
<td style="text-align: right;">6.4</td>
</tr>
<tr class="even">
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-1.6</td>
<td style="text-align: right;">-11.1</td>
<td style="text-align: right;">7.9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">-7.9</td>
<td style="text-align: right;">11.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">-6.4</td>
<td style="text-align: right;">12.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="hidden-code" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="hidden-code"><span class="header-section-number">9.4</span> Hidden code</h2>
<section id="import-and-plot-of-fig2c-ecosystem-warming-experimental-data" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="import-and-plot-of-fig2c-ecosystem-warming-experimental-data"><span class="header-section-number">9.4.1</span> Import and plot of fig2c (ecosystem warming experimental) data</h3>
<p>Import</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Ecosystem warming extends vegetation activity but heightens vulnerability to cold temperatures"</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41586_2018_399_MOESM3_ESM.xlsx"</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>fig2 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path) <span class="sc">|&gt;</span> <span class="co"># import</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> <span class="co"># clean the column names</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="co"># convert to data.table</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig2)</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>fig2c <span class="ot">&lt;-</span> fig2[panel <span class="sc">==</span> <span class="st">"2c"</span>,]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig2c)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating the response plot (the bottom component)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>m1_b <span class="ot">&lt;-</span> <span class="fu">coef</span>(m1)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>m1_ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(m1)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>m1_b0_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Intercept: "</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(m1_b[<span class="dv">1</span>],<span class="dv">1</span>),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">" ("</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(m1_ci[<span class="dv">1</span>,<span class="dv">1</span>],<span class="dv">1</span>),</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">", "</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(m1_ci[<span class="dv">1</span>,<span class="dv">2</span>],<span class="dv">1</span>),</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">") d"</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>m1_b1_text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Slope: "</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(m1_b[<span class="dv">2</span>],<span class="dv">2</span>),</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">" ("</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(m1_ci[<span class="dv">2</span>,<span class="dv">1</span>],<span class="dv">2</span>),</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">", "</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(m1_ci[<span class="dv">2</span>,<span class="dv">2</span>],<span class="dv">2</span>),</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">") d per 1 °C"</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="co"># regression line</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>m1_x <span class="ot">&lt;-</span> <span class="fu">min</span>(fig2c[, temperature])</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>m1_xend <span class="ot">&lt;-</span> <span class="fu">max</span>(fig2c[, temperature])</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>m1_y <span class="ot">&lt;-</span> m1_b[<span class="dv">1</span>] <span class="sc">+</span> m1_b[<span class="dv">2</span>]<span class="sc">*</span>m1_x</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>m1_yend <span class="ot">&lt;-</span> m1_b[<span class="dv">1</span>] <span class="sc">+</span> m1_b[<span class="dv">2</span>]<span class="sc">*</span>m1_xend</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>fig2c_gg_response <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> fig2c,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> temperature,</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> transition_date)) <span class="sc">+</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># regression line first, to not block point</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> m1_x,</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> m1_y,</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">xend =</span> m1_xend,</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">yend =</span> m1_yend) <span class="sc">+</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create black edge to points</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(size = 4,</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            color = "black") +</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> pal_okabe_ito[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.25</span>, <span class="fl">4.5</span>, <span class="fl">6.75</span>, <span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Plot temperature (ΔT, °C)"</span>) <span class="sc">+</span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Autumn green-down (DOY)"</span>) <span class="sc">+</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a><span class="co"># fig2c_gg_response</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating the effects plot (the top component)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>m1_coeff_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">term =</span> <span class="fu">row.names</span>(m1_coeff),</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">data.table</span>(m1_coeff))[<span class="dv">2</span>,] <span class="sc">|&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>m1_coeff_dt[ , p_pretty <span class="sc">:</span><span class="er">=</span> <span class="fu">pvalString</span>(pr_t)]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>min_bound <span class="ot">&lt;-</span> <span class="fu">min</span>(m1_coeff_dt[, x2_5_percent])</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>max_bound <span class="ot">&lt;-</span> <span class="fu">min</span>(m1_coeff_dt[, x97_5_percent])</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>y_lo <span class="ot">&lt;-</span> <span class="fu">min</span>(min_bound<span class="sc">+</span>min_bound<span class="sc">*</span><span class="fl">0.2</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span>max_bound)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>y_hi <span class="ot">&lt;-</span> <span class="fu">max</span>(max_bound <span class="sc">+</span> max_bound<span class="sc">*</span><span class="fl">0.2</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span>min_bound)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>y_lims <span class="ot">&lt;-</span> <span class="fu">c</span>(y_lo, y_hi)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>fig2c_gg_effect <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>m1_coeff_dt, </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> term,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># confidence level of effect</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>x2_5_percent, </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax=</span>x97_5_percent),</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span><span class="dv">0</span>, </span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate of effect</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># zero effect</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># p-value</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> m1_coeff_dt<span class="sc">$</span>p_pretty,</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fl">7.5</span>) <span class="sc">+</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aesthetics</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position=</span><span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="st">"Temperature</span><span class="sc">\n</span><span class="st">effect"</span>) <span class="sc">+</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Effects (day/°C)"</span>) <span class="sc">+</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> y_lims) <span class="sc">+</span> </span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a><span class="co">#fig2c_gg_effect</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combining the response and effects plots into single plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fig3d_fig <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(fig2c_gg_effect,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                       fig2c_gg_response,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nrow=</span><span class="dv">2</span>,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">axis =</span> <span class="st">"lr"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.4</span>,<span class="dv">1</span>))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>fig3d_fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-and-plot-efig_3d-ecosysem-warming-observational-data" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="import-and-plot-efig_3d-ecosysem-warming-observational-data"><span class="header-section-number">9.4.2</span> Import and plot efig_3d (Ecosysem warming observational) data</h3>
<p>Import</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Ecosystem warming extends vegetation activity but heightens vulnerability to cold temperatures"</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41586_2018_399_MOESM6_ESM.xlsx"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>efig_3d <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">range =</span> <span class="st">"J2:K87"</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># header causing issues</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="co"># convert to data.table</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(efig_3d, <span class="at">old =</span> <span class="fu">colnames</span>(efig_3d), <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"autumn_temp_anomaly"</span>, <span class="st">"green_down_anomaly"</span>))</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View(efig_3d)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(green_down_anomaly <span class="sc">~</span> autumn_temp_anomaly, <span class="at">data =</span> efig_3d)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get x for drawing slope</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>minx <span class="ot">&lt;-</span> <span class="fu">min</span>(efig_3d[,autumn_temp_anomaly])</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>maxx <span class="ot">&lt;-</span> <span class="fu">max</span>(efig_3d[,autumn_temp_anomaly])</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>new_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(minx, maxx, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">autumn_temp_anomaly =</span> new_x)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>new_data[, yhat <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(m1, <span class="at">newdata =</span> new_data)]</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>new_data[, conf_lwr <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(m1, </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">interval =</span> <span class="st">"confidence"</span>,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> new_data)<span class="sc">$</span>fit[, <span class="st">"lwr"</span>]]</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>new_data[, conf_upr <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(m1, </span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">interval =</span> <span class="st">"confidence"</span>,</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> new_data)<span class="sc">$</span>fit[, <span class="st">"upr"</span>]]</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>new_data[, pred_lwr <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(m1, </span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">interval =</span> <span class="st">"prediction"</span>,</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> new_data)<span class="sc">$</span>fit[, <span class="st">"lwr"</span>]]</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>new_data[, pred_upr <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(m1, </span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">se.fit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">interval =</span> <span class="st">"prediction"</span>,</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">newdata =</span> new_data)<span class="sc">$</span>fit[, <span class="st">"upr"</span>]]</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggscatter</span>(<span class="at">data =</span> efig_3d,</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">"autumn_temp_anomaly"</span>,</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"green_down_anomaly"</span>,</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>,</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fill =</span> <span class="st">"lightgray"</span>),</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"Temperature Anomaly (°C)"</span>,</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">"Day of Green-down Anomaly (DOY)"</span>) <span class="sc">+</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> new_data,</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> pred_lwr,</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> pred_upr,</span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> yhat,</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="st">"band"</span>),</span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"gray"</span>,</span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> new_data,</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> conf_lwr,</span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> conf_upr,</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> yhat,</span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="st">"band"</span>), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_cor</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..rr.label.., ..p.label.., <span class="at">sep =</span> <span class="st">"~`,`~"</span>)),</span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">label.y =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_okabe_ito) <span class="sc">+</span></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>  </span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-and-plot-of-fig1f-methionine-restriction-data" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="import-and-plot-of-fig1f-methionine-restriction-data"><span class="header-section-number">9.4.3</span> Import and plot of fig1f (methionine restriction) data</h3>
<p>Import</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>data_from <span class="ot">&lt;-</span> <span class="st">"Dietary methionine influences therapy in mouse cancer models and alters human metabolism"</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="st">"41586_2019_1437_MOESM2_ESM.xlsx"</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(data_folder, data_from, file_name)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>fig1f_wide <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(file_path,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"f"</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"B7:R12"</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>() <span class="co"># convert to data.table</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(fig1f_wide,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">old =</span> <span class="fu">colnames</span>(fig1f_wide),</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"day"</span>,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"Cn_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"MR_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>fig1f_wide <span class="ot">&lt;-</span> <span class="fu">transpose</span>(fig1f_wide, <span class="at">make.names =</span> <span class="dv">1</span>, <span class="at">keep.names =</span> <span class="st">"id"</span>)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>fig1f_wide[, treatment <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(<span class="fu">substr</span>(id, <span class="dv">1</span>, <span class="dv">2</span>))]</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">25</span>, <span class="dv">28</span>, <span class="dv">30</span>, <span class="dv">34</span>, <span class="dv">39</span>)</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>fig1f <span class="ot">&lt;-</span> <span class="fu">melt</span>(fig1f_wide,</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>              id.vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"id"</span>),</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>              measure.vars <span class="ot">&lt;-</span> <span class="fu">as.character</span>(days),</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable.name =</span> <span class="st">"day"</span>,</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">value.name =</span> <span class="st">"volume"</span>)</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>fig1f[, day <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(day))]</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="co"># View(fig1f)</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(x = day, y = volume, color = treatment, data = fig1f) + geom_line(aes(group = id))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating the response plot (the bottom component)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fig1f_gg_response <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> fig1f,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> volume, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">group =</span> id), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Day"</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(Tumor<span class="sc">~</span>Volume<span class="sc">~</span>(mm<span class="sc">^</span><span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_okabe_ito) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">98</span>),</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.just =</span> <span class="st">"right"</span>,</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>),</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="co"># fig1f_gg_response</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating the effects plot (the top component)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>m1_coeff_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">term =</span> <span class="fu">row.names</span>(m1_coef_table),</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">data.table</span>(m1_coef_table))[<span class="dv">2</span>,] <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>m1_coeff_dt[ , p_pretty <span class="sc">:</span><span class="er">=</span> <span class="fu">pvalString</span>(pr_t)]</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>min_bound <span class="ot">&lt;-</span> <span class="fu">min</span>(m1_coeff_dt[, x2_5_percent])</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>max_bound <span class="ot">&lt;-</span> <span class="fu">min</span>(m1_coeff_dt[, x97_5_percent])</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>y_lo <span class="ot">&lt;-</span> <span class="fu">min</span>(min_bound<span class="sc">+</span>min_bound<span class="sc">*</span><span class="fl">0.2</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span>max_bound)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>y_hi <span class="ot">&lt;-</span> <span class="fu">max</span>(max_bound <span class="sc">+</span> max_bound<span class="sc">*</span><span class="fl">0.2</span>,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span>min_bound)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>y_lims <span class="ot">&lt;-</span> <span class="fu">c</span>(y_lo, y_hi)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>fig1f_gg_effect <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>m1_coeff_dt, </span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> term,</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># confidence level of effect</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>x2_5_percent, </span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax=</span>x97_5_percent),</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span><span class="dv">0</span>, </span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate of effect</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># zero effect</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># p-value</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> m1_coeff_dt<span class="sc">$</span>p_pretty,</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fl">7.5</span>) <span class="sc">+</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aesthetics</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position=</span><span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="st">"MR</span><span class="sc">\n</span><span class="st">effect"</span>) <span class="sc">+</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(Growth<span class="sc">~</span>(mm<span class="sc">^</span><span class="dv">3</span><span class="sc">/</span>day))) <span class="sc">+</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> y_lims) <span class="sc">+</span> </span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pubr</span>() <span class="sc">+</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a><span class="co">#fig1f_gg_effect</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combining the response and effects plots into single plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fig1f_gg <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(fig1f_gg_effect,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                      fig1f_gg_response,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nrow=</span><span class="dv">2</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">axis =</span> <span class="st">"lr"</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.4</span>,<span class="dv">1</span>))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>fig1f_gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="try-it" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="try-it"><span class="header-section-number">9.5</span> Try it</h2>
<section id="a-prediction-model-from-the-literature" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="a-prediction-model-from-the-literature"><span class="header-section-number">9.5.1</span> A prediction model from the literature</h3>
<p>The data come from the top, middle plot of Figure 1e of</p>
<p><a href="https://idp.nature.com/authorize/casa?redirect_uri=https://www.nature.com/articles/s41586-019-0984-y&amp;casa_token=9rpBLACc40cAAAAA:BzRKQHYdU9DOrzBS0f0lwrbp07MlfVqqL4yuyedE5b_xZ8geHuUCPFIDE3yQUBO-ibQLCrCI4t84aO8" target="_blank">Parker, B.L., Calkin, A.C., Seldin, M.M., Keating, M.F., Tarling, E.J., Yang, P., Moody, S.C., Liu, Y., Zerenturk, E.J., Needham, E.J. and Miller, M.L., 2019. An integrative systems genetic analysis of mammalian lipid metabolism. Nature, 567(7747), pp.187-193.</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6656374/" target="_blank">Public source</a></p>
<p><a href="https://www.nature.com/articles/s41586-019-0984-y#Sec35" target="_blank">Source data</a></p>
<p>The researchers built prediction models from a hybrid mouse diversity panel (HMDP) to predict liver lipid levels from measured plasma lipid levels in mice <em>and</em> in humans. The value of the predictor (<span class="math inline">\(X\)</span>) variable for an individual is not a measured value of a single plasma lipid but the predicted value, or <strong>score</strong>, from the prediction model based on an entire panel of lipid measurements in that individual. The <span class="math inline">\(Y\)</span> variable for the individual is the total measured level across a family of lipids (ceramides, triacylglycerols, diacylglycerols) in the liver of the individual. The question is, how well does the prediction score predict the actual liver level?</p>
<ol type="1">
<li>Use the data for TG (triacylglycerols) (the top, middle plot of Figure 1e). The column D is the “score” from the prediction model using plasma lipid levels. This is the <span class="math inline">\(X\)</span> variable (the column header is “fitted.total.Cer”). The column E is the total measured liver TG, so is the <span class="math inline">\(Y\)</span> variable.</li>
<li>Fit the linear model y ~ x.</li>
<li>Create a publication-quality plot of liver TG (<em>Y</em>-axis) against score (<em>X</em>-axis) – what the researchers labeled “fitted.total.Cer”. Include <span class="math inline">\(R^2\)</span> on the plot.</li>
<li>Advanced – add a 95% prediction interval to the plot (the template code for this is in the Hidden Code section for efig3d)</li>
<li>Create a table of expected liver TG and 95% prediction interval of liver TG of the score values (13.5, 14, 14.5, 15, 15.5, 16).</li>
<li>Comment on the predictability of liver TG using the plasma scores.</li>
</ol>
<p>`</p>
</section>
</section>
<section id="intuition-pumps" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="intuition-pumps"><span class="header-section-number">9.6</span> Intuition pumps</h2>
<section id="correlation-and-r2" class="level3" data-number="9.6.1">
<h3 data-number="9.6.1" class="anchored" data-anchor-id="correlation-and-r2"><span class="header-section-number">9.6.1</span> Correlation and $R^2</h3>
<p>In the code below</p>
<ol type="1">
<li>change the value of <code>n</code> to explore effect on the variability of the estimate. Look at this variability, and the magnitude of the SE, and the magnitude of the p-value.</li>
<li>change the value of <code>beta_1</code> to explore effect on what different slopes and correlations look like. Notice that if the variance is fixed (as in this simulation) the expected slope and expected correlation are equal. (Because I’ve fixed the variance in this simple simulation, this code will fail if abs(beta_1) &gt;= 1).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># choose between 3 and 10^5</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>beta_1 <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="co"># choose a value between -0.99 and 0.99</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> beta_1<span class="sc">*</span>x <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>beta_1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"b_1: "</span>, <span class="fu">round</span>(<span class="fu">coef</span>(m1)[<span class="dv">2</span>], <span class="dv">3</span>))</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"SE: "</span>, <span class="fu">round</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(m1))[<span class="dv">2</span>,<span class="dv">2</span>], <span class="dv">3</span>))</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"r: "</span>, <span class="fu">round</span>(<span class="fu">cor</span>(x,y), <span class="dv">3</span>))</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"R^2: "</span>, <span class="fu">round</span>(<span class="fu">summary</span>(m1)<span class="sc">$</span>r.squared, <span class="dv">3</span>))</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(<span class="at">data =</span> <span class="fu">data.table</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">x =</span> <span class="st">"x"</span>, <span class="at">y =</span> <span class="st">"y"</span>,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="st">"reg.line"</span>) <span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="fu">paste</span>(slope,se,r,r2,<span class="at">sep=</span><span class="st">";  "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="continuous_x_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/middleprofessor\.github\.io\/benchbiostats\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/intro-stat-modeling.html" class="pagination-link" aria-label="An introduction to linear models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">An introduction to linear models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/one-factor.html" class="pagination-link" aria-label="Linear models with a single, categorical *X* (&quot;t-tests&quot; and &quot;ANOVA&quot;)">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear models with a single, categorical <em>X</em> (“t-tests” and “ANOVA”)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>